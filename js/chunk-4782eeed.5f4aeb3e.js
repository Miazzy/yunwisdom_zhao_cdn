(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4782eeed"],{"009f":function(t,e,s){"use strict";s.r(e);var a=s("57e0"),i=s("28ba"),o=(s("e37d"),s("2877")),n=Object(o["a"])(i["a"],a["a"],a["b"],!1,null,null,null);e["default"]=n.exports},"28ba":function(t,e,s){"use strict";var a=s("d7d2");e["a"]=a["a"]},"57e0":function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}));var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"task-detail",attrs:{id:"task-detail"}},[s("a-spin",{staticClass:"task-detail-spin",attrs:{spinning:t.loading}},[s("div",{staticClass:"task-header",class:{disabled:t.task.deleted}},[t.task.deleted?s("span",{staticClass:"head-title muted"},[s("a-icon",{attrs:{type:"delete"}}),t._v(" \n        "),s("span",[t._v("任务已在回收站中，不可修改")])],1):s("span",{staticClass:"head-title"},[t.task.parentTask?s("span",[s("span",{staticClass:"muted"},[t._v("属于任务：")]),s("a-breadcrumb",{staticClass:"breadcrumb text-default",attrs:{separator:">"}},t._l(t.task.parentTasks,(function(e){return s("a-breadcrumb-item",{key:e.code},[s("a",{staticClass:"text-default",on:{click:function(s){return t.init(e.code)}}},[t._v(t._s(e.name))])])})),1)],1):s("span",[t._v(t._s(t.task.projectName)+" · "+t._s(t.task.stageName))])]),s("span",{staticClass:"header-action text-right"},[t.task.deleted?[s("a",{staticClass:"action-item muted",on:{click:t.recoveryTask}},[s("a-icon",{attrs:{type:"undo"}}),s("span",[t._v("恢复内容")])],1),s("a",{staticClass:"action-item muted",on:{click:t.deleteTask}},[s("a-icon",{attrs:{type:"delete"}}),s("span",[t._v("彻底删除")])],1)]:[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("复制任务链接")])]),s("a",{directives:[{name:"clipboard",rawName:"v-clipboard",value:t.taskLink,expression:"taskLink"}],staticClass:"action-item muted",on:{success:t.copyLink}},[s("a-icon",{attrs:{type:"link"}})],1)],2),s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点个赞")])]),s("a",{staticClass:"action-item muted",class:{active:t.task.liked},on:{click:function(e){return t.like(!t.task.liked)}}},[s("a-icon",{attrs:{type:"like"}}),s("span",{directives:[{name:"show",rawName:"v-show",value:t.task.like,expression:"task.like"}]},[t._v(t._s(t.task.like))])],1)],2),s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleTaskMenu,callback:function(e){t.visibleTaskMenu=e},expression:"visibleTaskMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("打开菜单")])]),s("a",{staticClass:"action-item muted"},[s("a-icon",{attrs:{type:"ellipsis"}})],1)],2),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay"},on:{click:t.doTask},slot:"overlay"},[s("a-menu-item",{key:"copy"},[s("a-icon",{attrs:{type:"copy"}}),s("span",[t._v("复制任务 *")])],1),s("a-menu-item",{key:"move"},[s("a-icon",{attrs:{type:"snippets"}}),s("span",[t._v("移动任务 *")])],1),s("a-menu-item",{key:"star"},[s("a-icon",{attrs:{type:"star"}}),t.task.stared?s("span",[t._v("取消收藏")]):s("span",[t._v("收藏任务")])],1),s("a-menu-item",{key:"recycle"},[s("a-icon",{attrs:{type:"delete"}}),s("span",[t._v("移到回收站")])],1),s("a-menu-item",{key:"open"},[s("a-icon",{attrs:{type:"book"}}),s("span",[t._v("以新标签页打开")])],1),s("a-menu-divider"),s("a-menu-item",{key:"private"},[s("a-icon",{attrs:{type:t.task.private?"lock":"unlock"}}),s("span",[t._v("隐私模式")]),s("a",{staticClass:"menu-action text-primary"},[t.task.private?s("span",[t._v("已开启")]):s("span",[t._v("已关闭")])]),s("div",{staticClass:"menu-desc muted"},[t.task.private?s("span",[t._v("仅参与者可见")]):s("span",[t._v("所有成员可见")])])],1)],1)],1)],s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("关闭面板")])]),s("a",{staticClass:"action-item muted",on:{click:t.detailClose}},[s("a-icon",{attrs:{type:"close"}})],1)],2)],2)]),s("div",{staticClass:"task-wrap"},[s("div",{staticClass:"task-content"},[s("div",{staticClass:"content-left"},[s("vue-scroll",{attrs:{ops:t.scrollOps}},[s("div",{staticClass:"task-title",class:{disabled:t.task.deleted}},[s("a-input",{directives:[{name:"show",rawName:"v-show",value:t.showEditName,expression:"showEditName"}],ref:"inputTitle",attrs:{"auto-focus":"",size:"large"},on:{blur:t.doName},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}}),t.task.deleted?s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text"},[t._v(t._s(t.task.name))]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击即可编辑")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text",on:{click:t.editTitle}},[t._v(t._s(t.task.name))])],2)],1),s("div",{staticClass:"task-basic-attrs-view muted"},[s("div",{staticClass:"field-list",class:{disabled:t.task.deleted}},[s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"check-square"}}),s("span",{staticClass:"field-name"},[t._v("状态")])],1),s("div",{staticClass:"field-right"},[s("a-dropdown",{class:{disabled:t.task.hasUnDone},attrs:{trigger:["click"],disabled:!!t.task.deleted||!!t.task.hasUnDone}},[s("a-tooltip",{attrs:{placement:"top"}},[s("template",{slot:"title"},[t.task.hasUnDone?s("span",{staticStyle:{"font-size":"12px"}},[t._v("子任务尚未全部完成，无法完成父任务")]):t._e()]),s("span",[t.task.done?s("a-tag",{attrs:{color:"green"}},[t._v("已完成")]):t._e(),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.task.done,expression:"!task.done"}]},[t._v("未完成")])],1)],2),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:function(e){return t.taskDone(t.task.code,!t.task.done)}},slot:"overlay"},[s("a-menu-item",{key:"done"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"green"}},[t._v("已完成")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.task.done,expression:"task.done"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"undone"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"grey"}},[t._v("未完成")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.task.done,expression:"!task.done"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"user"}}),s("span",{staticClass:"field-name"},[t._v("执行者")])],1),s("div",{staticClass:"field-right"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted,placement:"bottomCenter"},model:{value:t.visibleTaskMemberMenu,callback:function(e){t.visibleTaskMemberMenu=e},expression:"visibleTaskMemberMenu"}},[t.task.deleted?s("div",{staticClass:"field-flex"},[t.task.executor?[s("a-avatar",{attrs:{src:t.task.executor.avatar,icon:"user",size:"small"}}),s("a",{staticClass:"muted name"},[t._v(t._s(t.task.executor.name))])]:t._e(),t.task.executor?t._e():[s("a-avatar",{attrs:{icon:"user",size:"small"}}),s("a",{staticClass:"muted name"},[t._v("待认领")])]],2):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置执行者")])]),s("div",{staticClass:"field-flex"},[t.task.executor?[s("a-avatar",{attrs:{src:t.task.executor.avatar,icon:"user",size:"small"}}),s("a",{staticClass:"muted name"},[t._v(t._s(t.task.executor.name))])]:t._e(),t.task.executor?t._e():[s("a-avatar",{attrs:{icon:"user",size:"small"}}),s("a",{staticClass:"muted name"},[t._v("待认领")])]],2)],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[t.visibleTaskMemberMenu?s("task-member-menu",{attrs:{projectCode:t.projectCodeCurrent,taskCode:t.code},on:{close:function(e){return t.init(!1)},inviteProjectMember:function(e){t.showInviteMember=!0,t.visibleTaskMemberMenu=!1}}}):t._e()],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"calendar"}}),s("span",{staticClass:"field-name"},[t._v("时间")])],1),s("div",{staticClass:"field-right field-date"},[t.task.openBeginTime?[s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted},model:{value:t.showBeginTime,callback:function(e){t.showBeginTime=e},expression:"showBeginTime"}},[t.task.deleted?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.task.setBeginTime?[t._v(t._s(t.task.begin_time_format))]:[t._v("设置开始时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置开始时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.task.setBeginTime?[t._v(t._s(t.task.begin_time_format))]:[t._v("设置开始时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showBeginTime},on:{ok:function(e){return t.doBeginTime(!0)}},model:{value:t.task.begin_time,callback:function(e){t.$set(t.task,"begin_time",e)},expression:"task.begin_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doBeginTime(!1)}}},[t._v("清除")])])],2)],1)],1),s("span",{staticClass:"m-l-sm m-r-sm"},[t._v("-")])]:t._e(),s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted},model:{value:t.showEndTime,callback:function(e){t.showEndTime=e},expression:"showEndTime"}},[t.task.deleted?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.task.setEndTime?[t._v(t._s(t.task.end_time_format))]:[t._v("设置截止时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置截止时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.task.setEndTime?[t._v(t._s(t.task.end_time_format))]:[t._v("设置截止时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showEndTime},on:{ok:function(e){return t.doEndTime(!0)}},model:{value:t.task.end_time,callback:function(e){t.$set(t.task,"end_time",e)},expression:"task.end_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doEndTime(!1)}}},[t._v("清除")])])],2)],1)],1)],2)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"file-text"}}),s("span",{staticClass:"field-name"},[t._v("备注")])],1),s("div",{staticClass:"field-right width-block"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showTaskDescriptionEdit,expression:"!showTaskDescriptionEdit"}],staticClass:"task-description",class:{disabled:t.task.deleted},on:{click:t.showTaskDesc}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.task.description,expression:"task.description"}],staticClass:"description-txt",domProps:{innerHTML:t._s(t.task.description)}}),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.task.description,expression:"!task.description"}]},[t._v("添加备注")])]),t.hasMoreDesc?s("div",{staticClass:"m-t-sm"},[s("a",{directives:[{name:"show",rawName:"v-show",value:!t.showMoreDesc,expression:"!showMoreDesc"}],on:{click:function(e){return t.checkShowMoreDesc(!0)}}},[t._v("显示更多")]),s("a",{directives:[{name:"show",rawName:"v-show",value:t.showMoreDesc,expression:"showMoreDesc"}],on:{click:function(e){return t.checkShowMoreDesc(!1)}}},[t._v("收起备注")])]):t._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showTaskDescriptionEdit,expression:"showTaskDescriptionEdit"}]},[s("editor",{ref:"vueWangeditor",attrs:{id:"editor",uploadImgServer:t.editorConfig.uploadImgServer,uploadImgHeaders:t.editorConfig.uploadImgHeaders,menus:t.editorConfig.menus}}),s("div",{staticClass:"action-btn pull-right"},[s("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showTaskDescriptionEdit=!1,t.initContent(!1)}}},[t._v("取消")]),s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"},on:{click:t.doContent}},[t._v("保存")])],1)],1)])])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"bulb"}}),s("span",{staticClass:"field-name"},[t._v("优先级")])],1),s("div",{staticClass:"field-right"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted}},[s("span",[s("a-tag",{attrs:{color:t.priColor(t.task.pri)}},[t._v(t._s(t.task.priText))])],1),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:t.doPri},slot:"overlay"},[s("a-menu-item",{key:0},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:t.priColor(0)}},[t._v("普通")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:0==t.task.pri,expression:"task.pri == 0"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:1},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:t.priColor(1)}},[t._v("紧急")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:1==t.task.pri,expression:"task.pri == 1"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:2},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:t.priColor(2)}},[t._v("非常紧急")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:2==t.task.pri,expression:"task.pri == 2"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1)])]),s("div",{staticClass:"component-mount task-tag"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"tag"}}),s("span",{staticClass:"field-name"},[t._v("标签")])],1),s("div",{staticClass:"field-right"},[s("div",{staticClass:"inline-block"},t._l(t.task.tags,(function(e,a){return s("a-tag",{key:a,attrs:{color:e.tag.color}},[t._v("\n                          "+t._s(e.tag.name)+"\n                          "),s("a-icon",{attrs:{type:"close"},on:{click:function(s){return t.removeTag(e.tag,a)}}})],1)})),1),s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted,placement:"bottomCenter"},model:{value:t.visibleTaskTagMenu,callback:function(e){t.visibleTaskTagMenu=e},expression:"visibleTaskTagMenu"}},[t.task.deleted?t._e():s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("添加标签")])]),s("div",{staticClass:"inline-block"},[s("a-icon",{staticClass:"member-item invite",attrs:{type:"plus-circle",theme:"twoTone"}})],1)],2),s("div",{staticClass:"inline-block"},[s("a-icon",{staticClass:"member-item invite",attrs:{type:"plus-circle",theme:"twoTone"}})],1),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[t.visibleTaskTagMenu?s("task-tag-menu",{attrs:{projectCode:t.projectCodeCurrent,taskCode:t.code},on:{change:t.taskTagChange,update:t.taskTagUpdate,delete:t.taskTagDelete}}):t._e()],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"bars"}}),s("span",{staticClass:"field-name"},[t._v("\n                        子任务\n                        "),s("span",{directives:[{name:"show",rawName:"v-show",value:t.childTaskList.length,expression:"childTaskList.length"}]},[t._v("· "+t._s(t.childTaskDoneNum)+"/"+t._s(t.childTaskList.length))])])],1),s("div",{staticClass:"field-right width-block"})])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"task-child"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.childTaskList.length,expression:"childTaskList.length"}],staticClass:"task-list"},t._l([0,1],(function(e){return s("div",{key:e},t._l(t.childTaskList,(function(a,i){return s("div",{key:a.code},[a.done==e?s("div",{staticClass:"list-item task"},[s("a-tooltip",{attrs:{placement:"top"}},[s("template",{slot:"title"},[a.parentDone?s("span",{staticStyle:{"font-size":"12px"}},[t._v("父任务已完成，无法重做子任务")]):a.hasUnDone?s("span",{staticStyle:{"font-size":"12px"}},[t._v("子任务尚未全部完成，无法完成父任务")]):t._e()]),s("div",{staticClass:"check-box-wrapper task-item",on:{click:function(e){return e.stopPropagation(),function(){if(t.task.deleted||a.parentDone||a.hasUnDone)return!1;t.taskDone(a.code,!a.done,i,"child")}()}}},[s("a-icon",{staticClass:"check-box",class:{disabled:t.task.deleted||a.parentDone||a.hasUnDone},style:{fontSize:"16px"},attrs:{type:a.done?"check-square":"border"}})],1)],2),s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted,placement:"bottomCenter"},model:{value:a.visibleChildTaskMemberMenu,callback:function(e){t.$set(a,"visibleChildTaskMemberMenu",e)},expression:"childTask.visibleChildTaskMemberMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[a.executor?s("span",[t._v(t._s(a.executor.name))]):s("span",[t._v("待认领")])]),a.executor?s("a-avatar",{staticClass:"task-item",class:{disabled:t.task.deleted},attrs:{size:"small",icon:"user",src:a.executor.avatar}}):s("a-avatar",{staticClass:"task-item",class:{disabled:t.task.deleted},attrs:{size:"small",icon:"user"}})],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[a.visibleChildTaskMemberMenu?s("task-member-menu",{attrs:{projectCode:t.projectCodeCurrent,taskCode:a.code,isCommit:!0},on:{close:function(e){a.visibleChildTaskMemberMenu=!1,t.getChildTasks()},inviteProjectMember:function(e){t.showInviteMember=!0,a.visibleChildTaskMemberMenu=!1}}}):t._e()],1)],1),s("div",{staticClass:"task-item task-title",on:{click:function(e){return e.stopPropagation(),t.init(a.code)}}},[s("div",{staticClass:"title-text",class:{done:a.done}},[t._v(t._s(a.name))])]),s("a",{staticClass:"muted",on:{click:function(e){return e.stopPropagation(),t.init(a.code)}}},[s("a-icon",{staticClass:"task-item",attrs:{type:"right"}})],1)],1):t._e()])})),0)})),0),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showChildTask,expression:"showChildTask"}],staticClass:"task-list"},[s("div",{staticClass:"add-task"},[s("div",{staticClass:"list-item task"},[s("span",{staticClass:"task-item check-box"}),s("a-dropdown",{attrs:{trigger:["click"],disabled:!!t.task.deleted,placement:"bottomCenter"},model:{value:t.visibleChildTaskMemberMenu,callback:function(e){t.visibleChildTaskMemberMenu=e},expression:"visibleChildTaskMemberMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[t.childExecutor?s("span",[t._v(t._s(t.childExecutor.name))]):s("span",[t._v("待认领")])]),s("div",{staticClass:"field-flex"},[t.childExecutor?[s("a-avatar",{staticClass:"task-item",attrs:{src:t.childExecutor.avatar,icon:"user",size:"small"}})]:t._e(),t.childExecutor?t._e():[s("a-avatar",{staticClass:"task-item",attrs:{icon:"user",size:"small"}})]],2)],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[t.visibleChildTaskMemberMenu?s("task-member-menu",{attrs:{projectCode:t.projectCodeCurrent,taskCode:t.childExecutor?t.code:"",isCommit:!1},on:{close:t.updateChildExecutor,inviteProjectMember:function(e){t.showInviteChildTaskMember=!0,t.visibleChildTaskMemberMenu=!1}}}):t._e()],1)],1),s("div",{staticClass:"task-item task-input"},[s("a-input",{on:{pressEnter:t.createTask},model:{value:t.childTaskName,callback:function(e){t.childTaskName=e},expression:"childTaskName"}})],1)],1),s("div",{staticClass:"action-btn text-right"},[s("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showChildTask=!1}}},[t._v("取消")]),s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"},on:{click:t.createTask}},[t._v("保存")])],1)])]),s("a-tooltip",{attrs:{placement:"top"}},[s("template",{slot:"title"},[t.task.done?s("span",{staticStyle:{"font-size":"12px"}},[t._v("父任务已完成，无法添加新的子任务")]):t._e()]),s("a",{directives:[{name:"show",rawName:"v-show",value:!t.showChildTask,expression:"!showChildTask"}],staticClass:"add-handler",class:{disabled:t.task.done},on:{click:function(){if(t.task.deleted||t.task.done)return!1;t.showChildTask=!0}}},[s("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"plus"}}),t._v("添加子任务\n                          ")],1)],2)],1)])])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left",staticStyle:{width:"100%"}},[s("a-icon",{attrs:{type:"clock-circle"}}),s("span",{staticClass:"field-name"},[t._v("\n                        工时\n                        "),t.workTimeList.length?s("span",[t._v("\n                          · 实际工时 "+t._s(t.workTimeTotal)+" 小时，工时记录 "+t._s(t.workTimeList.length)+" 条，预估工时 "+t._s(t.task.work_time)+" 小时\n                          "),s("a",{staticClass:"muted m-l-sm",on:{click:t.doPlainWorkTime}},[s("a-icon",{staticClass:"task-item",attrs:{type:"edit"}})],1)]):s("span",[t.task.work_time?s("span",[t._v("· 预估工时 "+t._s(t.task.work_time)+" 小时")]):t._e(),s("a-tooltip",[s("template",{slot:"title"},[s("span",[t._v("设置预估工时")])]),s("a",{staticClass:"muted m-l-sm",on:{click:t.doPlainWorkTime}},[s("a-icon",{staticClass:"task-item",attrs:{type:"edit"}})],1)],2)],1)])],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"task-child"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.workTimeList.length,expression:"workTimeList.length"}],staticClass:"task-list"},t._l(t.workTimeList,(function(e,a){return s("div",{key:e.code},[s("div",{staticClass:"list-item task m-l-xs"},[s("div",{staticClass:"task-item task-title hover-none"},[s("div",{staticClass:"title-text"},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[e.member?s("span",[t._v(t._s(e.member.name))]):s("span",[t._v("待认领")])]),s("a-avatar",{staticClass:"task-item",attrs:{size:"small",icon:"user",src:e.member.avatar}})],2),t._v("\n                                  "+t._s(e.member.name)+"\n                                  "+t._s(t.moment(e.begin_time).format("MM月DD日 HH:mm"))+"开始 工时为\n                                  "+t._s(e.num)+" 小时\n                                  "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.content,expression:"workTime.content"}],staticClass:"muted",staticStyle:{"padding-left":"40px","margin-top":"6px"}},[t._v(t._s(e.content))])],1)]),s("a",{staticClass:"muted",on:{click:function(s){return t.doWorkTime(e)}}},[s("a-icon",{staticClass:"task-item",attrs:{type:"edit"}})],1),s("a",{staticClass:"muted",on:{click:function(s){return t.deleteWorkTime(e,a)}}},[s("a-icon",{staticClass:"task-item",attrs:{type:"delete"}})],1)])])})),0),s("a-tooltip",{attrs:{placement:"top"}},[s("a",{staticClass:"add-handler",on:{click:function(e){return t.doWorkTime(!1)}}},[s("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"plus"}}),t._v("添加工时\n                          ")],1)])],1)])])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"paper-clip"}}),s("span",{staticClass:"field-name"},[t._v("关联文件")])],1),s("div",{staticClass:"field-right width-block"})])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"task-child"},[s("a",{staticClass:"add-handler",attrs:{id:"upload-file"}},[s("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"plus"}}),t._v("上传文件\n                        ")],1)])])])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.taskSourceList.length>0,expression:"taskSourceList.length > 0"}],staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"file-list"},[s("div",{staticClass:"m-xs m-t-none"},[t._v("关联的文件")]),s("a-list",t._l(t.taskSourceList,(function(e,a){return s("a-list-item",{key:a},[s("a-list-item-meta",[s("a-avatar",{attrs:{slot:"avatar",size:"small",shape:"square",icon:"link",src:e.sourceDetail.file_url},slot:"avatar"}),s("div",{attrs:{slot:"title"},slot:"title"},[s("a",{staticClass:"muted",attrs:{target:"_blank",href:e.sourceDetail.file_url}},[t._v("\n                                  "+t._s(e.title)+"\n                                ")])]),s("div",{attrs:{slot:"description"},slot:"description"})],1),s("a",{staticClass:"muted",attrs:{slot:"actions"},slot:"actions"},[s("span",[t._v(t._s(e.sourceDetail.projectName))])]),s("a",{staticClass:"muted",attrs:{slot:"actions"},slot:"actions"},[s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"}},[s("a",{staticClass:"action-item muted"},[s("a-icon",{attrs:{type:"down"}})],1),s("a-menu",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.sourceDetail.file_url,expression:"item.sourceDetail.file_url"}],staticClass:"field-right-menu",attrs:{slot:"overlay"},on:{click:function(s){return t.doSource(s,e)}},slot:"overlay"},[s("a-menu-item",{key:"copy"},[s("a-icon",{attrs:{type:"link"}}),s("span",[t._v("复制链接")])],1),s("a-menu-item",{key:"unlink"},[s("a-icon",{attrs:{type:"disconnect"}}),s("span",[t._v("取消关联")])],1)],1)],1)],1)],1)})),1)],1)])])])])])])],1),s("div",{staticClass:"content-right"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[t._v("参与者 · "+t._s(t.taskMemberList.length))]),s("div",{staticClass:"member-list"},[t._l(t.taskMemberList,(function(e){return s("a-tooltip",{key:e.code,attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("\n                    "+t._s(e.name)+"\n                    "),e.is_owner?s("span",[t._v("· 创建者")]):t._e()])]),s("a-avatar",{staticClass:"member-item",attrs:{icon:"user",size:"small",src:e.avatar},on:{click:function(s){return t.routerLink("/members/profile/"+e.membar_account_code+"?key=3")}}})],2)})),s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleProjectMemberMenu,callback:function(e){t.visibleProjectMemberMenu=e},expression:"visibleProjectMemberMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击添加参与者")])]),s("a-icon",{staticClass:"member-item invite",staticStyle:{"font-size":"24px"},attrs:{type:"plus-circle",theme:"twoTone"}})],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[t.visibleProjectMemberMenu?s("project-member-menu",{attrs:{taskCode:t.code,projectCode:t.projectCodeCurrent},on:{close:function(e){return t.init(!1)},inviteProjectMember:function(e){t.showInviteMember=!0,t.visibleProjectMemberMenu=!1}}}):t._e()],1)],1)],2)]),s("div",{staticClass:"log-wrap"},[s("div",{staticClass:"header"},[s("a-dropdown",{attrs:{trigger:["click"]}},[s("a",{staticClass:"text-default"},[t._v("\n                  所有动态\n                  "),s("a-icon",{attrs:{type:"down"}})],1),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:""},slot:"overlay",model:{value:t.taskLogType,callback:function(e){t.taskLogType=e},expression:"taskLogType"}},[s("a-menu-item",{key:"all"},[s("div",{staticClass:"menu-item-content"},[s("span",[t._v("所有动态")])])]),s("a-menu-item",{key:"comment"},[s("div",{staticClass:"menu-item-content"},[s("span",[t._v("仅评论")])])]),s("a-menu-item",{key:"log"},[s("div",{staticClass:"menu-item-content"},[s("span",[t._v("仅动态")])])])],1)],1)],1),s("vue-scroll",[s("div",{staticClass:"log-list muted"},[s("a",{directives:[{name:"show",rawName:"v-show",value:t.checkShowMoreLog,expression:"checkShowMoreLog"}],staticClass:"show-more muted",on:{click:t.getMoreTaskLog}},[s("a-icon",{attrs:{type:"ellipsis"}}),t._v("\n                  显示较早的 "+t._s(t.taskLogTotal-t.taskLogList.length)+" 条动态\n                ")],1),t._l(t.taskLogList,(function(e){return s("div",{key:e.code,class:{"log-comment":e.is_comment,"list-item":!e.is_comment}},[e.is_comment?t._e():[s("a-icon",{staticClass:"log-item",attrs:{type:e.icon}}),s("div",{staticClass:"log-item log-txt"},[s("div",[t._v("\n                        "+t._s(e.member.name)+"\n                        "),s("span",{domProps:{innerHTML:t._s(e.remark)}})]),e.content?s("div",{staticClass:"log-content",domProps:{innerHTML:t._s(e.content)}}):t._e()])],e.is_comment?[s("div",{staticClass:"log-txt text-default",staticStyle:{width:"100%",display:"flex","justify-content":"space-between"}},[s("div",{staticStyle:{display:"flex","align-items":"center"}},[s("a-avatar",{staticClass:"m-r-sm",staticStyle:{"margin-left":"-5px"},attrs:{size:24,src:e.member.avatar}}),s("div",[t._v(t._s(e.member.name))])],1),s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v(t._s(e.create_time))])]),s("span",{staticClass:"muted"},[t._v(t._s(t._f("formatLogTime")(e.create_time)))])],2)],1),s("div",{staticClass:"log-txt text-default",staticStyle:{padding:"0 0 0 30px"}},[s("div",{staticClass:"m-t-xs",domProps:{innerHTML:t._s(t.checkLink(e.content))}})])]:t._e(),e.is_comment?t._e():s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v(t._s(e.create_time))])]),s("span",[t._v(t._s(t._f("formatLogTime")(e.create_time)))])],2)],2)}))],2)])],1),s("div",{staticClass:"footer",attrs:{id:"footer"}},[s("a-popover",{attrs:{trigger:"click",placement:"top",visible:t.showMentions,arrowPointAtCenter:"",getPopupContainer:t.getPopup}},[s("template",{slot:"content"},[s("div",{staticClass:"mentions-content",staticStyle:{width:"200px"}},t._l(t.taskMemberList,(function(e){return s("div",{key:e.id,staticClass:"mentions-wrapper",on:{click:function(s){return t.selectMentionMember(e)}}},[s("a-avatar",{attrs:{src:e.avatar,icon:"user",size:28}}),s("span",{staticClass:"muted name m-l-xs"},[t._v(t._s(e.name))])],1)})),0)]),s("a-textarea",{ref:"commentText",staticStyle:{"margin-right":"24px"},attrs:{rows:1,placeholder:"支持@提及任务成员，Ctrl+Enter发表评论"},on:{focus:function(e){t.commenting=!0},blur:function(e){t.commenting=!1}},model:{value:t.comment,callback:function(e){t.comment=e},expression:"comment"}})],2),s("a-button",{staticClass:"middle-btn",attrs:{type:"primary"},on:{click:t.createComment}},[t._v("评论")])],1)])])])]),t.showInviteMember?s("invite-project-member",{attrs:{"project-code":t.projectCodeCurrent},model:{value:t.showInviteMember,callback:function(e){t.showInviteMember=e},expression:"showInviteMember"}}):t._e(),s("a-modal",{staticClass:"work-time-modal",attrs:{title:t.workTimeDo.modalTitle,bodyStyle:{paddingBottom:"1px"},confirmLoading:t.workTimeDo.confirmLoading},on:{ok:t.workTimeHandleSubmit},model:{value:t.workTimeDo.modalStatus,callback:function(e){t.$set(t.workTimeDo,"modalStatus",e)},expression:"workTimeDo.modalStatus"}},[s("a-form",{attrs:{layout:"vertical",form:t.workTimeDo.form},on:{submit:function(e){return e.preventDefault(),t.workTimeHandleSubmit(e)}}},[s("div",[s("div",{staticStyle:{"font-size":"15px"}},[t._v("登记任务")]),s("div",[t._v(t._s(t.task.name))]),s("a-divider",{staticClass:"m-t-xs m-b-md"})],1),s("div",{staticClass:"work-time-stats"},[s("div",{staticClass:"work-time-item"},[s("div",{staticClass:"muted title"},[t._v("预估工时")]),s("span",{staticClass:"work-time-num"},[t._v(t._s(t.task.work_time))]),s("span",[t._v("小时")])]),s("div",{staticClass:"work-time-item"},[s("div",{staticClass:"muted title"},[t._v("剩余工时")]),s("span",{staticClass:"work-time-num"},[t.task.work_time-t.workTimeTotal<0?[t._v("0")]:[t._v(t._s(t.task.work_time-t.workTimeTotal))]],2),s("span",[t._v("小时")])])]),s("a-row",{attrs:{gutter:24}},[s("a-col",{attrs:{span:12}},[s("a-form-item",{attrs:{label:"开始时间"}},[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["begin_time",{rules:[{required:!0,message:"请选择日期"}],validateTrigger:"change",initialValue:t.moment()}],expression:"[\n                              'begin_time',\n                              {rules: [{ required: true, message: '请选择日期' }], validateTrigger: 'change',initialValue: moment()}\n                          ]"}],attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",allowClear:"",placeholder:"请选择日期"}})],1)],1),s("a-col",{attrs:{span:12}},[s("a-form-item",{attrs:{label:"消耗时间"}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["num",{rules:[{required:!0,message:"请输入消耗时间"}],validateTrigger:"change"}],expression:"[\n                              'num',\n                              {rules: [{ required: true, message: '请输入消耗时间' }], validateTrigger: 'change'}\n                          ]"}],attrs:{type:"text",placeholder:"请输入数字",addonAfter:"小时"}})],1)],1),s("a-col",{attrs:{span:24}},[s("a-form-item",{attrs:{label:"工作内容"}},[s("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["content"],expression:"[\n                              'content',\n                          ]"}],attrs:{rows:4,type:"text",placeholder:"在这期间做了什么"}})],1)],1)],1)],1)],1),s("a-modal",{attrs:{title:t.plainWorkTime.modalTitle,bodyStyle:{paddingBottom:"1px"},confirmLoading:t.plainWorkTime.confirmLoading},on:{ok:t.workTimePlainHandleSubmit},model:{value:t.plainWorkTime.modalStatus,callback:function(e){t.$set(t.plainWorkTime,"modalStatus",e)},expression:"plainWorkTime.modalStatus"}},[s("a-form",{attrs:{layout:"vertical",form:t.plainWorkTime.form},on:{submit:function(e){return e.preventDefault(),t.workTimePlainHandleSubmit(e)}}},[s("a-form-item",{attrs:{label:""}},[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["work_time",{rules:[{required:!0,message:"请输入预估工时"}],validateTrigger:"change"}],expression:"[\n                              'work_time',\n                              {rules: [{ required: true, message: '请输入预估工时' }], validateTrigger: 'change'}\n                          ]"}],attrs:{type:"text",placeholder:"请输入数字",addonAfter:"小时"}})],1)],1)],1)],1)},i=[]},d077:function(t,e,s){},d7d2:function(t,e,s){"use strict";s("8e6e"),s("456d"),s("a481"),s("4917"),s("ac6a"),s("7f7f"),s("20d6");var a=s("bd86"),i=(s("c5f6"),s("5880")),o=s("a532"),n=s("b199"),r=s("8870"),c=s("d8bc"),l=s("f66c"),d=s("4540"),m=s("e8d3"),u=s("d3a1"),k=s("68fe"),v=s("2f14"),p=s("97a8"),h=s("81fe"),f=s("ca8d"),g=s("261e"),b=s("cff3");function C(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,a)}return s}function w(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?C(Object(s),!0).forEach((function(e){Object(a["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):C(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var T=Object(k["a"])("tokenList",!0),_="";if(T){var y=T.accessToken,x=T.tokenType;_="".concat(x," ").concat(y)}e["a"]={name:"task-detail",components:{ATextarea:g["a"],editor:o["default"],taskMemberMenu:l["default"],taskTagMenu:d["default"],projectMemberMenu:m["default"],inviteProjectMember:u["default"]},props:{taskCode:{type:[String],default:function(){return""}},width:{type:[String,Number],default:function(){return"1200"}}},data:function(){return{moment:moment,loading:!1,code:this.taskCode,projectCodeCurrent:"",task:{},taskLogList:[],taskLogTotal:0,taskMemberList:[],workTimeList:[],workTimeTotal:[],visibleTaskMenu:!1,visibleTaskMemberMenu:!1,visibleTaskTagMenu:!1,visibleProjectMemberMenu:!1,showInviteMember:!1,taskName:"",showEditName:!1,showBeginTime:!1,showEndTime:!1,showTaskDescriptionEdit:!1,showMoreDesc:!1,hasMoreDesc:!1,editorConfig:{uploadImgServer:Object(v["c"])("project/index/uploadImg"),uploadImgHeaders:{Authorization:_},menus:["head","bold","italic","justify","image","link","list","quote","table","|","fullscreen"]},departmentMemberInfo:null,childTaskList:[],showChildTask:!1,childTaskName:"",childExecutor:null,visibleChildTaskMemberMenu:!1,showInviteChildTaskMember:!1,taskSourceList:[],taskLogType:["all"],showMoreTaskLog:0,hasMoreTaskLog:!1,hideShowMore:!1,comment:"",commenting:!1,workTimeDo:{form:this.$form.createForm(this),info:null,modalTitle:"登记工时记录",modalStatus:!1,confirmLoading:!1},plainWorkTime:{form:this.$form.createForm(this),modalTitle:"设置预估工时",modalStatus:!1,confirmLoading:!1},showMentions:!1,mentionsList:[]}},computed:w({},Object(i["mapState"])({userInfo:function(t){return t.userInfo},uploader:function(t){return t.common.uploader},socketAction:function(t){return t.socketAction}}),{childTaskDoneNum:function(){var t=this.childTaskList.filter((function(t){return 1==t.done}));return t.length},checkShowMoreLog:function(){return!this.hideShowMore&&this.taskLogTotal>5},taskLink:function(){return window.location.href},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){},showInviteMember:function(t){t||this.getTaskMembers()},taskLogType:function(){this.getTaskLog()},socketAction:function(t){if("organization:task"===t.action){var e=t.data.data;e.taskCode==this.code&&this.init(null,!1)}},uploader:{handler:function(t,e){var s=this;console.log(t),console.log(t.fileList);var a=t.fileList,i=a.findIndex((function(t){return t.projectName==s.task.projectName}));-1!==i&&(this.taskSources(),this.getTaskLog())},deep:!0}},created:function(){this.init()},mounted:function(){var t=this,e=arguments;this.changeModalHeight(),window.onresize=function(){return function(){t.changeModalHeight()}()},document.onkeydown=function(s){console.log(s);var a=s||window.event||e.callee.caller.arguments[0];13==a.keyCode&&a.ctrlKey&&t.createComment(),"@"==a.key&&t.commenting?t.showMentions=!0:t.showMentions=!1},setTimeout((function(){t.uploader.assignBrowse(document.getElementById("upload-file"))}),500)},filters:{formatLogTime:function(t){return Object(h["c"])(t)}},methods:{init:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(this.code=t),e&&(this.loading=!0),this.clearMemberMenu(),this.getTask(),this.getChildTasks(),this.getTaskMembers(),this.getTaskWorkTimeList()},detailClose:function(){this.$emit("close",this.task)},clearMemberMenu:function(){this.visibleTaskTagMenu=!1,this.visibleTaskMemberMenu=!1,this.visibleProjectMemberMenu=!1},getTask:function(){var t=this;this.$store.commit("viewRefresh"),this.clearMemberMenu(),Object(n["g"])(this.code).then((function(e){t.getTaskLog(),t.taskSources(),t.taskName=e.data.name,t.task=e.data,t.projectCodeCurrent=e.data.project_code,t.task.end_time?(t.task.setEndTime=!0,t.task.end_time=moment(t.task.end_time)):(t.task.setEndTime=!1,t.task.end_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.task.end_time_format=Object(h["b"])(t.task.end_time,!0),t.task.begin_time?(t.task.setBeginTime=!0,t.task.begin_time=moment(t.task.begin_time)):(t.task.setBeginTime=!1,t.task.begin_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.task.begin_time_format=Object(h["b"])(t.task.begin_time,!0),t.initContent(t.task.description),t.task.executor&&!t.childExecutor&&(t.childExecutor=t.task.executor),t.loading=!1,t.$store.dispatch("setTempData",{projectCode:t.projectCodeCurrent,taskCode:t.code,projectName:e.data.projectName})}))},getTaskLog:function(){var t=this;Object(n["f"])({taskCode:this.code,all:this.showMoreTaskLog,pageSize:5,comment:"comment"==this.taskLogType[0]?1:0}).then((function(e){t.taskLogList=e.data.list,t.taskLogTotal=e.data.total,e.data.total>5&&(t.hasMoreTaskLog=!0)}))},taskSources:function(){var t=this;Object(f["t"])({taskCode:this.code}).then((function(e){t.taskSourceList=e.data}))},getMoreTaskLog:function(){this.showMoreTaskLog=1,this.hideShowMore=!0,this.getTaskLog()},getTaskWorkTimeList:function(){var t=this;Object(f["a"])({taskCode:this.code}).then((function(e){t.workTimeList=e.data;var s=0;e.data&&(e.data.forEach((function(t){s+=Number(t.num)})),t.workTimeTotal=s)}))},getTaskMembers:function(){var t=this;this.clearMemberMenu(),Object(c["b"])({taskCode:this.code,pageSize:100}).then((function(e){t.taskMemberList=e.data.list,t.loading=!1}))},doTask:function(t){var e=this,s=this,a=t.key;switch(a){case"recycle":this.$confirm({title:"移到回收站",content:"您确定要把该任务移到回收站吗？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(n["i"])(s.code).then((function(t){var e=Object(v["a"])(t);if(!e)return!1;s.task.deleted=1,s.getTaskLog()})),Promise.resolve()}});break;case"star":return this.task.stared?this.task.stared=0:this.task.stared=1,Object(n["k"])(s.code,this.task.stared),!0;case"open":var i=window.location.href;-1!==i.indexOf("?")?i+="&full-screen":i+="?full-screen",window.open(i);break;case"private":return Object(f["p"])(s.code,Number(!this.task.private)).then((function(t){var s=Object(v["a"])(t);if(!s)return!1;e.task.private=Number(!e.task.private)})),!0}this.visibleTaskMenu=!1},editTitle:function(){var t=this;this.showEditName=!0,this.$nextTick((function(){t.$refs.inputTitle.focus()}))},doSource:function(t,e){var s=this,a=t.key;switch(a){case"unlink":this.$confirm({title:"取消关联",content:"您确定永久删除这个关联？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(r["a"])(e.code).then((function(t){var e=Object(v["a"])(t);if(!e)return!1;s.taskSources(),s.getTaskLog()})),Promise.resolve()}});break;case"copy":return Object(p["b"])({title:"复制链接成功",msg:"在地址栏粘贴并打开可下载该资源"},"notice","success",5),!0}},deleteTask:function(){var t=this;this.$confirm({title:"彻底删除",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(n["b"])(t.code).then((function(e){t.detailClose()})),Promise.resolve()}})},recoveryTask:function(){var t=this;this.$confirm({title:"恢复内容",content:"您确定要恢复该任务吗？",okText:"确定",okType:"primary",cancelText:"再想想",onOk:function(){return Object(n["h"])(t.code).then((function(e){var s=Object(v["a"])(e);if(!s)return!1;t.getTaskLog()})),t.task.deleted=0,Promise.resolve()}})},copyLink:function(){Object(p["b"])({title:"复制链接成功",msg:"你可以在其他标签页粘贴并快速打开任务页面"},"notice","success",5)},like:function(t){t=Number(t),Object(n["d"])(this.code,t),t?this.task.like++:this.task.like--,this.task.liked=t},taskDone:function(t,e,s){var a=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"self";e=e?1:0,Object(n["l"])(t,e).then((function(t){var o=Object(v["a"])(t);if(!o)return!1;a.getTaskLog(),"self"==i?a.task.done=e:a.childTaskList[s].done=e,a.getTask(),a.getChildTasks()}))},doBeginTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.task.setBeginTime=t,this.showBeginTime=e;var s="";t?(s=moment(this.task.begin_time).format("YYYY-MM-DD HH:mm"),this.task.begin_time_format=moment(this.task.begin_time).format("MM月DD日 HH:mm")):s="",this.editTask({begin_time:s})},doEndTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.task.setEndTime=t,this.showEndTime=e;var s="";t?(s=moment(this.task.end_time).format("YYYY-MM-DD HH:mm"),this.task.end_time_format=moment(this.task.end_time).format("MM月DD日 HH:mm")):s="",this.editTask({end_time:s})},doPri:function(t){this.editTask({pri:t.key})},doName:function(){if(this.showEditName=!1,!this.task.name.trim()||this.task.name==this.taskName)return this.task.name=this.taskName,!1;this.editTask({name:this.task.name})},editTask:function(t){var e=this;t.taskCode=this.code,Object(n["c"])(t).then((function(t){var s=Object(v["a"])(t);if(!s)return!1;e.getTask()}))},priColor:function(t){switch(t){case 1:return"#ff9900";case 2:return"#ed3f14";default:return"#a6a6a6"}},showTaskDesc:function(){if(this.task.deleted)return!1;this.showTaskDescriptionEdit=!0,this.initContent(this.task.description)},initContent:function(t){var e=this;t?this.$refs.vueWangeditor.setHtml(t):this.$refs.vueWangeditor.setHtml(""),this.$nextTick((function(){e.checkShowMoreDesc(!1,!0)}))},doContent:function(){var t=this,e=this.$refs.vueWangeditor.getHtml(),s={taskCode:this.code,description:e};Object(n["c"])(s).then((function(){t.task.description=e,t.showTaskDescriptionEdit=!1,t.$nextTick((function(){t.checkShowMoreDesc(!1,!0)})),t.getTaskLog()}))},createComment:function(){var t=this,e=this.comment.trim();if(!e)return!1;e+=" ";var s=/(@[^@]+) /g,a=e.match(s);a&&a.forEach((function(e){var s=e.substring(1,e.length-1);-1===t.mentionsList.findIndex((function(t){return t==s}))&&t.mentionsList.push(s)})),Object(n["a"])(this.code,this.comment,JSON.stringify(this.mentionsList)).then((function(){t.comment="",t.mentionsList=[],t.getTaskLog()}))},checkShowMoreDesc:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=$(".description-txt");if(e||(t?(this.showMoreDesc=!0,s.css("max-height",(function(){return"100%"}))):(this.showMoreDesc=!1,s.css("max-height",(function(){return"300px"})))),e){var a=s.height();return a>=300?(this.hasMoreDesc=!0,!0):(this.hasMoreDesc=!1,!1)}return!1},createTask:function(){var t=this,e={pcode:this.code,name:this.childTaskName};this.childExecutor&&(e.assign_to=this.childExecutor.code),Object(n["j"])(e).then((function(e){var s=Object(v["a"])(e);if(!s)return!1;t.childTaskName="",t.getChildTasks(),t.getTaskLog()}))},getChildTasks:function(){var t=this;Object(n["e"])({pcode:this.code,pageSize:100,deleted:0}).then((function(e){var s=[];e.data.list.forEach((function(t){t.visibleChildTaskMemberMenu=!1,s.push(t)})),t.childTaskList=s}))},taskTagChange:function(t){var e=this.task.tags.findIndex((function(e){return e.tag_code==t.code}));-1!==e?this.task.tags.splice(e,1):this.task.tags.push({tag_code:t.code,tag:t})},taskTagUpdate:function(t){var e=this.task.tags.findIndex((function(e){return e.tag_code==t.code}));-1!==e&&(this.task.tags[e].tag=t)},taskTagDelete:function(t){var e=this.task.tags.findIndex((function(e){return e.tag_code==t.code}));-1!==e&&this.task.tags.splice(e,1)},removeTag:function(t,e){var s=this;Object(f["q"])({taskCode:this.task.code,tagCode:t.code}).then((function(){s.task.tags.splice(e,1)}))},doPlainWorkTime:function(){var t=this;this.plainWorkTime.modalStatus=!0,this.$nextTick((function(){t.plainWorkTime.form.setFieldsValue({work_time:t.task.work_time})}))},doWorkTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this;this.workTimeDo.modalStatus=!0,t?(this.workTimeDo.info=t,this.$nextTick((function(){e.workTimeDo.form.setFieldsValue({num:t.num,begin_time:moment(t.begin_time),content:t.content})}))):(this.workTimeDo.form.resetFields(),this.workTimeDo.info=null)},deleteWorkTime:function(t,e){var s=this;this.$confirm({title:"删除工时记录",content:"确定要删除工时记录吗？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(f["f"])({code:t.code}).then((function(a){Object(v["a"])(a)&&(s.workTimeList.splice(e,1),s.workTimeTotal-=t.num)})),Promise.resolve()}})},workTimePlainHandleSubmit:function(){var t=this;this.plainWorkTime.form.validateFields((function(e,s){e||(t.editTask({work_time:s.work_time}),t.plainWorkTime.modalStatus=!1)}))},workTimeHandleSubmit:function(){var t=this;this.workTimeDo.form.validateFields((function(e,s){if(!e){t.workTimeDo.confirmLoading=!0;var a={beginTime:s.begin_time.format("YYYY-MM-DD HH:mm"),num:s.num,content:s.content,taskCode:t.code};t.workTimeDo.info?(a.code=t.workTimeDo.info.code,Object(f["g"])(a).then((function(e){t.workTimeDo.confirmLoading=!1,Object(v["a"])(e)&&(t.workTimeDo.modalStatus=!1,t.getTaskWorkTimeList())}))):Object(f["n"])(a).then((function(e){t.workTimeDo.confirmLoading=!1,Object(v["a"])(e)&&(t.workTimeDo.modalStatus=!1,t.getTaskWorkTimeList())}))}}))},checkLink:function(t){var e=/(http:\/\/|https:\/\/)((\w|=|\?|\.|\/|&|-)+)/g;return e.exec(t)?(t=t.replace(e,"<a target='_blank' href='$1$2'>$1$2</a>"),t):t},updateChildExecutor:function(t){this.visibleChildTaskMemberMenu=!1,this.childExecutor=t},getPopup:function(){return document.getElementById("footer")},getTaskMemberPopup:function(){return document.getElementById("task-detail")},departmentMemberDetail:function(t){var e=this;Object(b["a"])({code:t,organization:this.$store.state.currentOrganization.code}).then((function(t){e.departmentMemberInfo=t.data}))},selectMentionMember:function(t){var e=this;this.showMentions=!1,this.comment+=t.name+" ",this.$nextTick((function(){e.$refs.commentText.focus()}))},changeModalHeight:function(){var t=this.width,e=$(window).width()-100,s=$(window).height()-150,a=$(window).height()-315;"full-screen"===t||void 0!==this.$route.query["full-screen"]?($(".task-detail-modal").css("width",$(window).width()),$(".task-detail").css("width",$(window).width()),$(".ant-modal").css("top",0),s+=85,a+=85,$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",a+"px")):(e>t&&(e=t),$(".task-detail").css("width",e),$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",a+"px"))}}}},e37d:function(t,e,s){"use strict";var a=s("d077"),i=s.n(a);i.a}}]);