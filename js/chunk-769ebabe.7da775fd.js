(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-769ebabe","chunk-1dff8eba","chunk-1dff8eba"],{"24d2":function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"c",(function(){return o})),s.d(e,"b",(function(){return n}));var i=s("22b6");function a(t){return i["a"].post("project/project",t)}function o(t){return i["a"].post("project/project/selfList",t)}function n(t){return i["a"].post("project/project/read",{projectCode:t})}},"523b":function(t,e,s){"use strict";var i=s("9b30"),a=s.n(i);a.a},7934:function(t,e,s){"use strict";var i=s("d22a"),a=s.n(i);a.a},"9b30":function(t,e,s){},beeb:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"version-detail"},[s("a-spin",{staticClass:"version-detail-spin",attrs:{spinning:t.loading}},[s("div",{staticClass:"task-header"},[s("span",{staticClass:"head-title"},[s("span",[t._v(t._s(t.version.featureName))])]),s("span",{staticClass:"header-action text-right"},[[s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleTaskMenu,callback:function(e){t.visibleTaskMenu=e},expression:"visibleTaskMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("打开菜单")])]),s("a",{staticClass:"action-item muted"},[s("a-icon",{attrs:{type:"ellipsis"}})],1)],2),s("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay"},on:{click:t.doVersion},slot:"overlay"},[s("a-menu-item",{key:"delete"},[s("a-icon",{attrs:{type:"delete"}}),s("span",[t._v("删除版本")])],1)],1)],1)],s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("关闭面板")])]),s("a",{staticClass:"action-item muted",on:{click:t.detailClose}},[s("a-icon",{attrs:{type:"close"}})],1)],2)],2)]),s("div",{staticClass:"task-wrap"},[s("div",{staticClass:"task-content"},[s("div",{staticClass:"content-left"},[s("vue-scroll",{attrs:{ops:t.scrollOps}},[s("div",{staticClass:"task-title",class:{disabled:t.disableEdit}},[s("a-input",{directives:[{name:"show",rawName:"v-show",value:t.showEditName,expression:"showEditName"}],ref:"inputTitle",attrs:{"auto-focus":"",size:"large"},on:{blur:t.doName},model:{value:t.version.name,callback:function(e){t.$set(t.version,"name",e)},expression:"version.name"}}),t.disableEdit?s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text"},[t._v(t._s(t.version.name))]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击即可编辑")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showEditName,expression:"!showEditName"}],staticClass:"title-text",on:{click:t.editTitle}},[t._v(t._s(t.version.name))])],2)],1),s("div",{staticClass:"task-basic-attrs-view muted"},[s("div",{staticClass:"field-list",class:{disabled:t.disableEdit}},[s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"check-square"}}),s("span",{staticClass:"field-name"},[t._v("状态")])],1),s("div",{staticClass:"field-right"},[s("a-dropdown",{class:{disabled:t.task.hasUnDone},attrs:{placement:"bottomCenter",trigger:["click"],disabled:!!t.task.deleted||!!t.task.hasUnDone}},[s("a-tooltip",{attrs:{placement:"top"}},[s("template",{slot:"title"},[t.disableEdit?s("span",{staticStyle:{"font-size":"12px"}},[t._v("版本已发布，不能编辑")]):t._e()]),s("span",[s("span",{staticClass:"version-status",class:"status-"+t.version.status},[s("a-icon",{attrs:{type:"schedule"}}),s("span",{staticClass:"m-l-xs"},[t._v("\n                                "+t._s(t.version.statusText)+"\n                              ")])],1)])],2),s("a-menu",{directives:[{name:"show",rawName:"v-show",value:!t.disableEdit,expression:"!disableEdit"}],staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:t.changeVersionStatus},slot:"overlay"},[s("a-menu-item",{key:"0"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",[t._v("未开始")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:0==t.version.status,expression:"version.status == 0"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"1"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"blue"}},[t._v("进行中")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:1==t.version.status,expression:"version.status == 1"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"2"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"red"}},[t._v("延期发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:2==t.version.status,expression:"version.status == 2"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),s("a-menu-item",{key:"3"},[s("div",{staticClass:"menu-item-content"},[s("a-tag",{attrs:{color:"green"}},[t._v("已发布")]),s("a-icon",{directives:[{name:"show",rawName:"v-show",value:3==t.version.status,expression:"version.status == 3"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"calendar"}}),s("span",{staticClass:"field-name"},[t._v("开始时间")])],1),s("div",{staticClass:"field-right field-date"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:t.disableEdit},model:{value:t.showStartTime,callback:function(e){t.showStartTime=e},expression:"showStartTime"}},[t.disableEdit?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setStartTime?[t._v("\n                              "+t._s(t.version.start_time_format)+"\n                            ")]:[t._v("设置开始时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置开始时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setStartTime?[t._v("\n                                "+t._s(t.version.start_time_format)+"\n                              ")]:[t._v("设置开始时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showStartTime},on:{ok:function(e){return t.doStartTime(!0)}},model:{value:t.version.start_time,callback:function(e){t.$set(t.version,"start_time",e)},expression:"version.start_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doStartTime(!1)}}},[t._v("清除")])])],2)],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"calendar"}}),s("span",{staticClass:"field-name"},[t._v("发布时间")])],1),s("div",{staticClass:"field-right field-date"},[s("a-dropdown",{attrs:{trigger:["click"],disabled:t.disableEdit},model:{value:t.showPlanPublishTime,callback:function(e){t.showPlanPublishTime=e},expression:"showPlanPublishTime"}},[t.disableEdit?s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setPlanPublishTime?[t._v("\n                              "+t._s(t.version.plan_publish_time_format)+"\n                            ")]:[t._v("设置发布时间")]],2)]):s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v("点击设置发布时间")])]),s("div",{staticClass:"field-flex"},[s("a",{staticClass:"muted name",staticStyle:{margin:"0"}},[t.version.setPlanPublishTime?[t._v("\n                                "+t._s(t.version.plan_publish_time_format)+"\n                              ")]:[t._v("设置发布时间")]],2)])],2),s("div",{attrs:{slot:"overlay"},slot:"overlay"},[s("a-date-picker",{attrs:{size:"small",format:"MM月DD日 HH:mm",showTime:"",allowClear:"",showToday:!1,open:t.showPlanPublishTime},on:{ok:function(e){return t.doPlanPublishTime(!0)}},model:{value:t.version.plan_publish_time,callback:function(e){t.$set(t.version,"plan_publish_time",e)},expression:"version.plan_publish_time"}},[s("template",{slot:"renderExtraFooter"},[s("a",{staticStyle:{position:"absolute"},attrs:{size:"small"},on:{click:function(e){return t.doPlanPublishTime(!1)}}},[t._v("清除")])])],2)],1)],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"fire"}}),s("span",{staticClass:"field-name"},[t._v("完成进度")])],1),s("div",{staticClass:"field-right width-block"},[s("a-tooltip",{attrs:{placement:"top",mouseEnterDelay:.3,title:"系统自动统计当前版本的完成进度"}},[s("a-progress",{attrs:{strokeWidth:4,percent:t.version.schedule}})],1)],1)])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"file-text"}}),s("span",{staticClass:"field-name"},[t._v("备注")])],1),s("div",{staticClass:"field-right width-block"},[s("div",{directives:[{name:"show",rawName:"v-show",value:!t.showVersionDescriptionEdit,expression:"!showVersionDescriptionEdit"}],staticClass:"task-description",class:{disabled:t.disableEdit},on:{click:t.showVersionDesc}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.version.description,expression:"version.description"}],staticClass:"description-txt",domProps:{innerHTML:t._s(t.version.description)}}),s("span",{directives:[{name:"show",rawName:"v-show",value:!t.version.description,expression:"!version.description"}]},[t._v("添加备注")])]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showVersionDescriptionEdit,expression:"showVersionDescriptionEdit"}]},[s("a-input",{attrs:{type:"textarea"},model:{value:t.version.description,callback:function(e){t.$set(t.version,"description",e)},expression:"version.description"}}),s("div",{staticClass:"action-btn pull-right"},[s("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showVersionDescriptionEdit=!1}}},[t._v("取消")]),s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"},on:{click:t.doContent}},[t._v("保存")])],1)],1)])])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"field-left"},[s("a-icon",{attrs:{type:"bars"}}),s("span",{staticClass:"field-name"},[t._v("\n                        发布内容\n                        "),s("span",{directives:[{name:"show",rawName:"v-show",value:!1!==t.versionTaskSchedule,expression:"versionTaskSchedule !== false"}]},[t._v("\n                          · "+t._s(t.versionTaskDoneNum)+"/"+t._s(t.versionTaskList.length)+"\n                        ")])])],1),s("div",{staticClass:"field-right width-block"})])]),s("div",{staticClass:"component-mount"},[s("div",{staticClass:"field"},[s("div",{staticClass:"block-field width-block"},[s("div",{staticClass:"task-child"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.versionTaskList.length,expression:"versionTaskList.length"}],staticClass:"task-list"},t._l(t.versionTaskList,(function(e,i){return s("div",{key:e.code},[s("div",{staticClass:"list-item task"},[s("div",{staticClass:"check-box-wrapper task-item",on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[s("a-icon",{staticClass:"check-box disabled",style:{fontSize:"16px"},attrs:{type:e.done?"check-square":"border"}})],1),s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[e.executor?s("span",[t._v("\n                                    "+t._s(e.executor.name)+"\n                                  ")]):s("span",[t._v("待认领")])]),s("div",{on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[e.executor?s("a-avatar",{staticClass:"task-item",attrs:{size:"small",icon:"user",src:e.executor.avatar}}):s("a-avatar",{staticClass:"task-item",attrs:{size:"small",icon:"user"}})],1)],2),s("div",{staticClass:"task-item task-title",on:{click:function(s){return s.stopPropagation(),t.showTaskDetail(e)}}},[s("div",{staticClass:"title-text"},[t._v(t._s(e.name))])]),s("span",{staticClass:"m-r muted"},[e.done?s("span",{staticClass:"text-success"},[t._v("已完成")]):s("span",[t._v("未完成")])]),s("a",{staticClass:"muted",on:{click:function(s){return s.stopPropagation(),t.removeVersionTask(e)}}},[s("a-icon",{staticClass:"task-item",attrs:{type:"delete"}})],1)],1)])})),0),s("a-tooltip",{attrs:{placement:"top"}},[s("a",{directives:[{name:"show",rawName:"v-show",value:!t.showChildTask,expression:"!showChildTask"}],staticClass:"add-handler",class:{disabled:t.disableEdit},on:{click:t.getTaskStages}},[s("a-icon",{staticStyle:{"margin-right":"6px"},attrs:{type:"plus"}}),t._v("添加发布内容\n                          ")],1)])],1)])])])])])])],1),s("div",{staticClass:"content-right"},[s("div",{staticClass:"log-wrap"},[s("div",{staticClass:"header"},[s("span",{staticClass:"text-default"},[t._v("所有动态")])]),s("vue-scroll",[s("div",{staticClass:"log-list muted"},[s("a",{directives:[{name:"show",rawName:"v-show",value:t.checkShowMoreLog,expression:"checkShowMoreLog"}],staticClass:"show-more muted",on:{click:t.getMoreVersionLog}},[s("a-icon",{attrs:{type:"ellipsis"}}),t._v("\n                  显示较早的 "+t._s(t.versionLogTotal-t.versionLog.length)+" 条动态\n                ")],1),t._l(t.versionLog,(function(e){return s("div",{key:e.code,staticClass:"list-item"},[[s("a-icon",{staticClass:"log-item",attrs:{type:e.icon}}),s("div",{staticClass:"log-item log-txt"},[s("div",[t._v("\n                        "+t._s(e.member.name)+"\n                        "),s("span",{domProps:{innerHTML:t._s(e.remark)}})]),e.content?s("div",{staticClass:"log-content",domProps:{innerHTML:t._s(e.content)}}):t._e()])],s("a-tooltip",{attrs:{mouseEnterDelay:.5}},[s("template",{slot:"title"},[s("span",[t._v(t._s(e.create_time))])]),s("span",{staticClass:"log-item"},[t._v("\n                      "+t._s(t._f("formatLogTime")(e.create_time))+"\n                    ")])],2)],2)}))],2)])],1)])])])]),s("a-modal",{attrs:{destroyOnClose:"",width:360,title:"实际发布时间",bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.publishVersion.modalStatus,callback:function(e){t.$set(t.publishVersion,"modalStatus",e)},expression:"publishVersion.modalStatus"}},[s("a-form",{attrs:{form:t.publishVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitPublishVersion(e)}}},[s("a-form-item",[s("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["publishTime"],expression:"['publishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择实际发布时间"}})],1),s("a-form-item",[s("div",{staticClass:"action-btn"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.publishVersion.confirmLoading}},[t._v("确认发布")])],1)])],1)],1),s("a-modal",{staticClass:"publish-task-modal",attrs:{destroyOnClose:"",width:800,title:"规划发布内容",footer:null},model:{value:t.publishTask.modalStatus,callback:function(e){t.$set(t.publishTask,"modalStatus",e)},expression:"publishTask.modalStatus"}},[s("div",[s("p",{directives:[{name:"show",rawName:"v-show",value:t.publishTask.selectTaskList.length,expression:"publishTask.selectTaskList.length"}]},[t._v("\n        已选择\n        "),s("span",{staticClass:"text-warning"},[t._v("\n          "+t._s(t.publishTask.selectTaskList.length)+"\n        ")]),t._v("\n        项\n      ")]),s("p",{directives:[{name:"show",rawName:"v-show",value:!t.publishTask.selectTaskList.length,expression:"!publishTask.selectTaskList.length"}],staticClass:"muted"},[t._v("请勾选需要发布的内容")])]),s("vue-scroll",[s("div",{staticClass:"publish-task"},[s("a-checkbox-group",{model:{value:t.publishTask.selectTaskList,callback:function(e){t.$set(t.publishTask,"selectTaskList",e)},expression:"publishTask.selectTaskList"}},t._l(t.publishTask.taskStages,(function(e,i){return s("div",{key:i,staticClass:"m-b"},[s("strong",[t._v(t._s(e.name))]),s("a-list",{staticClass:"publish-task-list",attrs:{loading:e.tasksLoading,itemLayout:"horizontal",dataSource:e.tasks},scopedSlots:t._u([{key:"renderItem",fn:function(e,i){return s("a-list-item",{},[s("a-list-item-meta",[s("div",{class:{muted:e.version_code},attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),s("div",{attrs:{slot:"avatar"},slot:"avatar"},[s("a-checkbox",{attrs:{value:e.code}})],1)])],1)}}],null,!0)})],1)})),0)],1)]),s("div",{staticClass:"footer-item text-right m-t"},[s("a-button",{staticClass:"middle-btn",attrs:{type:"primary",size:"large"},on:{click:t.addVersionTask}},[t._v("保存")])],1)],1),s("a-modal",{staticClass:"task-detail-modal",attrs:{destroyOnClose:"",width:"min-content",closable:!1,title:"",footer:null},on:{cancel:t.taskDetailClose},model:{value:t.showTaskDetailModal,callback:function(e){t.showTaskDetailModal=e},expression:"showTaskDetailModal"}},[s("task-detail",{attrs:{taskCode:t.taskCode},on:{close:t.taskDetailClose}})],1)],1)},a=[],o=(s("8e6e"),s("456d"),s("ac6a"),s("7f7f"),s("bd86")),n=(s("c5f6"),s("5880")),r=s("009f"),l=s("bc5b"),c=s("81fe"),d=s("2f14"),u=s("9f09"),m=s("97a8");function h(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function v(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?h(Object(s),!0).forEach((function(e){Object(o["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):h(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var p={name:"version-detail",components:{taskDetail:r["default"]},props:{versionCode:{type:[String],default:function(){return""}},width:{type:[String,Number],default:function(){return"1200"}}},data:function(){return{loading:!1,code:this.versionCode,projectCodeCurrent:"",task:{},showTaskDetailModal:!1,taskCode:"",version:{},visibleTaskMenu:!1,versionName:"",showEditName:!1,showStartTime:!1,showPlanPublishTime:!1,showVersionDescriptionEdit:!1,versionTaskList:[],showChildTask:!1,versionLogTotal:0,versionLog:[],publishVersionForm:this.$form.createForm(this),publishVersion:{modalStatus:!1,confirmLoading:!1,status:-1},showMoreTaskLog:0,hasMoreVersionLog:!1,hideShowMore:!1,publishTask:{modalStatus:!1,confirmLoading:!1,loading:!1,selectTaskList:[],taskStages:[]}}},computed:v({},Object(n["mapState"])({userInfo:function(t){return t.userInfo}}),{disableEdit:function(){return 3==this.version.status},versionTaskDoneNum:function(){var t=this.versionTaskList.filter((function(t){return 1==t.done}));return t.length},checkShowMoreLog:function(){return!this.hideShowMore&&this.versionLogTotal>5},versionTaskSchedule:function(){return!!this.versionTaskList.length&&this.versionTaskDoneNum/this.versionTaskList.length*100},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){}},created:function(){this.init()},mounted:function(){var t=this,e=arguments;this.changeModalHeight(),window.onresize=function(){return function(){t.changeModalHeight()}()},document.onkeydown=function(s){var i=s||window.event||e.callee.caller.arguments[0];13==i.keyCode&&i.ctrlKey&&t.createComment()}},filters:{formatLogTime:function(t){return Object(c["c"])(t)}},methods:{init:function(){this.loading=!0,this.getVersion(),this.getVersionTask()},detailClose:function(){this.$emit("close",this.version)},getVersion:function(){var t=this;Object(l["h"])({versionCode:this.code}).then((function(e){t.getVersionLog(),t.version=e.data,t.versionName=e.data.name,t.version.start_time?(t.version.setStartTime=!0,t.version.start_time=moment(t.version.start_time)):(t.version.setStartTime=!1,t.version.start_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.version.start_time_format=Object(c["b"])(t.version.start_time,!0),t.version.plan_publish_time?(t.version.setPlanPublishTime=!0,t.version.plan_publish_time=moment(t.version.plan_publish_time)):(t.version.setPlanPublishTime=!1,t.version.plan_publish_time=moment(moment().format("YYYY-MM-DD")+" 18:00")),t.version.plan_publish_time_format=Object(c["b"])(t.version.plan_publish_time,!0),t.loading=!1}))},getVersionTask:function(){var t=this;Object(l["f"])({versionCode:this.code}).then((function(e){t.versionTaskList=e.data}))},getVersionLog:function(){var t=this;Object(l["e"])({versionCode:this.code,all:this.showMoreVersionLog,pageSize:5}).then((function(e){t.versionLog=e.data.list,t.versionLogTotal=e.data.total,e.data.total>5&&(t.hasMoreVersionLog=!0)}))},getMoreVersionLog:function(){this.showMoreVersionLog=1,this.hideShowMore=!0,this.getVersionLog()},getTaskStages:function(){var t=this;if(this.disableEdit)return!1;this.publishTask.modalStatus=!0,this.publishTask.loading=!0,Object(u["d"])({projectCode:this.version.projectCode,pageSize:30}).then((function(e){t.publishTask.taskStages=e.data.list,t.publishTask.taskStages&&t.publishTask.taskStages.forEach((function(t){Object(u["g"])({stageCode:t.code}).then((function(e){t.tasksLoading=!1,t.tasks=e.data}))})),t.changeModalHeight(),t.publishTask.loading=!1}))},showTaskDetail:function(t){this.showTaskDetailModal=!0,this.taskCode=t.code},taskDetailClose:function(){this.init(),this.showTaskDetailModal=!1,this.taskCode=""},doVersion:function(t){var e=this,s=t.key;switch(s){case"delete":this.$confirm({title:"删除版本",content:"删除版本后，发布内容的版本字段将被清空，是否确定删除？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(l["c"])({versionCode:e.code}).then((function(t){var s=Object(d["a"])(t);if(!s)return!1;e.detailClose()})),Promise.resolve()}});break}this.visibleTaskMenu=!1},editTitle:function(){var t=this;this.showEditName=!0,this.$nextTick((function(){t.$refs.inputTitle.focus()}))},deleteTask:function(){var t=this;this.$confirm({title:"彻底删除",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(l["c"])(t.code).then((function(e){t.detailClose()})),Promise.resolve()}})},changeVersionStatus:function(t){var e=this,s=this;if(t.key==this.version.code||3==this.version.status)return!1;3==t.key?this.$confirm({title:"发布提示",content:"请确认当前版本发布内容已全部完成后再发布。",okText:"确认发布",okType:"primary",onOk:function(){return s.publishVersion.status=t.key,s.publishVersion.modalStatus=!0,s.$nextTick((function(){s.publishVersionForm.setFieldsValue({publishTime:moment()})})),Promise.resolve()}}):Object(l["b"])({versionCode:this.version.code,status:t.key}).then((function(t){e.getVersion()}))},handleSubmitPublishVersion:function(){var t=this,e=this;e.publishVersionForm.validateFields((function(s){if(!s){var i=e.publishVersionForm.getFieldsValue();i.publishTime=moment(i.publishTime).format("YYYY-MM-DD HH:mm"),Object(l["b"])({versionCode:t.code,status:t.publishVersion.status,publishTime:i.publishTime}).then((function(t){e.publishVersion.modalStatus=!1,e.getVersion()}))}}))},doStartTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.version.setStartTime=t,this.showStartTime=e;var s="";t?(s=moment(this.version.start_time).format("YYYY-MM-DD HH:mm"),this.version.start_time_format=moment(this.version.start_time).format("MM月DD日 HH:mm")):s="",this.editVersion({start_time:s})},doPlanPublishTime:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.version.setPlanPublishTime=t,this.showPlanPublishTime=e;var s="";t?(s=moment(this.version.plan_publish_time).format("YYYY-MM-DD HH:mm"),this.version.plan_publish_time_format=moment(this.version.plan_publish_time).format("MM月DD日 HH:mm")):s="",this.editVersion({plan_publish_time:s})},doName:function(){if(this.showEditName=!1,!this.version.name.trim()||this.version.name==this.versionName)return this.version.name=this.versionName,!1;this.editVersion({name:this.version.name})},editVersion:function(t){var e=this;t.versionCode=this.code,Object(l["d"])(t).then((function(t){var s=Object(d["a"])(t);if(!s)return!1;e.getVersion()}))},showVersionDesc:function(){if(this.disableEdit)return!1;this.showVersionDescriptionEdit=!0},doContent:function(){var t=this.version.description;this.editVersion({description:t}),this.showVersionDescriptionEdit=!1},addVersionTask:function(){var t=this;Object(l["a"])({taskCodeList:JSON.stringify(this.publishTask.selectTaskList),versionCode:this.code}).then((function(e){Object(m["b"])({title:"成功添加 ".concat(e.data.successTotal," 项发布内容到版本")},"notice","success"),t.publishTask.modalStatus=!1,t.publishTask.selectTaskList=[],t.init()}))},removeVersionTask:function(t){var e=this;this.$confirm({title:"移除发布内容",content:"确定移除这个发布内容？",okText:"确定",okType:"danger",cancelText:"再想想",onOk:function(){return Object(l["i"])({taskCode:t.code}).then((function(t){var s=Object(d["a"])(t);if(!s)return!1;e.init()})),Promise.resolve()}})},changeModalHeight:function(){var t=this.width,e=$(window).width()-100,s=$(window).height()-150,i=$(window).height()-200,a=$(window).height()-255;"full-screen"===t||void 0!==this.$route.query["full-screen"]?($(".task-detail-modal").css("width",$(window).width()),$(".version-detail").css("width",$(window).width()),$(".ant-modal").css("top",0),s+=85,i+=85,$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",i+"px")):(e>t&&(e=t),$(".version-detail").css("width",e),$(".content-left").css("height",s+"px"),$(".log-wrap").css("height",i+"px"),$(".publish-task").css("height",a+"px"))}}},f=p,b=(s("523b"),s("2877")),k=Object(b["a"])(f,i,a,!1,null,null,null);e["default"]=k.exports},d22a:function(t,e,s){},f8c7:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.currentProject?s("div",{attrs:{id:"project-select"}},[s("a-dropdown",{staticClass:"action-item",attrs:{trigger:["click"],placement:"bottomCenter"},model:{value:t.visibleMenu,callback:function(e){t.visibleMenu=e},expression:"visibleMenu"}},[s("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.currentProject.name}},[s("a",{staticClass:"project-select",staticStyle:{color:"#333"},on:{click:function(e){t.visibleMenu=!0}}},[s("span",[t._v(t._s(t.currentProject.name))]),s("span",{staticClass:"m-l-xs"},[s("a-icon",{attrs:{type:"down"}})],1)])]),s("div",{staticClass:"middle-menu member-menu project-select-menu",attrs:{slot:"overlay"},slot:"overlay"},[s("div",{staticClass:"search-content"},[s("a-input",{attrs:{size:"large",placeholder:"搜索"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[s("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),s("div",{staticClass:"member-list"},[s("vue-scroll",[s("div",{staticClass:"list-group"},[s("a-list",{staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.projectList,locale:{emptyText:t.keyword&&t.keyword.length>1?"没有找到该项目":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return s("a-list-item",{staticClass:"member-list-item",nativeOn:{click:function(s){return t.changeProject(e.code)}}},[s("span",{attrs:{slot:"actions"},slot:"actions"},[s("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e.code),expression:"showCheck(item.code)"}],attrs:{type:"check"}})],1),s("a-list-item-meta",[s("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),s("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.cover},slot:"avatar"})],1)],1)}}],null,!1,3141279394)})],1)])],1)])],1)],1):t._e()},a=[],o=(s("8e6e"),s("ac6a"),s("456d"),s("7f7f"),s("386d"),s("bd86")),n=s("2ef0"),r=s.n(n),l=s("5880"),c=s("24d2"),d=s("1b80");function u(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function m(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?u(Object(s),!0).forEach((function(e){Object(o["a"])(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):u(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var h={name:"ProjectSelect",props:{code:{type:[String],default:function(){return""}}},data:function(){return{visibleMenu:!1,keyword:"",loading:!1,currentProject:null,projectList:[],projectListCopy:[],projectTotal:0}},mixins:[d["a"]],computed:m({},Object(l["mapState"])({currentOrganization:function(t){return t.currentOrganization},organizationList:function(t){return t.organizationList}})),watch:{code:function(){this.init()},keyword:function(){this.search()}},created:function(){this.init()},methods:{init:function(){this.getProject(),this.getProjectList(!0)},getProject:function(){var t=this;Object(c["b"])(this.code).then((function(e){t.currentProject=e.data}))},getProjectList:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=e,this.requestData.pageSize=50,this.requestData.archive=-1,Object(c["c"])(this.requestData).then((function(e){t.projectList=e.data.list,t.projectListCopy=e.data.list,t.projectTotal=e.data.total,t.loading=!1}))},changeProject:function(t){this.visibleMenu=!1,this.$router.push("/project/space/task/"+t)},showCheck:function(t){if(t==this.code)return!0},search:r.a.debounce((function(){var t=this;if(this.keyword=this.keyword.trim(),this.keyword||(this.projectList=JSON.parse(JSON.stringify(this.projectListCopy))),this.keyword.length<=1)return!1;this.projectList=this.projectList.filter((function(e){return-1!=e.name.indexOf(t.keyword)}))}),500),getPopup:function(){return document.getElementById("project-select")}}},v=h,p=(s("7934"),s("2877")),f=Object(p["a"])(v,i,a,!1,null,null,null);e["default"]=f.exports}}]);