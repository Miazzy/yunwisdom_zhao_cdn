(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f54813c0","chunk-4410a403","chunk-4410a403"],{"0610":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"d",(function(){return r})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return c}));var s=a("22b6"),o=a("2f14");function n(t){return s["a"].post("project/file",t)}function r(){return Object(o["c"])("project/file/uploadFiles")}function i(t){return s["a"].post("project/file/recovery",{fileCode:t})}function c(t){return s["a"].post("project/file/delete",{fileCode:t})}},"64a8":function(t,e,a){"use strict";var s=a("b625"),o=a.n(s);o.a},"8dea":function(t,e,a){"use strict";a("8e6e"),a("456d"),a("28a5"),a("55dd"),a("ac6a"),a("7f7f");var s=a("bd86"),o=a("5880"),n=a("2ef0"),r=a.n(n),i=a("310e"),c=a.n(i),l=a("f8c7"),d=a("d3a1"),u=a("58bf"),p=a("51e2"),m=a("e3cc"),f=a("1d80"),g=a("9f09"),h=a("6be7"),k=a("c030"),v=a("ca8d"),b=a("2f14"),C=a("81fe"),w=a("e55b"),j=a("97a8");function y(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,s)}return a}function _(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?y(Object(a),!0).forEach((function(e){Object(s["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e["a"]={name:"project-space-task",components:{RecycleBin:p["default"],TaskTag:m["default"],draggable:c.a,projectSelect:l["default"],TaskSearch:f["default"],inviteProjectMember:d["default"],projectConfig:u["default"]},data:function(){return{code:this.$route.params.code,loading:!0,project:{task_board_theme:"simple"},stageName:"",task:{},taskStages:[],defaultExecutor:{},projectMembers:[],projectMembersCopy:[],createTaskLoading:!1,showCreateStage:!1,preCode:"",nextCode:"",taskSearchParams:{},stageKeys:[],stageModal:{form:this.$form.createForm(this),stageCode:"",stageIndex:0,modalStatus:!1,confirmLoading:!1,modalTitle:"编辑列表"},slideMenuKey:"",showInviteMember:!1,inviteMemberDraw:{visible:!1,keyword:"",searching:!1,list:[]},configDraw:{visible:!1},taskSearch:{visible:!1},downLoadUrl:Object(b["h"])("project/task/_downloadTemplate"),uploadLoading:!1,uploadAction:Object(b["c"])("project/task/uploadFile"),projectModal:{modalStatus:!1,modalTitle:"项目设置"},recycleModal:{modalStatus:!1,modalTitle:"查看回收站"},taskTagModal:{modalStatus:!1,modalTitle:"任务标签"},projectMemberModal:{loading:!1,currentStageIndex:0,modalStatus:!1,modalTitle:"设置任务执行者"}}},computed:_({},Object(o["mapState"])({userInfo:function(t){return t.userInfo},viewRefresh:function(t){return t.common.viewRefresh},socketAction:function(t){return t.socketAction}}),{headers:function(){return Object(b["d"])()},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){var a=this;if(this.code!=t.params.code&&(this.code=t.params.code,this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()),"taskdetail"==e.name){var s=e.query.from;if(void 0!=s){var o=this.taskSearchParams,n=Object.assign({stageCode:this.taskStages[s].code},o);Object(g["g"])(n).then((function(t){a.taskStages[s].tasksLoading=!1,a.taskStages[s].tasks=t.data;var e=a.taskStages[s].doneTasks=[],o=a.taskStages[s].unDoneTasks=[];t.data.forEach((function(t){t.done?e.push(t):o.push(t)}))}))}}},socketAction:function(t){if("organization:task"===t.action){var e=t.data.data;e.projectCode==this.code&&this.getTaskStages(!1)}},viewRefresh:function(){console.log("viewRefresh")},inviteMemberDraw:{handler:function(t){t.visible?this.slideMenuKey="member":this.slideMenuKey=!1,t.keyword&&this.searchInviteMember()},deep:!0},configDraw:{handler:function(t){t.visible?this.slideMenuKey="config":this.slideMenuKey=!1},deep:!0},showInviteMember:function(t){t||this.getProjectMembers()}},created:function(){this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()},methods:{init:function(){this.getTaskStages()},getProject:function(){var t=this;this.loading=!0,Object(h["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data}))},getProjectMembers:function(){var t=this;Object(k["c"])({projectCode:this.code,pageSize:100}).then((function(e){t.projectMembers=e.data.list,t.projectMembersCopy=e.data.list}))},getTaskStages:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=this;Object(g["d"])({projectCode:this.code,pageSize:30}).then((function(s){var o=[];if(e?t.taskStages=o=s.data.list:s.data.list.forEach((function(t){t.tasksLoading=!1,o.push(t)})),o){var n=a.taskSearchParams,r={};o.forEach((function(t,s){r={stageCode:t.code},r=Object.assign(r,n),Object(g["g"])(r).then((function(o){var n=0;o.data.forEach((function(e){e.canRead||n++,e.done?t.doneTasks.push(e):t.unDoneTasks.push(e)})),t.canNotReadCount=n,t.tasksLoading=!1,t.tasks=o.data,e||a.$set(a.taskStages,s,t)}))}))}}))},filterTask:function(t,e){return t.filter((function(t){return t.done==e}))},taskSearchAction:function(t){console.log(t),this.taskSearchParams=t,this.getTaskStages()},showTaskCard:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.taskStages.forEach((function(t){t.showTaskCard=!1})),!1===e)return!1;this.taskStages[e].showTaskCard=a,this.$nextTick((function(){t.$refs[e+"-stage"][0].scrollIntoView("#card"+e),t.$refs["inputTaskName".concat(e)][0].focus()}))},selectExecutor:function(t){var e=t.key;this.defaultExecutor=this.projectMembers[e]},createTask:function(t,e){if(!this.task.name)return this.$message.warning("任务内容不能为空",2),!1;this.task.stage_code=t,this.task.project_code=this.code,this.task.assign_to=this.defaultExecutor.code,this.confirmCreateTask(e)},confirmCreateTask:function(t){var e=this;if(e.createTaskLoading)return e.$message.warning("正在添加任务，请稍后...",2),!1;setTimeout((function(){!0===e.createTaskLoading&&e.$message.loading({content:"正在添加任务，请稍后...",duration:5})}),2e3),e.createTaskLoading=!0,Object(v["m"])(e.task).then((function(a){e.createTaskLoading=!1;var s=Object(b["a"])(a);if(s){e.$message.destroy();var o=e.taskStages[t];o.tasks.push(a.data),e.taskStages[t].unDoneTasks.push(a.data),e.task={}}})).catch((function(){e.createTaskLoading=!1}))},taskDone:function(t,e,a,s){var o=this,n=null,r=this.taskStages[e].unDoneTasks,i=this.taskStages[e].doneTasks;if(n=s?r[a]:i[a],n.hasUnDone)return!1;n.done=s,s?(r.splice(a,1),i.push(n),i=i.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))):(i.splice(a,1),r.push(n),r=r.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))),Object(v["s"])(t,s).then((function(t){var e=Object(b["a"])(t);if(!e)return!1;o.getTaskStages(!1)}))},showInputStrageName:function(){var t=this;this.showCreateStage=!this.showCreateStage,this.$nextTick((function(){t.$refs.inputStageName.focus()}))},doStage:function(t){var e=this,a=this,s=t.key.split("_"),o=s[s.length-2],n=s[s.length-1],r=s[0];switch(r){case"editStage":this.stageModal.stageCode=o,this.stageModal.stageIndex=n,this.$nextTick((function(){e.stageModal.form.setFieldsValue({name:e.taskStages[n].name}),e.$refs.inputStageTitle.focus()})),this.stageModal.modalStatus=!0;break;case"recycleBatch":this.$confirm({title:"移到回收站",content:"您确定要把列表下的所有任务移到回收站吗？",okText:"移到回收站",okType:"danger",cancelText:"再想想",onOk:function(){return a.taskStages[n].tasks=[],a.$set(a.taskStages[n],"doneTasks",[]),Object(v["l"])({stageCode:o}).then((function(t){var e=Object(b["a"])(t);if(!e)return!1;a.$set(a.taskStages[n],"doneTasks",[]),a.$set(a.taskStages[n],"unDoneTasks",[])})),Promise.resolve()}});break;case"setEndTime":this.set_type_endTime_modal=!0;break;case"setExecutor":this.projectMemberModal.currentStageIndex=n,this.projectMemberModal.modalStatus=!0;break;case"delStage":if(this.taskStages[n].tasks.length>0)return this.$warning({title:"删除列表",content:"请先清空此列表上的任务，然后再删除这个列表",okText:"确定"}),!1;this.$confirm({title:"删除列表",content:"您确定要永远删除这个列表吗？",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(g["b"])(o),a.taskStages.splice(n,1),Promise.resolve()}});break}},creteStage:function(){var t=this;if(!this.stageName)return this.$message.warning("请输入列表名称",2),!1;Object(g["e"])({name:this.stageName,projectCode:this.code}).then((function(e){var a=Object(b["a"])(e);if(!a)return!1;var s=e.data;t.taskStages.push(s),t.stageName="",t.$nextTick((function(){document.getElementById("board-scrum-stages").scrollLeft=1e4}))}))},editStage:function(){var t=this,e=this.stageModal.form.getFieldsValue();if(!e.name)return this.$message.warning("请输入列表名称",2),!1;Object(g["c"])({name:e.name,stageCode:this.stageModal.stageCode}).then((function(a){var s=Object(b["a"])(a);if(!s)return!1;t.taskStages[t.stageModal.stageIndex].name=e.name,t.stageModal.modalStatus=!1}))},setExecutor:function(t){var e=this,a=this.taskStages[this.projectMemberModal.currentStageIndex],s=[];a.tasks.forEach((function(t){t.canRead&&s.push(t.code)})),s?Object(v["c"])({taskCodes:JSON.stringify(s),executorCode:t.code}).then((function(t){if(e.projectMemberModal.modalStatus=!1,!Object(b["a"])(t))return!1;Object(g["g"])({stageCode:a.code}).then((function(t){var e=0;t.data.forEach((function(t){t.canRead||e++})),a.canNotReadCount=e,a.tasksLoading=!1,a.tasks=t.data}))})):this.projectMemberModal.modalStatus=!1},showTaskPri:function(t){return{warning:1==t,error:2==t}},showTimeLabel:function(t){var e="label-primary";if(null==t)return e;var a=moment(moment(t).format("YYYY-MM-DD")).diff(moment().format("YYYY-MM-DD"),"days");return a<0?e="label-danger":0==a?e="label-warning":a>7&&(e="label-normal"),e},showTaskTime:function(t,e){return Object(C["a"])(t,e)},taskDetail:function(t,e){this.$router.push("".concat(this.$route.path,"/detail/").concat(t,"?from=").concat(e))},stageMove:function(t){this.preCode=t.draggedContext.element.code,this.nextCode=t.relatedContext.element.code},stageSort:function(){Object(g["f"])(this.preCode,this.nextCode,this.code)},taskSort:function(t){var e=this;console.log(t);for(var a=t.to.parentNode.parentNode.parentNode.getAttribute("id"),s="",o=0,n=t.to.children.length;o<n;o++)s+=","+t.to.children[o].getAttribute("id");Object(v["r"])({stageCode:a,codes:s.substr(1)}).then((function(t){e.getTaskStages(!1)}))},handleResize:function(t,e){t.barSize&&(this.taskStages[e].fixedCreator=!0)},visibleDraw:function(t){"member"==t?(this.configDraw.visible=!1,this.taskSearch.visible=!1,this.inviteMemberDraw.visible=!this.inviteMemberDraw.visible):"taskSearch"==t?(this.taskSearch.visible=!this.taskSearch.visible,this.configDraw.visible=!1,this.inviteMemberDraw.visible=!1):(this.inviteMemberDraw.visible=!1,this.taskSearch.visible=!1,this.configDraw.visible=!this.configDraw.visible)},removeMember:function(t,e){var a=this;this.$confirm({title:"您确定要将「".concat(t.name,"」从项目中移除吗？"),content:"移除后该成员将不能查看任何关于该项目的信息",okText:"移除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(k["d"])(t.code,a.code).then((function(t){Object(b["a"])(t)&&(a.projectMembers.splice(e,1),Object(j["b"])({title:"移除成功"},"notice","success"))})),Promise.resolve()}})},inviteMember:function(t){Object(k["b"])(t.memberCode,this.projectCode).then((function(e){var a=Object(b["a"])(e);a&&(t.joined=!0)}))},searchInviteMember:r.a.debounce((function(){var t=this;if(this.inviteMemberDraw.keyword||(this.projectMembers=JSON.parse(JSON.stringify(this.projectMembersCopy))),this.inviteMemberDraw.keyword.length<=1)return!1;this.searching=!0,this.projectMembers=this.projectMembers.filter((function(e){return-1!=e.name.indexOf(t.inviteMemberDraw.keyword)}))}),500),updateProject:function(t){this.project=t},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(w["a"])(this.project.code,e).then((function(e){Object(b["a"])(e)&&(t.project.collected=!t.project.collected)}))},handleChange:function(t){if("uploading"===t.file.status)return Object(j["b"])("正在导入，请稍后...","message","loading",0),void(this.uploadLoading=!0);if("done"===t.file.status&&(console.log(t),this.uploadLoading=!1,Object(b["a"])(t.file.response,!0))){var e=t.file.response.data;e?Object(j["b"])("成功导入".concat(e,"个任务"),"message","success"):Object(j["b"])("没有成功导入任何任务","message","warning"),this.getTaskStages(!1)}},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("文件不能超过2MB!"),e}}}},a35e:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-task",class:t.project.task_board_theme},[a("div",{staticClass:"project-navigation"},[a("div",{staticClass:"project-nav-header"},[a("a-breadcrumb",[a("a-breadcrumb-item",[a("a",{on:{click:t.toHome}},[a("a-icon",{attrs:{type:"home"}}),t._v("首页\n          ")],1)]),a("a-breadcrumb-item",[a("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),a("span",{staticClass:"actions"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?a("span",{staticClass:"label label-normal"},[a("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),a("section",{staticClass:"nav-body"},[a("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[t._m(0),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])]),a("div",{staticClass:"project-nav-footer"},[a("a",{staticClass:"footer-item",on:{click:function(e){return t.visibleDraw("taskSearch")}}},[a("a-icon",{attrs:{type:"search"}}),a("span",[t._v("筛选")])],1),a("a",{staticClass:"footer-item",class:{active:"member"==t.slideMenuKey},on:{click:function(e){return t.visibleDraw("member")}}},[a("a-icon",{attrs:{type:"user"}}),a("span",[t._v(t._s(t.projectMembers.length))])],1),a("a",{staticClass:"footer-item",class:{active:"config"==t.slideMenuKey},on:{click:function(e){return t.visibleDraw("config")}}},[a("a-icon",{attrs:{type:"menu"}}),a("span",[t._v("菜单")])],1)])]),a("wrapper-content",{attrs:{showHeader:!1}},[a("draggable",{staticClass:"board-scrum-stages",attrs:{options:{group:"stages",filter:".undraggables",handle:".ui-sortable-handle",ghostClass:"stage-ghost",animation:200,forceFallback:!1},id:"board-scrum-stages",move:t.stageMove},on:{update:t.stageSort},model:{value:t.taskStages,callback:function(e){t.taskStages=e},expression:"taskStages"}},[t._l(t.taskStages,(function(e,s){return a("div",{key:s,staticClass:"scrum-stage",class:{"fixed-creator":1==e.fixedCreator},attrs:{id:e.code}},[a("header",{directives:[{name:"show",rawName:"v-show",value:!e.tasksLoading,expression:"!stage.tasksLoading"}],staticClass:"scrum-stage-header ui-sortable-handle"},[a("div",{staticClass:"stage-name hinted"},[t._v("\n            "+t._s(e.name)+"\n            "),e.tasks.length>0?a("span",{staticClass:"task-count"},[t._v("· "+t._s(e.tasks.length))]):t._e()]),a("div",{staticClass:"stage-menu-toggler popover"},[a("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"}},[a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v("编辑任务列表")])]),a("a",{staticClass:"menu-toggler-title",attrs:{href:"javascript:void(0)"}},[a("a-icon",{staticStyle:{"font-size":"18px"},attrs:{type:"ellipsis"}})],1)],2),a("a-menu",{attrs:{slot:"overlay",selectable:!1},on:{click:t.doStage},slot:"overlay"},[a("a-menu-item",{key:"editStage_"+e.code+"_"+s},[a("a-icon",{attrs:{type:"edit"}}),t._v("编辑列表\n                ")],1),a("a-menu-item",{key:"setExecutor_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"user"}}),t._v("设置本列所有任务执行者\n                ")],1),a("a-menu-item",{key:"recycleBatch_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"delete"}}),t._v("本列所有任务移到回收站\n                ")],1),a("a-menu-item",{key:"delStage_"+e.code+"_"+s},[a("a-icon",{attrs:{size:"14",type:"delete"}}),t._v("删除列表\n                ")],1)],1)],1)],1)]),a("div",{staticClass:"scrum-stage-wrap ui-sortable",class:{"hidden-creator-bottom":e.showTaskCard}},[a("vue-scroll",{ref:s+"-stage",refInFor:!0,attrs:{ops:t.scrollOps},on:{"handle-resize":function(e){return t.handleResize(e,s)}}},[a("section",{staticClass:"scrum-stage-content thin-scroll",attrs:{id:e.code,"task-type-index":s}},[a("a-spin",{attrs:{wrapperClassName:"tasks-loading",spinning:e.tasksLoading}},[a("draggable",{staticClass:"scrum-stage-tasks",attrs:{options:{group:"task",ghostClass:"task-ghost",dragClass:"task-drag",fallbackClass:"task-drag",forceFallback:!1}},on:{end:t.taskSort},model:{value:e.unDoneTasks,callback:function(a){t.$set(e,"unDoneTasks",a)},expression:"stage.unDoneTasks"}},[t._l(e.unDoneTasks,(function(e,o){return[!e.done&&e.canRead?a("div",{key:e.code,staticClass:"task task-card ui-sortable-handle",class:t.showTaskPri(e.pri),attrs:{index:o,id:e.code},on:{click:function(a){return a.stopPropagation(),t.taskDetail(e.code,s)}}},[a("div",{staticClass:"task-priority bg-priority-0"}),a("a-tooltip",{attrs:{placement:s>0?"top":"right"}},[a("template",{slot:"title"},[e.hasUnDone?a("span",{staticStyle:{"font-size":"12px"}},[t._v("子任务尚未全部完成，无法完成父任务")]):t._e()]),a("div",{staticClass:"check-box-wrapper",on:{click:function(a){return a.stopPropagation(),t.taskDone(e.code,s,o,1)}}},[a("a-icon",{staticClass:"check-box",class:{disabled:e.hasUnDone},style:{fontSize:"16px"},attrs:{type:"border"}})],1)],2),a("div",{staticClass:"task-content-set open-detail"},[a("div",{staticClass:"task-content-wrapper"},[a("div",{staticClass:"task-content"},[t._v(t._s(e.name))]),e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:e.executor.avatar,title:e.executor.name}})],2):t._e()],1),a("div",{staticClass:"task-info-wrapper clearfix"},[a("div",{staticClass:"task-infos"},[e.end_time?a("span",{staticClass:"label",class:t.showTimeLabel(e.end_time)},[a("span",{attrs:{title:e.end_time}},[t._v("\n                                "+t._s(t.showTaskTime(e.begin_time,e.end_time))+"\n                              ")])]):t._e(),e.description?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"file-text"}})],1):t._e(),e.hasSource?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"link"}})],1):t._e(),e.hasComment?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"message"}})],1):t._e(),e.childCount[0]>0?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"bars"}}),a("span",[t._v("\n                                "+t._s(e.childCount[1])+"/"+t._s(e.childCount[0])+"\n                              ")])],1):t._e(),t._l(e.tags,(function(e){return a("span",{key:e.code,staticClass:"tag muted"},[a("a-badge",{class:"badge-"+e.tag.color,attrs:{status:"success"}}),t._v("\n                              "+t._s(e.tag.name)+"\n                            ")],1)})),e.execute_state>0?a("span",{class:"icon-wrapper text text-"+e.task_execute.color},[t._v(t._s(e.task_execute_name))]):t._e(),e.like?a("span",{staticClass:"icon-wrapper muted"},[a("a-icon",{attrs:{type:"like"}}),a("span",[t._v(t._s(e.like))])],1):t._e()],2)]),t.project.prefix&&t.project.open_prefix?a("footer",{staticClass:"task-info-footer"},[a("span",{staticClass:"task-id-number"},[t._v(t._s(t.project.prefix)+"-"+t._s(e.id_num))])]):t._e()])],1):t._e()]}))],2),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showTaskCard,expression:"stage.showTaskCard"}],staticClass:"task-creator-wrap card",attrs:{id:"card"+s}},[a("form",{staticClass:"task-creator"},[a("a-input",{ref:"inputTaskName"+s,refInFor:!0,staticClass:"task-content-input",attrs:{type:"textarea",rows:3,placeholder:"任务内容"},on:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.createTask(e.code,s)}},model:{value:t.task.name,callback:function(e){t.$set(t.task,"name",e)},expression:"task.name"}}),a("div",{staticClass:"handler-wrap"},[a("a-dropdown",{attrs:{trigger:["click"]}},[a("a",{staticClass:"executor-handler"},[a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:t.defaultExecutor.avatar}}),a("span",{staticClass:"creator-handler-text name"},[t._v("\n                            "+t._s(t.defaultExecutor.name)+"\n                          ")])]),a("a-menu",{staticClass:"executor-handler-menu",attrs:{slot:"overlay"},on:{click:t.selectExecutor},slot:"overlay"},t._l(t.projectMembers,(function(e,s){return a("a-menu-item",{key:s},[a("img",{staticClass:"avatar img-circle img-32 pull-left m-r-sm",attrs:{src:e.avatar}}),a("span",{staticClass:"muted",staticStyle:{"line-height":"25px"}},[t._v("\n                              "+t._s(e.name)+"\n                            ")]),e.code==t.defaultExecutor.code?a("a-icon",{staticClass:"muted",attrs:{type:"check"}}):t._e()],1)})),1)],1)],1),a("div",{staticClass:"submit-set"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"default",size:"large"},on:{click:function(e){return e.stopPropagation(),t.showTaskCard(s,!1)}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",class:{"disabled-btn":!t.task.name},attrs:{loading:t.createTaskLoading,disabled:!t.task.name,type:"primary",size:"large"},on:{click:function(a){return a.stopPropagation(),t.createTask(e.code,s)}}},[t._v("创建")])],1)],1)]),a("draggable",{staticClass:"scrum-stage-tasks-done",attrs:{options:{group:"task-done",ghostClass:"task-ghost",dragClass:"task-drag",fallbackClass:"task-drag",forceFallback:!1}},on:{end:t.taskSort},model:{value:e.doneTasks,callback:function(a){t.$set(e,"doneTasks",a)},expression:"stage.doneTasks"}},[t._l(e.doneTasks,(function(e,o){return[e.canRead?a("div",{key:e.code,staticClass:"task done task-card ui-sortable-handle",attrs:{index:o,id:e.code},on:{click:function(a){return a.stopPropagation(),t.taskDetail(e.code,s)}}},[a("div",{staticClass:"task-priority bg-priority-0"}),a("span",{staticClass:"check-box-wrapper",on:{click:function(a){return a.stopPropagation(),t.taskDone(e.code,s,o,0)}}},[a("a-icon",{staticClass:"check-box",class:{disabled:e.hasUnDone},style:{fontSize:"16px"},attrs:{type:"check-square"}})],1),a("div",{staticClass:"task-content-set open-detail"},[a("div",{staticClass:"task-content-wrapper"},[a("div",{staticClass:"task-content"},[t._v(t._s(e.name))]),e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),e.executor&&e.executor.avatar?a("img",{staticClass:"avatar img-circle img-24 hinted",attrs:{src:e.executor.avatar,title:e.executor.name}}):t._e()],2):t._e()],1),a("div",{staticClass:"task-info-wrapper clearfix"},[a("div",{staticClass:"task-infos"},t._l(e.task_tag_item_list,(function(e,s){return a("span",{key:e.code,staticClass:"tag muted",class:"tag-color-"+e.color},[t._v(t._s(e.name))])})),0)])])]):t._e()]}))],2),a("div",{directives:[{name:"show",rawName:"v-show",value:e.canNotReadCount,expression:"stage.canNotReadCount"}],staticClass:"scrum-stage-tasks-done"},[a("li",{staticClass:"task muted",staticStyle:{margin:"0 10px 8px"}},[a("span",[a("a-icon",{attrs:{type:"lock"}}),t._v("\n                      有\n                      "+t._s(e.canNotReadCount)+"\n                      个任务被隐藏（因为设置了仅参与者可见）\n                    ")],1)])]),e.showTaskCard?t._e():a("div",{staticClass:"task-creator-handler-wrap",on:{click:function(e){return e.stopPropagation(),t.showTaskCard(s)}}},[a("a",{staticClass:"task-creator-handler link-add-handler"},[a("a-icon",{staticStyle:{"padding-right":"6px"},attrs:{type:"plus-circle"}}),t._v("添加任务\n                  ")],1)])],1)],1)])],1)])})),a("div",{staticClass:"scrum-stage undraggable create-stage"},[a("header",{staticClass:"scrum-stage-header"},[a("div",{staticClass:"stage-name hinted",staticStyle:{width:"100%"}},[a("a",{directives:[{name:"show",rawName:"v-show",value:!t.showCreateStage,expression:"!showCreateStage"}],staticClass:"muted",on:{click:t.showInputStrageName}},[a("a-icon",{attrs:{type:"plus"}}),a("span",{staticClass:"m-l-xs"},[t._v("新建任务列表")])],1),a("div",{directives:[{name:"show",rawName:"v-show",value:t.showCreateStage,expression:"showCreateStage"}]},[a("div",[a("a-input",{ref:"inputStageName",attrs:{placeholder:"新建任务列表...","auto-focus":""},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.creteStage(e)}},model:{value:t.stageName,callback:function(e){t.stageName=e},expression:"stageName"}})],1),a("div",{staticClass:"submit-set create-stage-footer"},[a("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.showCreateStage=!t.showCreateStage}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",attrs:{type:"primary"},on:{click:t.creteStage}},[t._v("保存")])],1)])])])])],2),a("router-view")],1),a("a-modal",{attrs:{width:360,title:t.stageModal.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.stageModal.modalStatus,callback:function(e){t.$set(t.stageModal,"modalStatus",e)},expression:"stageModal.modalStatus"}},[a("a-form",{attrs:{form:t.stageModal.form},on:{submit:function(e){return e.preventDefault(),t.editStage(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入列表标题"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入列表标题'}]},\n          ]"}],ref:"inputStageTitle",attrs:{placeholder:"列表标题"}})],1),a("a-form-item",[a("div",{staticClass:"action-btn pull-right"},[a("a",{staticClass:"cancel-text muted",attrs:{type:"text"},on:{click:function(e){t.stageModal.modalStatus=!1}}},[t._v("取消")]),a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit"}},[t._v("保存")])],1)])],1)],1),a("a-drawer",{attrs:{wrapClassName:"info-drawer",title:"项目成员",width:"350",placement:"right",visible:t.inviteMemberDraw.visible},on:{close:function(e){t.inviteMemberDraw.visible=!1}}},[a("div",{staticClass:"search-content"},[a("a-input",{attrs:{size:"large",placeholder:"输入昵称或邮箱查找"},model:{value:t.inviteMemberDraw.keyword,callback:function(e){t.$set(t.inviteMemberDraw,"keyword",e)},expression:"inviteMemberDraw.keyword"}},[a("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),a("div",{staticClass:"member-list"},[a("div",{staticClass:"member-list-item ant-list-item header-action"},[a("div",{staticClass:"ant-list-item-meta",on:{click:function(e){t.showInviteMember=!0}}},[a("div",{staticClass:"ant-list-item-meta-avatar"},[a("a-avatar",{attrs:{icon:"plus"}})],1),a("div",{staticClass:"ant-list-item-meta-content"},[a("h4",{staticClass:"ant-list-item-meta-title"},[a("span",[t._v("邀请新成员")])])])])]),a("a-list",{attrs:{itemLayout:"horizontal",loading:t.inviteMemberDraw.searching,dataSource:t.projectMembers,locale:{emptyText:t.inviteMemberDraw.keyword&&t.inviteMemberDraw.keyword.length>1?"没有搜索到相关成员":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e,s){return a("a-list-item",{staticClass:"member-list-item"},[e.is_owner?t._e():a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a",{staticClass:"muted",on:{click:function(a){return t.removeMember(e,s)}}},[a("a-icon",{attrs:{type:"user-delete"}}),t._v("移除\n            ")],1)]),a("a-list-item-meta",{attrs:{description:e.email}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)]),a("a-drawer",{attrs:{wrapClassName:"info-drawer",title:"项目设置",width:"350",placement:"right",visible:t.configDraw.visible},on:{close:function(e){t.configDraw.visible=!1}}},[a("div",{staticClass:"config-wrapper"},[a("ul",{staticClass:"config-menus"},[a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.projectModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"setting"}}),t._v("项目设置\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.taskTagModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"tags"}}),t._v("标签\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{on:{click:function(e){t.recycleModal.modalStatus=!0}}},[a("a-icon",{attrs:{type:"delete"}}),t._v("查看回收站\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",{attrs:{href:t.downLoadUrl,target:"_blank"}},[a("a-icon",{attrs:{type:"copy"}}),t._v("下载导入任务模板\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a-upload",{attrs:{name:"file",showUploadList:!1,action:t.uploadAction,beforeUpload:t.beforeUpload,data:{projectCode:t.code},headers:t.headers},on:{change:t.handleChange}},[a("a",{staticClass:"text-default",attrs:{loading:t.uploadLoading,disabled:t.uploadLoading}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.uploadLoading,expression:"!uploadLoading"}],attrs:{type:"upload"}}),t._v("上传文件导入任务\n            ")],1)])],1),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"logout"}}),t._v("导出任务 *\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"copy"}}),t._v("复制项目 *\n          ")],1)]),a("li",{staticClass:"menu-item"},[a("a",[a("a-icon",{attrs:{type:"block"}}),t._v("保存为项目模板 *\n          ")],1)])])])]),a("a-modal",{staticClass:"project-config-modal",attrs:{destroyOnClose:"",width:800,title:t.projectModal.modalTitle,footer:null},model:{value:t.projectModal.modalStatus,callback:function(e){t.$set(t.projectModal,"modalStatus",e)},expression:"projectModal.modalStatus"}},[a("project-config",{attrs:{code:t.code},on:{update:t.updateProject}})],1),a("a-modal",{staticClass:"recycle-bin-modal",attrs:{width:800,title:t.recycleModal.modalTitle,footer:null},model:{value:t.recycleModal.modalStatus,callback:function(e){t.$set(t.recycleModal,"modalStatus",e)},expression:"recycleModal.modalStatus"}},[t.recycleModal.modalStatus?a("recycle-bin",{attrs:{code:t.code},on:{update:t.init}}):t._e()],1),a("a-modal",{staticClass:"task-tag-modal",attrs:{width:800,title:t.taskTagModal.modalTitle,footer:null},model:{value:t.taskTagModal.modalStatus,callback:function(e){t.$set(t.taskTagModal,"modalStatus",e)},expression:"taskTagModal.modalStatus"}},[t.taskTagModal.modalStatus?a("task-tag",{attrs:{code:t.code},on:{update:t.init}}):t._e()],1),a("a-modal",{staticClass:"invite-project-member",attrs:{width:360,title:t.projectMemberModal.modalTitle,footer:null},model:{value:t.projectMemberModal.modalStatus,callback:function(e){t.$set(t.projectMemberModal,"modalStatus",e)},expression:"projectMemberModal.modalStatus"}},[a("div",{staticClass:"member-list"},[a("a-list",{staticClass:"project-list",attrs:{itemLayout:"horizontal",loading:t.loading,dataSource:t.projectMembers},scopedSlots:t._u([{key:"renderItem",fn:function(e){return a("a-list-item",{},[a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a-button",{attrs:{size:"small",type:"dashed",icon:"user-add"},on:{click:function(a){return t.setExecutor(e)}}},[t._v("设置")])],1),a("a-list-item-meta",{attrs:{description:e.email}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)]),a("a-drawer",{attrs:{wrapClassName:"info-drawer task-search",title:"任务筛选",width:"350",placement:"right",visible:t.taskSearch.visible},on:{close:function(e){t.taskSearch.visible=!1}}},[a("task-search",{attrs:{"project-code":t.code},on:{search:t.taskSearchAction}})],1),t.showInviteMember?a("invite-project-member",{attrs:{"project-code":t.code},model:{value:t.showInviteMember,callback:function(e){t.showInviteMember=e},expression:"showInviteMember"}}):t._e()],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("li",{staticClass:"actives"},[a("a",{staticClass:"app",attrs:{"data-app":"tasks"}},[t._v("任务")])])}],n=a("8dea"),r=n["a"],i=(a("64a8"),a("2877")),c=Object(i["a"])(r,s,o,!1,null,null,null);e["default"]=c.exports},b625:function(t,e,a){},ca8d:function(t,e,a){"use strict";a.d(e,"j",(function(){return o})),a.d(e,"h",(function(){return n})),a.d(e,"o",(function(){return r})),a.d(e,"t",(function(){return i})),a.d(e,"r",(function(){return c})),a.d(e,"m",(function(){return l})),a.d(e,"u",(function(){return d})),a.d(e,"q",(function(){return u})),a.d(e,"b",(function(){return p})),a.d(e,"c",(function(){return m})),a.d(e,"s",(function(){return f})),a.d(e,"p",(function(){return g})),a.d(e,"l",(function(){return h})),a.d(e,"k",(function(){return k})),a.d(e,"e",(function(){return v})),a.d(e,"d",(function(){return b})),a.d(e,"i",(function(){return C})),a.d(e,"a",(function(){return w})),a.d(e,"n",(function(){return j})),a.d(e,"g",(function(){return y})),a.d(e,"f",(function(){return _}));var s=a("22b6");function o(t){return s["a"].post("project/task",t)}function n(t){return s["a"].post("project/task/getListByTaskTag",t)}function r(t){return s["a"].post("project/task/selfList",t)}function i(t){return s["a"].post("project/task/taskSources",t)}function c(t){return s["a"].post("project/task/sort",t)}function l(t){return s["a"].post("project/task/save",t)}function d(t){return s["a"].post("project/task/taskToTags",t)}function u(t){return s["a"].post("project/task/setTag",t)}function p(t){return s["a"].post("project/task/assignTask",t)}function m(t){return s["a"].post("project/task/batchAssignTask",t)}function f(t,e){return s["a"].post("project/task/taskDone",{taskCode:t,done:e})}function g(t,e){return s["a"].post("project/task/setPrivate",{taskCode:t,private:e})}function h(t){return s["a"].post("project/task/recycleBatch",t)}function k(t){return s["a"].post("project/task/recovery",{taskCode:t})}function v(t){return s["a"].post("project/task/delete",{taskCode:t})}function b(t){return s["a"].post("project/task/dateTotalForProject",t)}function C(t){return s["a"].post("project/project/getLogBySelfProject",t)}function w(t){return s["a"].post("project/task/_taskWorkTimeList",t)}function j(t){return s["a"].post("project/task/saveTaskWorkTime",t)}function y(t){return s["a"].post("project/task/editTaskWorkTime",t)}function _(t){return s["a"].post("project/task/delTaskWorkTime",t)}},db9e6:function(t,e,a){"use strict";a.d(e,"c",(function(){return o})),a.d(e,"d",(function(){return n})),a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return i}));var s=a("22b6");function o(t){return s["a"].post("project/task_tag",t)}function n(t){return s["a"].post("project/task_tag/save",t)}function r(t){return s["a"].post("project/task_tag/edit",t)}function i(t){return s["a"].post("project/task_tag/delete",{tagCode:t})}}}]);