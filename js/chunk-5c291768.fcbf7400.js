(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c291768","chunk-59cc6971","chunk-5c291768"],{"129c":function(t,e,a){"use strict";var o=a("233b"),n=a.n(o);n.a},"233b":function(t,e,a){},"3c6c":function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-modal",{staticClass:"task-detail-modal",attrs:{width:"min-content",closable:!1,visible:"",title:"",footer:null},on:{cancel:t.detailClose}},[a("task-detail",{attrs:{taskCode:t.code},on:{close:t.detailClose}})],1)},n=[],i=a("009f"),s={name:"task-detail-modal",components:{taskDetail:i["default"]},data:function(){return{loading:!1,code:this.$route.params.taskCode,projectCode:this.$route.params.code}},created:function(){this.init()},methods:{init:function(){this.loading=!0},detailClose:function(){var t=this.$route.query.from,e="";t&&(e="?from=".concat(t)),this.$router.push("/project/space/task/".concat(this.projectCode).concat(e))}}},r=s,c=(a("129c"),a("2877")),d=Object(c["a"])(r,o,n,!1,null,null,null);e["default"]=d.exports},5515:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-template-index"},[a("wrapper-content",{attrs:{showHeader:!1}},[a("div",{staticClass:"action"},[a("a-button",{attrs:{type:"primary",icon:"plus"},on:{click:function(e){return t.doAction(null,"new")}}},[t._v("添加任务")])],1),a("h3",[t._v("「"+t._s(t.$route.query.name)+"」任务列表")]),a("a-list",{staticClass:"default-list",attrs:{loading:t.loading,itemLayout:"horizontal",dataSource:t.dataSource},scopedSlots:t._u([{key:"renderItem",fn:function(e,o){return a("a-list-item",{},[a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"edit")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"del",o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1),a("a-list-item-meta",{attrs:{description:"排序："+e.sort}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))])])],1)}}])},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多任务")])],1):t._e()])],1),a("a-modal",{attrs:{width:360,title:t.actionInfo.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[a("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入任务名称"}]}],expression:"[\n                                        'name',\n                                        {rules: [{ required: true, message: '请输入任务名称' }]}\n                                        ]"}],attrs:{placeholder:"任务名称（必填）"}})],1),a("a-form-item",{attrs:{help:"排序，值越大越靠前，默认0"}},[a("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["sort"],expression:"[\n                                        'sort',\n                                        ]"}],staticStyle:{width:"100%"},attrs:{min:0,placeholder:"排序"}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.actionInfo.confirmLoading}},[t._v("保存任务\n                    ")])],1)])],1)],1)],1)},n=[],i=(a("55dd"),a("7f7f"),a("3f47")),s=a("2f14"),r=a("1b80"),c={components:{},mixins:[r["a"]],data:function(){return{dataSource:[],loading:!0,showLoadingMore:!1,loadingMore:!1,currentTemplate:{},newData:{id:0},form:this.$form.createForm(this),searchForm:{},actionInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑任务"}}},watch:{$route:function(){this.init()},viewType:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t&&(this.dataSource=[],this.pagination.page=1,this.showLoadingMore=!1),e.loading=!0,e.requestData.code=e.$route.params.code,Object(i["c"])(e.requestData).then((function(t){e.dataSource=e.dataSource.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.dataSource.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.init(!1)},doAction:function(t,e,a){this.currentTemplate=t;var o=this;o.newData={code:""},"edit"==e||"new"==e?(setTimeout((function(){o.form&&o.form.resetFields()}),0),o.actionInfo.modalStatus=!0,o.actionInfo.modalTitle="添加任务","edit"==e&&setTimeout((function(){o.actionInfo.modalTitle="编辑任务",o.form.setFieldsValue({name:t.name,sort:t.sort}),o.cover=t.cover,o.newData=t}),0)):"del"==e&&this.$confirm({title:"确定删除任务？",content:"删除任务「".concat(this.currentTemplate.name,"」后已以该任务创建的项目不受影响"),okText:"删除任务",okType:"danger",cancelText:"再想想",onOk:function(){return Object(i["a"])(t.code).then((function(){o.dataSource.splice(a,1)})),Promise.resolve()}})},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this;t.actionInfo.confirmLoading=!0;var e=t.form.getFieldsValue();e.template_code=this.$route.params.code,t.newData.code?e.code=t.newData.code:Object.assign(e,t.newData),Object(i["b"])(e).then((function(e){t.actionInfo.confirmLoading=!1,Object(s["a"])(e)&&(t.form.resetFields(),t.newData={code:""},t.actionInfo.modalStatus=!1,t.init())}))},handleChange:function(t){var e=this;"uploading"!==t.file.status?"done"===t.file.status&&Object(s["e"])(t.file.originFileObj,(function(a){e.cover=t.file.response.data.url,e.uploadLoading=!1})):this.uploadLoading=!0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("图片不能超过2MB!"),e}}},d=c,l=a("2877"),u=Object(l["a"])(d,o,n,!1,null,null,null);e["default"]=u.exports},"5a8d":function(t,e,a){},"5cd4":function(t,e,a){"use strict";var o=a("5a8d"),n=a.n(o);n.a},6061:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-template-index"},[a("wrapper-content",{attrs:{showHeader:!1}},[a("a-tabs",{attrs:{animated:!1},model:{value:t.viewType,callback:function(e){t.viewType=e},expression:"viewType"}},[a("a-tab-pane",{key:"0",attrs:{tab:"自定义模板"}}),a("a-tab-pane",{key:"1",attrs:{tab:"公共模板"}}),a("a-button",{attrs:{slot:"tabBarExtraContent",type:"primary",icon:"plus"},on:{click:function(e){return t.doAction(null,"new")}},slot:"tabBarExtraContent"},[t._v("制作项目模板")])],1),a("a-list",{staticClass:"default-list",attrs:{loading:t.loading,itemLayout:"horizontal",dataSource:t.dataSource},scopedSlots:t._u([{key:"renderItem",fn:function(e,o){return a("a-list-item",{},[e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"stages")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"任务列表"}},[a("a-icon",{attrs:{type:"bars"}})],1)],1),e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"edit")}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),e.is_system?t._e():a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.doAction(e,"del",o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1),a("a-list-item-meta",{attrs:{description:e.description}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),a("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.cover},slot:"avatar"})],1),a("div",{staticClass:"other-info muted"},[e.task_stages.length?a("div",{staticClass:"info-item task"},[a("a-breadcrumb",{attrs:{separator:">"}},t._l(e.task_stages,(function(e){return a("a-breadcrumb-item",{key:e.name},[t._v(t._s(e.name))])})),1)],1):t._e()])],1)}}])},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多模板")])],1):t._e()])],1),a("a-modal",{staticClass:"project-template-modal",attrs:{width:360,title:t.actionInfo.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[a("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("div",{staticClass:"cover-item"},[t.cover?[a("img",{staticClass:"avatar",attrs:{src:t.cover}})]:t._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.cover,expression:"!cover"}],staticClass:"no-avatar"}),a("a-upload",{staticClass:"cover-uploader",attrs:{name:"cover",showUploadList:!1,headers:t.headers,action:t.uploadAction,beforeUpload:t.beforeUpload},on:{change:t.handleChange}},[a("a-button",{staticClass:"upload",attrs:{icon:"upload"}},[t._v("上传封面")]),a("span",{staticClass:"upload-tips muted"},[t._v("最佳图片比例为300*150")])],1)],2),a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入模板名称"}]}],expression:"[\n                                          'name',\n                                          {rules: [{ required: true, message: '请输入模板名称' }]}\n                                          ]"}],attrs:{placeholder:"模板名称（必填）"}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"模板说明",rows:2}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.actionInfo.confirmLoading}},[t._v("保存模板")])],1)])],1)],1)],1)},n=[],i=(a("7f7f"),a("6649")),s=a("2f14"),r=a("1b80"),c=(a("a078"),{components:{},mixins:[r["a"]],data:function(){return{viewType:"0",dataSource:[],loading:!0,showLoadingMore:!1,loadingMore:!1,currentTemplate:{},cover:"https://beta.vilson.xyz/static/image/default/project-cover.png",newData:{id:0},form:this.$form.createForm(this),searchForm:{},actionInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑模板"},uploadLoading:!1,uploadAction:Object(s["c"])("project/project_template/uploadCover")}},computed:{headers:function(){return Object(s["d"])()}},watch:{$route:function(){this.init()},viewType:function(){this.init()}},created:function(){this.init()},methods:{init:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t&&(this.dataSource=[],this.pagination.page=1,this.showLoadingMore=!1),e.loading=!0,e.requestData.viewType=e.viewType,Object(i["c"])(e.requestData).then((function(t){e.dataSource=e.dataSource.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.dataSource.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.init(!1)},doAction:function(t,e,a){this.currentTemplate=t;var o=this;if(o.newData={code:""},"edit"==e||"new"==e)setTimeout((function(){o.form&&o.form.resetFields()}),0),o.actionInfo.modalStatus=!0,o.actionInfo.modalTitle="自定义模板","edit"==e&&setTimeout((function(){o.actionInfo.modalTitle="编辑模板",o.form.setFieldsValue({name:t.name,description:t.description}),o.cover=t.cover,o.newData=t}),0);else if("del"==e)this.$confirm({title:"确定删除模板？",content:"删除模板「".concat(this.currentTemplate.name,"」后已从该模板创建的项目不受影响"),okText:"删除模板",okType:"danger",cancelText:"再想想",onOk:function(){return Object(i["a"])(t.code).then((function(){o.dataSource.splice(a,1)})),Promise.resolve()}});else if("stages"==e){var n=this.$router.resolve({path:"/project/template/taskstages/"+t.code+"?name="+t.name}),s=n.href;window.open(s,"_blank")}},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this;t.actionInfo.confirmLoading=!0;var e=t.form.getFieldsValue();e.cover=this.cover,t.newData.code?e.code=t.newData.code:Object.assign(e,t.newData),Object(i["b"])(e).then((function(e){t.actionInfo.confirmLoading=!1,Object(s["a"])(e)&&(t.form.resetFields(),t.newData={code:""},t.actionInfo.modalStatus=!1,t.init())}))},handleChange:function(t){var e=this;"uploading"!==t.file.status?"done"===t.file.status&&Object(s["e"])(t.file.originFileObj,(function(a){e.cover=t.file.response.data.url,e.uploadLoading=!1})):this.uploadLoading=!0},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("图片不能超过2MB!"),e}}}),d=c,l=(a("5cd4"),a("2877")),u=Object(l["a"])(d,o,n,!1,null,null,null);e["default"]=u.exports},"8dea":function(t,e,a){"use strict";a("8e6e"),a("456d"),a("28a5"),a("55dd"),a("ac6a"),a("7f7f");var o=a("bd86"),n=a("5880"),i=a("2ef0"),s=a.n(i),r=a("310e"),c=a.n(r),d=a("f8c7"),l=a("d3a1"),u=a("58bf"),f=a("51e2"),h=a("e3cc"),m=a("1d80"),g=a("9f09"),p=a("6be7"),b=a("c030"),v=a("ca8d"),k=a("2f14"),j=a("81fe"),w=a("e55b"),S=a("97a8");function T(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function M(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?T(Object(a),!0).forEach((function(e){Object(o["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):T(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}e["a"]={name:"project-space-task",components:{RecycleBin:f["default"],TaskTag:h["default"],draggable:c.a,projectSelect:d["default"],TaskSearch:m["default"],inviteProjectMember:l["default"],projectConfig:u["default"]},data:function(){return{code:this.$route.params.code,loading:!0,project:{task_board_theme:"simple"},stageName:"",task:{},taskStages:[],defaultExecutor:{},projectMembers:[],projectMembersCopy:[],createTaskLoading:!1,showCreateStage:!1,preCode:"",nextCode:"",taskSearchParams:{},stageKeys:[],stageModal:{form:this.$form.createForm(this),stageCode:"",stageIndex:0,modalStatus:!1,confirmLoading:!1,modalTitle:"编辑列表"},slideMenuKey:"",showInviteMember:!1,inviteMemberDraw:{visible:!1,keyword:"",searching:!1,list:[]},configDraw:{visible:!1},taskSearch:{visible:!1},downLoadUrl:Object(k["h"])("project/task/_downloadTemplate"),uploadLoading:!1,uploadAction:Object(k["c"])("project/task/uploadFile"),projectModal:{modalStatus:!1,modalTitle:"项目设置"},recycleModal:{modalStatus:!1,modalTitle:"查看回收站"},taskTagModal:{modalStatus:!1,modalTitle:"任务标签"},projectMemberModal:{loading:!1,currentStageIndex:0,modalStatus:!1,modalTitle:"设置任务执行者"}}},computed:M({},Object(n["mapState"])({userInfo:function(t){return t.userInfo},viewRefresh:function(t){return t.common.viewRefresh},socketAction:function(t){return t.socketAction}}),{headers:function(){return Object(k["d"])()},scrollOps:function(){return{rail:{background:"#e5e5e5",opacity:1},bar:{keepShow:!0}}}}),watch:{$route:function(t,e){var a=this;if(this.code!=t.params.code&&(this.code=t.params.code,this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()),"taskdetail"==e.name){var o=e.query.from;if(void 0!=o){var n=this.taskSearchParams,i=Object.assign({stageCode:this.taskStages[o].code},n);Object(g["g"])(i).then((function(t){a.taskStages[o].tasksLoading=!1,a.taskStages[o].tasks=t.data;var e=a.taskStages[o].doneTasks=[],n=a.taskStages[o].unDoneTasks=[];t.data.forEach((function(t){t.done?e.push(t):n.push(t)}))}))}}},socketAction:function(t){if("organization:task"===t.action){var e=t.data.data;e.projectCode==this.code&&this.getTaskStages(!1)}},viewRefresh:function(){console.log("viewRefresh")},inviteMemberDraw:{handler:function(t){t.visible?this.slideMenuKey="member":this.slideMenuKey=!1,t.keyword&&this.searchInviteMember()},deep:!0},configDraw:{handler:function(t){t.visible?this.slideMenuKey="config":this.slideMenuKey=!1},deep:!0},showInviteMember:function(t){t||this.getProjectMembers()}},created:function(){this.defaultExecutor=this.userInfo,this.getProject(),this.getProjectMembers(),this.init()},methods:{init:function(){this.getTaskStages()},getProject:function(){var t=this;this.loading=!0,Object(p["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data}))},getProjectMembers:function(){var t=this;Object(b["c"])({projectCode:this.code,pageSize:100}).then((function(e){t.projectMembers=e.data.list,t.projectMembersCopy=e.data.list}))},getTaskStages:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=this;Object(g["d"])({projectCode:this.code,pageSize:30}).then((function(o){var n=[];if(e?t.taskStages=n=o.data.list:o.data.list.forEach((function(t){t.tasksLoading=!1,n.push(t)})),n){var i=a.taskSearchParams,s={};n.forEach((function(t,o){s={stageCode:t.code},s=Object.assign(s,i),Object(g["g"])(s).then((function(n){var i=0;n.data.forEach((function(e){e.canRead||i++,e.done?t.doneTasks.push(e):t.unDoneTasks.push(e)})),t.canNotReadCount=i,t.tasksLoading=!1,t.tasks=n.data,e||a.$set(a.taskStages,o,t)}))}))}}))},filterTask:function(t,e){return t.filter((function(t){return t.done==e}))},taskSearchAction:function(t){console.log(t),this.taskSearchParams=t,this.getTaskStages()},showTaskCard:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.taskStages.forEach((function(t){t.showTaskCard=!1})),!1===e)return!1;this.taskStages[e].showTaskCard=a,this.$nextTick((function(){t.$refs[e+"-stage"][0].scrollIntoView("#card"+e),t.$refs["inputTaskName".concat(e)][0].focus()}))},selectExecutor:function(t){var e=t.key;this.defaultExecutor=this.projectMembers[e]},createTask:function(t,e){if(!this.task.name)return this.$message.warning("任务内容不能为空",2),!1;this.task.stage_code=t,this.task.project_code=this.code,this.task.assign_to=this.defaultExecutor.code,this.confirmCreateTask(e)},confirmCreateTask:function(t){var e=this;if(e.createTaskLoading)return e.$message.warning("正在添加任务，请稍后...",2),!1;setTimeout((function(){!0===e.createTaskLoading&&e.$message.loading({content:"正在添加任务，请稍后...",duration:5})}),2e3),e.createTaskLoading=!0,Object(v["m"])(e.task).then((function(a){e.createTaskLoading=!1;var o=Object(k["a"])(a);if(o){e.$message.destroy();var n=e.taskStages[t];n.tasks.push(a.data),e.taskStages[t].unDoneTasks.push(a.data),e.task={}}})).catch((function(){e.createTaskLoading=!1}))},taskDone:function(t,e,a,o){var n=this,i=null,s=this.taskStages[e].unDoneTasks,r=this.taskStages[e].doneTasks;if(i=o?s[a]:r[a],i.hasUnDone)return!1;i.done=o,o?(s.splice(a,1),r.push(i),r=r.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))):(r.splice(a,1),s.push(i),s=s.sort((function(t,e){return t.sort===e.sort?t.id_num-e.id_num:t.sort-e.sort}))),Object(v["s"])(t,o).then((function(t){var e=Object(k["a"])(t);if(!e)return!1;n.getTaskStages(!1)}))},showInputStrageName:function(){var t=this;this.showCreateStage=!this.showCreateStage,this.$nextTick((function(){t.$refs.inputStageName.focus()}))},doStage:function(t){var e=this,a=this,o=t.key.split("_"),n=o[o.length-2],i=o[o.length-1],s=o[0];switch(s){case"editStage":this.stageModal.stageCode=n,this.stageModal.stageIndex=i,this.$nextTick((function(){e.stageModal.form.setFieldsValue({name:e.taskStages[i].name}),e.$refs.inputStageTitle.focus()})),this.stageModal.modalStatus=!0;break;case"recycleBatch":this.$confirm({title:"移到回收站",content:"您确定要把列表下的所有任务移到回收站吗？",okText:"移到回收站",okType:"danger",cancelText:"再想想",onOk:function(){return a.taskStages[i].tasks=[],a.$set(a.taskStages[i],"doneTasks",[]),Object(v["l"])({stageCode:n}).then((function(t){var e=Object(k["a"])(t);if(!e)return!1;a.$set(a.taskStages[i],"doneTasks",[]),a.$set(a.taskStages[i],"unDoneTasks",[])})),Promise.resolve()}});break;case"setEndTime":this.set_type_endTime_modal=!0;break;case"setExecutor":this.projectMemberModal.currentStageIndex=i,this.projectMemberModal.modalStatus=!0;break;case"delStage":if(this.taskStages[i].tasks.length>0)return this.$warning({title:"删除列表",content:"请先清空此列表上的任务，然后再删除这个列表",okText:"确定"}),!1;this.$confirm({title:"删除列表",content:"您确定要永远删除这个列表吗？",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(g["b"])(n),a.taskStages.splice(i,1),Promise.resolve()}});break}},creteStage:function(){var t=this;if(!this.stageName)return this.$message.warning("请输入列表名称",2),!1;Object(g["e"])({name:this.stageName,projectCode:this.code}).then((function(e){var a=Object(k["a"])(e);if(!a)return!1;var o=e.data;t.taskStages.push(o),t.stageName="",t.$nextTick((function(){document.getElementById("board-scrum-stages").scrollLeft=1e4}))}))},editStage:function(){var t=this,e=this.stageModal.form.getFieldsValue();if(!e.name)return this.$message.warning("请输入列表名称",2),!1;Object(g["c"])({name:e.name,stageCode:this.stageModal.stageCode}).then((function(a){var o=Object(k["a"])(a);if(!o)return!1;t.taskStages[t.stageModal.stageIndex].name=e.name,t.stageModal.modalStatus=!1}))},setExecutor:function(t){var e=this,a=this.taskStages[this.projectMemberModal.currentStageIndex],o=[];a.tasks.forEach((function(t){t.canRead&&o.push(t.code)})),o?Object(v["c"])({taskCodes:JSON.stringify(o),executorCode:t.code}).then((function(t){if(e.projectMemberModal.modalStatus=!1,!Object(k["a"])(t))return!1;Object(g["g"])({stageCode:a.code}).then((function(t){var e=0;t.data.forEach((function(t){t.canRead||e++})),a.canNotReadCount=e,a.tasksLoading=!1,a.tasks=t.data}))})):this.projectMemberModal.modalStatus=!1},showTaskPri:function(t){return{warning:1==t,error:2==t}},showTimeLabel:function(t){var e="label-primary";if(null==t)return e;var a=moment(moment(t).format("YYYY-MM-DD")).diff(moment().format("YYYY-MM-DD"),"days");return a<0?e="label-danger":0==a?e="label-warning":a>7&&(e="label-normal"),e},showTaskTime:function(t,e){return Object(j["a"])(t,e)},taskDetail:function(t,e){this.$router.push("".concat(this.$route.path,"/detail/").concat(t,"?from=").concat(e))},stageMove:function(t){this.preCode=t.draggedContext.element.code,this.nextCode=t.relatedContext.element.code},stageSort:function(){Object(g["f"])(this.preCode,this.nextCode,this.code)},taskSort:function(t){var e=this;console.log(t);for(var a=t.to.parentNode.parentNode.parentNode.getAttribute("id"),o="",n=0,i=t.to.children.length;n<i;n++)o+=","+t.to.children[n].getAttribute("id");Object(v["r"])({stageCode:a,codes:o.substr(1)}).then((function(t){e.getTaskStages(!1)}))},handleResize:function(t,e){t.barSize&&(this.taskStages[e].fixedCreator=!0)},visibleDraw:function(t){"member"==t?(this.configDraw.visible=!1,this.taskSearch.visible=!1,this.inviteMemberDraw.visible=!this.inviteMemberDraw.visible):"taskSearch"==t?(this.taskSearch.visible=!this.taskSearch.visible,this.configDraw.visible=!1,this.inviteMemberDraw.visible=!1):(this.inviteMemberDraw.visible=!1,this.taskSearch.visible=!1,this.configDraw.visible=!this.configDraw.visible)},removeMember:function(t,e){var a=this;this.$confirm({title:"您确定要将「".concat(t.name,"」从项目中移除吗？"),content:"移除后该成员将不能查看任何关于该项目的信息",okText:"移除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(b["d"])(t.code,a.code).then((function(t){Object(k["a"])(t)&&(a.projectMembers.splice(e,1),Object(S["b"])({title:"移除成功"},"notice","success"))})),Promise.resolve()}})},inviteMember:function(t){Object(b["b"])(t.memberCode,this.projectCode).then((function(e){var a=Object(k["a"])(e);a&&(t.joined=!0)}))},searchInviteMember:s.a.debounce((function(){var t=this;if(this.inviteMemberDraw.keyword||(this.projectMembers=JSON.parse(JSON.stringify(this.projectMembersCopy))),this.inviteMemberDraw.keyword.length<=1)return!1;this.searching=!0,this.projectMembers=this.projectMembers.filter((function(e){return-1!=e.name.indexOf(t.inviteMemberDraw.keyword)}))}),500),updateProject:function(t){this.project=t},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(w["a"])(this.project.code,e).then((function(e){Object(k["a"])(e)&&(t.project.collected=!t.project.collected)}))},handleChange:function(t){if("uploading"===t.file.status)return Object(S["b"])("正在导入，请稍后...","message","loading",0),void(this.uploadLoading=!0);if("done"===t.file.status&&(console.log(t),this.uploadLoading=!1,Object(k["a"])(t.file.response,!0))){var e=t.file.response.data;e?Object(S["b"])("成功导入".concat(e,"个任务"),"message","success"):Object(S["b"])("没有成功导入任何任务","message","warning"),this.getTaskStages(!1)}},beforeUpload:function(t){var e=t.size/1024/1024<2;return e||this.$message.error("文件不能超过2MB!"),e}}}},b625:function(t,e,a){}}]);