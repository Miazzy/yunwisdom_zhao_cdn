(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d67ddfa4"],{"0d4e":function(t,e,n){},"20d6":function(t,e,n){"use strict";var i=n("5ca1"),a=n("0a49")(6),r="findIndex",o=!0;r in[]&&Array(1)[r]((function(){o=!1})),i(i.P+i.F*o,"Array",{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),n("9c6c")(r)},"261e":function(t,e,n){"use strict";var i=n("92fa"),a=n.n(i),r=n("6042"),o=n.n(r),s=n("41b2"),c=n.n(s),u=n("4d26"),l=n.n(u),d=n("0464"),m=n("6dd8"),f=n("c973"),p="\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n",h=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","font-variant","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"],v={},b=void 0;function k(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAttribute("id")||t.getAttribute("data-reactid")||t.getAttribute("name");if(e&&v[n])return v[n];var i=window.getComputedStyle(t),a=i.getPropertyValue("box-sizing")||i.getPropertyValue("-moz-box-sizing")||i.getPropertyValue("-webkit-box-sizing"),r=parseFloat(i.getPropertyValue("padding-bottom"))+parseFloat(i.getPropertyValue("padding-top")),o=parseFloat(i.getPropertyValue("border-bottom-width"))+parseFloat(i.getPropertyValue("border-top-width")),s=h.map((function(t){return t+":"+i.getPropertyValue(t)})).join(";"),c={sizingStyle:s,paddingSize:r,borderSize:o,boxSizing:a};return e&&n&&(v[n]=c),c}function g(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;b||(b=document.createElement("textarea"),document.body.appendChild(b)),t.getAttribute("wrap")?b.setAttribute("wrap",t.getAttribute("wrap")):b.removeAttribute("wrap");var a=k(t,e),r=a.paddingSize,o=a.borderSize,s=a.boxSizing,c=a.sizingStyle;b.setAttribute("style",c+";"+p),b.value=t.value||t.placeholder||"";var u=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,d=b.scrollHeight,m=void 0;if("border-box"===s?d+=o:"content-box"===s&&(d-=r),null!==n||null!==i){b.value=" ";var f=b.scrollHeight-r;null!==n&&(u=f*n,"border-box"===s&&(u=u+r+o),d=Math.max(u,d)),null!==i&&(l=f*i,"border-box"===s&&(l=l+r+o),m=d>l?"":"hidden",d=Math.min(l,d))}return i||(m="hidden"),{height:d+"px",minHeight:u+"px",maxHeight:l+"px",overflowY:m}}var w=n("daa3"),y=n("4df5");function x(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,1)}function C(t){window.cancelAnimationFrame?window.cancelAnimationFrame(t):window.clearTimeout(t)}function j(t){return"undefined"===typeof t||null===t?"":t}function M(){}e["a"]={name:"ATextarea",model:{prop:"value",event:"change.value"},props:c()({},f["a"],{autosize:[Object,Boolean]}),inject:{configProvider:{default:function(){return y["a"]}}},data:function(){var t=this.$props,e=t.value,n=void 0===e?"":e,i=t.defaultValue,a=void 0===i?"":i;return{stateValue:j(Object(w["b"])(this,"value")?n:a),nextFrameActionId:void 0,textareaStyles:{}}},computed:{},watch:{value:function(t){var e=this;this.$nextTick((function(){e.resizeOnNextFrame()})),this.stateValue=j(t)},autosize:function(t){!t&&this.$refs.textArea&&(this.textareaStyles=Object(d["a"])(this.textareaStyles,["overflowY"]))}},mounted:function(){var t=this;this.$nextTick((function(){t.resizeTextarea(),t.updateResizeObserverHook(),t.autoFocus&&t.focus()}))},updated:function(){this.updateResizeObserverHook()},beforeDestroy:function(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{resizeOnNextFrame:function(){this.nextFrameActionId&&C(this.nextFrameActionId),this.nextFrameActionId=x(this.resizeTextarea)},updateResizeObserverHook:function(){!this.resizeObserver&&this.$props.autosize?(this.resizeObserver=new m["a"](this.resizeOnNextFrame),this.resizeObserver.observe(this.$refs.textArea)):this.resizeObserver&&!this.$props.autosize&&(this.resizeObserver.disconnect(),this.resizeObserver=null)},handleKeyDown:function(t){13===t.keyCode&&this.$emit("pressEnter",t),this.$emit("keydown",t)},resizeTextarea:function(){var t=this.$props.autosize;if(t&&this.$refs.textArea){var e=t.minRows,n=t.maxRows,i=g(this.$refs.textArea,!1,e,n);this.textareaStyles=i}},handleTextareaChange:function(t){var e=t.target,n=e.value,i=e.composing;i||this.stateValue===n||(Object(w["b"])(this,"value")?this.$forceUpdate():(this.stateValue=n,this.resizeTextarea()),this.$emit("change.value",n),this.$emit("change",t),this.$emit("input",t))},focus:function(){this.$refs.textArea.focus()},blur:function(){this.$refs.textArea.blur()}},render:function(){var t=arguments[0],e=this.stateValue,n=this.handleKeyDown,i=this.handleTextareaChange,r=this.textareaStyles,s=this.$attrs,u=this.$listeners,m=this.prefixCls,f=this.disabled,p=Object(d["a"])(this.$props,["prefixCls","autosize","type","value","defaultValue","lazy"]),h=this.configProvider.getPrefixCls,v=h("input",m),b=l()(v,o()({},v+"-disabled",f)),k={directives:[{name:"ant-input"}],attrs:c()({},p,s),on:c()({},u,{keydown:n,input:i,change:M})};return t("textarea",a()([k,{domProps:{value:e},class:b,style:r,ref:"textArea"}]))}}},"386b":function(t,e,n){var i=n("5ca1"),a=n("79e5"),r=n("be13"),o=/"/g,s=function(t,e,n,i){var a=String(r(t)),s="<"+e;return""!==n&&(s+=" "+n+'="'+String(i).replace(o,"&quot;")+'"'),s+">"+a+"</"+e+">"};t.exports=function(t,e){var n={};n[t]=e(s),i(i.P+i.F*a((function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3})),"String",n)}},"3ed7":function(t,e,n){"use strict";var i=n("0d4e"),a=n.n(i);a.a},"81fe":function(t,e,n){"use strict";n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return r})),n.d(e,"d",(function(){return o}));n("3b2b"),n("a481");var i=function(t,e){e||(e=moment());var n=moment(e).diff(moment(t),"hours");if(n<=1)return moment(t).fromNow();moment(e).get("date"),moment(t).get("date");var i=moment(t).format("H:mm"),a=moment(t).format("YYYY-MM-DD"),r=moment().weekday(0).format("YYYY-MM-DD"),o=moment().weekday(6).format("YYYY-MM-DD"),s="";return s=a<r?"[上周]dd "+i:a>o?"[下周]dd "+i:"[周]dd "+i,moment(t).calendar(null,{sameDay:"[今天 ]"+moment(t).format("H:mm"),nextDay:"[明天 ]"+i,nextWeek:s,lastDay:"[昨天 ]"+i,lastWeek:s,sameElse:"M月D日 H:mm"})},a=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=moment(t).format("H:mm");e||(n="");var i=moment(t).format("YYYY-MM-DD"),a=moment().weekday(0).format("YYYY-MM-DD"),r=moment().weekday(6).format("YYYY-MM-DD"),o="";return o=i<a?"[上周]dd "+n:i>r?"[下周]dd "+n:"[周]dd "+n,moment(t).calendar(null,{sameDay:"[今天 ]"+moment(t).format("H:mm"),nextDay:"[明天 ]"+n,nextWeek:o,lastDay:"[昨天 ]"+n,lastWeek:o,sameElse:"M月D日 H:mm"})},r=function(t,e){return!e&&t?a(t)+" 开始":t?a(t)+" - "+a(e):a(e)+" 截止"},o=function(t){var e="";void 0==t&&(t=new Date);var n=t.getHours();return n>=0&&n<=4&&(e="深夜了，注意身体，"),n>=4&&n<7&&(e="清晨好， "),n>=7&&n<12&&(e="早安，"),n>=12&&n<=13&&(e="午饭时间到了，"),n>=13&&n<=17&&(e="下午好，"),n>=17&&n<=18&&(e="进入傍晚了，"),n>=18&&n<=20&&(e="吃过晚饭了吗，"),n>=20&&n<=24&&(e="在加班吗？辛苦了，"),e}},"82f8":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("22b6");function a(t){return i["a"].post("project/invite_link/save",t)}},8870:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n("22b6");function a(t){return i["a"].post("project/source_link/delete",{sourceCode:t})}},"9f5d":function(t,e,n){"use strict";n.d(e,"d",(function(){return a})),n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return s}));var i=n("22b6");function a(t,e){return i["a"].post("project/project_member/searchInviteMember",{keyword:t,projectCode:e})}function r(t,e){return i["a"].post("project/project_member/inviteMember",{memberCode:t,projectCode:e})}function o(t){return i["a"].post("project/project_member/index",t)}function s(t){return i["a"].post("project/project_member/_listForInvite",t)}},b199:function(t,e,n){"use strict";n.d(e,"e",(function(){return a})),n.d(e,"j",(function(){return r})),n.d(e,"c",(function(){return o})),n.d(e,"d",(function(){return s})),n.d(e,"k",(function(){return c})),n.d(e,"a",(function(){return u})),n.d(e,"g",(function(){return l})),n.d(e,"l",(function(){return d})),n.d(e,"i",(function(){return m})),n.d(e,"h",(function(){return f})),n.d(e,"b",(function(){return p})),n.d(e,"f",(function(){return h}));var i=n("22b6");function a(t){return i["a"].post("project/task",t)}function r(t){return i["a"].post("project/task/save",t)}function o(t){return i["a"].post("project/task/edit",t)}function s(t,e){return i["a"].post("project/task/like",{like:e,taskCode:t})}function c(t,e){return i["a"].post("project/task/star",{star:e,taskCode:t})}function u(t,e,n){return i["a"].post("project/task/createComment",{taskCode:t,comment:e,mentions:n})}function l(t){return i["a"].post("project/task/read",{taskCode:t})}function d(t,e){return i["a"].post("project/task/taskDone",{taskCode:t,done:e})}function m(t){return i["a"].post("project/task/recycle",{taskCode:t})}function f(t){return i["a"].post("project/task/recovery",{taskCode:t})}function p(t){return i["a"].post("project/task/delete",{taskCode:t})}function h(t){return i["a"].post("project/task/taskLog",t)}},b54a:function(t,e,n){"use strict";n("386b")("link",(function(t){return function(e){return t(this,"a","href",e)}}))},c973:function(t,e,n){"use strict";var i=n("4d91");e["a"]={prefixCls:i["a"].string,inputPrefixCls:i["a"].string,defaultValue:[String,Number],value:[String,Number],placeholder:[String,Number],type:{default:"text",type:String},name:String,size:{validator:function(t){return["small","large","default"].includes(t)}},disabled:{default:!1,type:Boolean},readOnly:Boolean,addonBefore:i["a"].any,addonAfter:i["a"].any,prefix:i["a"].any,suffix:i["a"].any,spellCheck:Boolean,autoFocus:Boolean,allowClear:Boolean,lazy:{default:!0,type:Boolean}}},d3a1:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("a-modal",{staticClass:"invite-project-member",attrs:{width:500,title:t.actionInfo.modalTitle,footer:null},on:{cancel:t.cancel},model:{value:t.actionInfo.modalStatus,callback:function(e){t.$set(t.actionInfo,"modalStatus",e)},expression:"actionInfo.modalStatus"}},[n("div",{staticClass:"header"},[n("span",[t._v("账号邀请")]),n("a",{on:{click:t.createInviteLink}},[t._v("通过链接邀请")])]),n("div",{staticClass:"search-content m-b"},[n("a-input",{attrs:{placeholder:"输入昵称或邮箱查找"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[n("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),n("vue-scroll",[n("div",{staticClass:"member-list"},[n("a-list",{staticClass:"project-list",attrs:{itemLayout:"horizontal",loading:t.searching,dataSource:t.list,locale:{emptyText:t.keyword&&t.keyword.length>1?"没有搜索到相关成员":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return n("a-list-item",{},[n("span",{attrs:{slot:"actions"},slot:"actions"},[e.joined?[n("a-icon",{attrs:{type:"user"}}),n("span",[t._v("已加入")])]:n("a-button",{attrs:{size:"small",type:"dashed",icon:"user-add"},on:{click:function(n){return t.invite(e)}}},[t._v("邀请")])],2),n("a-list-item-meta",{attrs:{description:e.email}},[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),n("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1)])],1),n("a-modal",{staticClass:"invite-link",attrs:{width:600,title:t.linkInfo.modalTitle,footer:null},model:{value:t.linkInfo.modalStatus,callback:function(e){t.$set(t.linkInfo,"modalStatus",e)},expression:"linkInfo.modalStatus"}},[n("div",{staticClass:"header"},[n("p",[t._v("链接有效日期："+t._s(t.linkInfo.overTime))]),n("a-input-search",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.linkInfo.link,expression:"linkInfo.link",arg:"copy"}],attrs:{size:"large",enterButton:"复制链接"},model:{value:t.linkInfo.link,callback:function(e){t.$set(t.linkInfo,"link",e)},expression:"linkInfo.link"}})],1)])],1)},a=[],r=(n("28a5"),n("b54a"),n("386d"),n("c5f6"),n("2ef0")),o=n.n(r),s=n("9f5d"),c=n("2f14"),u=n("82f8"),l={name:"inviteProjectMember",props:{value:{type:Boolean,default:function(){return!1}},projectCode:{type:[String,Number],default:function(){return""}}},data:function(){return{form:this.$form.createForm(this),actionInfo:{modalStatus:this.value,confirmLoading:!1,modalTitle:"邀请新成员"},linkInfo:{modalStatus:!1,confirmLoading:!1,modalTitle:"邀请成员",link:"",overTime:""},keyword:"",searching:!1,list:[]}},watch:{value:function(t){this.actionInfo.modalStatus=t},keyword:function(){this.search()}},created:function(){this.getMembers()},methods:{getMembers:function(){var t=this;Object(s["a"])({projectCode:t.projectCode}).then((function(e){t.list=e.data}))},invite:function(t){Object(s["b"])(t.memberCode,this.projectCode).then((function(e){var n=Object(c["a"])(e);n&&(t.joined=!0)}))},createInviteLink:function(){var t=this;this.linkInfo.link?this.linkInfo.modalStatus=!0:Object(u["a"])({inviteType:"project",sourceCode:this.projectCode}).then((function(e){var n=Object(c["a"])(e);n&&(t.linkInfo.modalStatus=!0,t.linkInfo.link=window.location.href.split("#")[0]+"#/invite_from_link/"+e.data.code,t.linkInfo.overTime=moment(e.data.code.over_time).format("YYYY年M月D日 HH:mm"))}))},search:o.a.debounce((function(){var t=this;if(this.keyword||(this.list=[]),this.keyword.length<=1)return this.getMembers(),!1;this.searching=!0,Object(s["d"])(this.keyword,this.projectCode).then((function(e){t.searching=!1,t.list=e.data}))}),500),cancel:function(){this.actionInfo.modalStatus=!1,this.$emit("input",this.actionInfo.modalStatus)}}},d=l,m=(n("3ed7"),n("2877")),f=Object(m["a"])(d,i,a,!1,null,null,null);e["default"]=f.exports},d8bc:function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return r}));var i=n("22b6");function a(t){return i["a"].post("project/task_member",t)}function r(t){return i["a"].post("project/task_member/inviteMemberBatch",t)}},e8d3:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"member-menu project-member-menu"},[n("a-spin",{attrs:{spinning:t.projectMemberLoading||t.taskMemberLoading}},[n("div",{staticClass:"search-content"},[n("a-input",{attrs:{size:"large",placeholder:"搜索"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[n("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),n("div",{staticClass:"member-list"},[n("vue-scroll",[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.keyword,expression:"!keyword"}],staticClass:"list-group"},[n("span",{staticClass:"title muted"},[t._v("参与者")]),n("a-list",{directives:[{name:"show",rawName:"v-show",value:t.taskMemberList.length,expression:"taskMemberList.length"}],staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.taskMemberList},scopedSlots:t._u([{key:"renderItem",fn:function(e){return n("a-list-item",{staticClass:"member-list-item",class:{owner:e.is_owner},nativeOn:{click:function(n){return t.addToInvite(e.code,e.is_owner)}}},[n("span",{attrs:{slot:"actions"},slot:"actions"},[n("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e.code),expression:"showCheck(item.code)"}],attrs:{type:"check"}})],1),n("a-list-item-meta",[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),n("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1)}}])})],1),n("div",{staticClass:"list-group"},[n("span",{staticClass:"title muted"},[t._v("其他成员")]),n("div",{staticClass:"member-list-item ant-list-item",on:{click:function(e){return t.addToInvite("all")}}},[n("div",{staticClass:"ant-list-item-meta"},[n("div",{staticClass:"ant-list-item-meta-avatar"},[n("a-avatar",{attrs:{icon:"user"}})],1),n("div",{staticClass:"ant-list-item-meta-content"},[n("h4",{staticClass:"ant-list-item-meta-title"},[n("span",[t._v("所有项目成员")])])])]),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.showCheck("all"),expression:"showCheck('all')"}],staticClass:"ant-list-item-action"},[n("li",[n("span",[n("a-icon",{attrs:{type:"check"}})],1)])])]),n("a-list",{staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.projectMemberList,locale:{emptyText:t.keyword&&t.keyword.length>1?"该成员不在项目成员列表中":""}},scopedSlots:t._u([{key:"renderItem",fn:function(e){return t.showMember(e)?n("a-list-item",{staticClass:"member-list-item",nativeOn:{click:function(n){return t.addToInvite(e.code,!1)}}},[n("span",{attrs:{slot:"actions"},slot:"actions"},[n("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e.code),expression:"showCheck(item.code)"}],attrs:{type:"check"}})],1),n("a-list-item-meta",[n("span",{attrs:{slot:"title"},slot:"title"},[t._v(t._s(e.name))]),n("a-avatar",{attrs:{slot:"avatar",icon:"user",src:e.avatar},slot:"avatar"})],1)],1):t._e()}}],null,!0)})],1)])],1),n("div",{staticClass:"footer"},[n("a-button",{attrs:{type:"primary",size:"large",block:""},on:{click:t.inviteTaskMember}},[t._v("确定")])],1)])],1)},a=[],r=(n("7f7f"),n("20d6"),n("7514"),n("ac6a"),n("386d"),n("c5f6"),n("2ef0")),o=n.n(r),s=n("9f5d"),c=n("d8bc"),u={name:"projectMemberMenu",props:{projectCode:{type:[String,Number],default:function(){return""}},taskCode:{type:[String,Number],default:function(){return""}}},data:function(){return{keyword:"",searching:!1,taskMemberLoading:!0,projectMemberLoading:!0,showInviteMember:!1,taskMemberList:[],projectMemberList:[],listTemp:[],projectMemberListCopy:[],initAllMember:!1}},created:function(){this.init()},watch:{keyword:function(){this.search()}},methods:{init:function(){var t=this;this.projectMemberLoading=!0,this.taskMemberLoading=!0,this.projectCode&&Object(s["c"])({projectCode:this.projectCode,pageSize:300}).then((function(e){t.projectMemberList=e.data.list,t.projectMemberListCopy=e.data.list,t.projectMemberLoading=!1})),this.taskCode&&Object(c["b"])({taskCode:this.taskCode,pageSize:300}).then((function(e){t.taskMemberList=e.data.list,e.data.list.forEach((function(e){t.listTemp.push(e.code)})),t.taskMemberLoading=!1}))},showMember:function(t){var e=!0;return this.taskMemberList.forEach((function(n){t.code==n.code&&(e=!1)})),e},showCheck:function(t){if("all"==t&&!this.initAllMember)return!1;var e=this.listTemp.find((function(e){return e==t}));return!!e||void 0},addToInvite:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return!1;"all"==t&&(this.initAllMember=!0);var n=this.listTemp.findIndex((function(e){return e==t}));-1!==n?this.listTemp.splice(n,1):this.listTemp.push(t)},inviteTaskMember:function(){var t=this,e=[];this.taskMemberList.forEach((function(n){var i=t.listTemp.findIndex((function(t){return t==n.code}));-1===i&&e.push(n.code)})),this.listTemp.forEach((function(n){var i=t.taskMemberList.findIndex((function(t){return n==t.code}));-1===i&&e.push(n)})),e?Object(c["a"])({memberCodes:JSON.stringify(e),taskCode:this.taskCode}).then((function(){t.$emit("close")})):this.$emit("close")},search:o.a.debounce((function(){var t=this;if(this.keyword=this.keyword.trim(),this.keyword||(this.projectMemberList=JSON.parse(JSON.stringify(this.projectMemberListCopy))),this.keyword.length<=1)return!1;this.searching=!0,this.projectMemberList=this.projectMemberList.filter((function(e){return-1!=e.name.indexOf(t.keyword)}))}),500)}},l=u,d=n("2877"),m=Object(d["a"])(l,i,a,!1,null,null,null);e["default"]=m.exports}}]);