(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["index~72d59f9f"],{"2b1f":function(t,e,s){},"2fb4":function(t,e,s){"use strict";var n=s("e919"),i=s.n(n);i.a},3396:function(t,e,s){},"3a4c":function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{attrs:{id:"header"}},[s("v-header")],1),s("div",{staticClass:"edit-container"},[t.titleChange?t._e():s("h2",{on:{click:t.titleClick}},[t._v(t._s(t.qsItem.title))]),t.titleChange?s("input",{directives:[{name:"model",rawName:"v-model",value:t.titleValue,expression:"titleValue"}],ref:"titleInput",attrs:{type:"text",name:"qsTitle"},domProps:{value:t.titleValue},on:{blur:t.onblur,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onsubmit(e)},input:function(e){e.target.composing||(t.titleValue=e.target.value)}}}):t._e(),s("div",{staticClass:"content"},[t._l(t.qsItem.question,(function(e,n){return s("div",{staticClass:"questions"},[s("div",{staticClass:"qs-left"},[s("p",{staticClass:"qs-title"},[t._v("\n            "+t._s(e.num)+" "+t._s(e.title)+" "+t._s(t.getMsg(e))+"\n          ")]),t._l(e.options,(function(n){return s("p",{staticClass:"option"},[s("label",["radio"===e.type?s("input",{attrs:{type:"radio",name:e.num+"-"+e.title}}):t._e(),"checkbox"===e.type?s("input",{attrs:{type:"checkbox",name:e.num+"-"+e.title}}):t._e(),t._v("\n              "+t._s(n)+"\n            ")])])})),"textarea"===e.type?s("textarea"):t._e()],2),s("div",{staticClass:"qs-right"},[s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.isNeed,expression:"qs.isNeed"}],attrs:{type:"checkbox"},domProps:{value:e.isNeed,checked:Array.isArray(e.isNeed)?t._i(e.isNeed,e.isNeed)>-1:e.isNeed},on:{change:function(s){var n=e.isNeed,i=s.target,r=!!i.checked;if(Array.isArray(n)){var a=e.isNeed,o=t._i(n,a);i.checked?o<0&&t.$set(e,"isNeed",n.concat([a])):o>-1&&t.$set(e,"isNeed",n.slice(0,o).concat(n.slice(o+1)))}else t.$set(e,"isNeed",r)}}}),t._v("\n            此题是否必填\n          ")]),s("p",[0!==n?s("span",{staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.goUp(n)}}},[t._v("上移")]):t._e(),n!==t.qsItem.question.length-1?s("span",{staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.goDown(n)}}},[t._v("下移")]):t._e(),s("span",{staticStyle:{"margin-right":"5px"},on:{click:function(s){return t.copy(n,e)}}},[t._v("复用")]),s("span",{staticStyle:{"margin-right":"5px"},on:{click:function(e){return t.del(n)}}},[t._v("删除")])])])])})),s("div",{staticClass:"add"},[s("transition",{attrs:{name:"slide"}},[t.showBtn?s("div",{staticClass:"add-option"},[s("button",{on:{click:t.addRadio}},[t._v("单选")]),s("button",{on:{click:t.addCheckbox}},[t._v("多选")]),s("button",{on:{click:t.addTextarea}},[t._v("文本框")])]):t._e()]),s("div",{staticClass:"add-item",on:{click:t.addItemClick}},[s("span",{staticClass:"add-icon"},[t._v("+")]),s("span",[t._v("添加问题")])])],1)],2),t.showAddQsDialog?s("div",{staticClass:"shadow"},[s("div",{staticClass:"add-qs-dialog"},[s("header",[s("span",[t._v("提示")]),s("span",{staticClass:"close-btn",on:{click:function(e){t.showAddQsDialog=!1}}},[t._v("X")])]),s("p",[t._v(t._s(t.info))]),s("label",[t._v("\n          输入题目标题\n          "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.qsInputTitle,expression:"qsInputTitle"}],attrs:{type:"text"},domProps:{value:t.qsInputTitle},on:{input:function(e){e.target.composing||(t.qsInputTitle=e.target.value)}}})]),t.showAddOptionInput?s("label",[t._v("\n          输入选项\n          "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.qsInputOptions,expression:"qsInputOptions"}],attrs:{type:"text"},domProps:{value:t.qsInputOptions},on:{input:function(e){e.target.composing||(t.qsInputOptions=e.target.value)}}})]):t._e(),s("div",{staticClass:"btn-box"},[s("button",{staticClass:"yes",on:{click:t.validateAddQs}},[t._v("确定")]),s("button",{on:{click:function(e){t.showAddQsDialog=!1}}},[t._v("取消")])])])]):t._e(),t.showDialog?s("div",{staticClass:"shadow"},[s("div",{staticClass:"dialog"},[s("header",[s("span",[t._v("提示")]),s("span",{staticClass:"close-btn",on:{click:t.cancel}},[t._v("X")])]),s("p",[t._v(t._s(t.info))]),s("div",{staticClass:"btn-box"},[s("button",{staticClass:"yes",on:{click:function(e){return t.iterator.next()}}},[t._v("确定")]),s("button",{on:{click:t.cancel}},[t._v("取消")])])])]):t._e(),s("footer",[s("span",[t._v("问卷截止日期")]),s("calendar-input",{attrs:{showCalendar:!1,limit:t.limit},on:{getValue:t.getValue}}),s("div",{staticClass:"btn-box"},[s("button",{staticClass:"save",on:{click:function(e){t.iterator=t.save(),t.iterator.next()}}},[t._v("\n          保存问卷\n        ")]),s("button",{staticClass:"issue",on:{click:function(e){t.iterator=t.issueQs(),t.iterator.next()}}},[t._v("\n          发布问卷\n        ")])])],1)])])},i=[],r=(s("ac6a"),s("28a5"),s("768b")),a=(s("96cf"),s("3b8d")),o=s("98a8"),c=s("805b"),u=s("d174"),l=s("5d2d"),h=s("ca00"),d=s("0fea"),m=s("1c9b"),p={name:"QsEdit",components:{calendarInput:m["default"],vHeader:u["default"]},data:function(){return{qsItem:{},qsList:[],isError:!1,showBtn:!1,titleChange:!1,titleValue:"",showAddQsDialog:!1,showAddOptionInput:!0,qsInputTitle:"",qsInputOptions:[],info:"",selectTime:"",addOptionType:"",limit:{},showDialog:!1,iterator:{},userInfo:{},isGoIndex:!1}},beforeRouteEnter:function(t,e,s){try{var n=l["e"]("cur_user"),i=t.params.num,r={};if(0!=i){for(var a=l["d"](l["a"]+n.username).length,o=0;o<a;o++){var c=l["d"](l["a"]+n.username)[o].id==i;if(c){r=l["d"](l["a"]+n.username)[o];break}}this.qsItem=r,console.log("item : ".concat(r))}}catch(u){console.error(u)}s()},created:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e=this.userInfo=l["e"]("cur_user"),t.t0=l["d"](l["a"]+e.username),t.t0){t.next=7;break}return t.next=6,d["queryQuestionList"](e.username);case 6:t.t0=t.sent;case 7:s=t.t0,this.qsList=s||[],this.fetchData(),t.next=15;break;case 12:t.prev=12,t.t1=t["catch"](0),console.error(t.t1);case 15:case"end":return t.stop()}}),t,this,[[0,12]])})));function e(){return t.apply(this,arguments)}return e}(),methods:{fetchData:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e,s,n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,e=(new Date).getTime(),this.limit={minYear:(new Date).getFullYear(),minMonth:(new Date).getMonth()+1,minDay:(new Date).getDate(),maxYear:2099,maxMonth:12,maxDay:31},0!=this.$route.params.num){t.next=19;break}s={},s.id=h["m"](),s.create_by=this.userInfo.username,s.create_time=h["i"](e,"yyyy-MM-dd"),s.num=this.qsList.length+1,s.title=s.name="这里是标题",s.time=h["i"](e,"yyyy-MM-dd"),s.state="noissue",s.question=[],s.stateTitle="未发布",s.checked="false",this.qsItem=s;try{this.qsList.push(this.qsItem)}catch(r){console.log(r)}t.next=29;break;case 19:n=0,i=this.qsList.length;case 21:if(!(n<i)){t.next=28;break}if(this.qsList[n].id!=this.$route.params.num){t.next=25;break}try{this.qsItem=this.qsList[n],this.qsItem.question=JSON.parse(this.qsItem.question)}catch(r){console.error(r)}return t.abrupt("break",28);case 25:n++,t.next=21;break;case 28:n===this.qsList.length&&(this.isError=!0);case 29:t.next=34;break;case 31:t.prev=31,t.t0=t["catch"](0),console.error(t.t0);case 34:case"end":return t.stop()}}),t,this,[[0,31]])})));function e(){return t.apply(this,arguments)}return e}(),getMsg:function(t){try{var e="";return e="radio"===t.type?"(单选题)":"checkbox"===t.type?"(多选题)":"(文本题)",t.isNeed?"".concat(e," *"):e}catch(s){console.error(s)}},onblur:function(){try{this.titleValue=this.titleValue.trim(),this.qsItem.title=""===this.titleValue?this.qsItem.title:this.titleValue,this.titleChange=!1}catch(t){console.error(t)}},onsubmit:function(){try{this.titleValue=this.titleValue.trim(),this.qsItem.title=""===this.titleValue?this.qsItem.title:this.titleValue,this.titleChange=!1}catch(t){console.error(t)}},titleClick:function(){var t=this;try{this.titleChange=!this.titleChange,setTimeout((function(){t.$refs.titleInput.focus()}),150)}catch(e){console.error(e)}},swapItems:function(t,e){try{var s=this.qsItem.question.splice(e,1,this.qsItem.question[t]),n=Object(r["a"])(s,1),i=n[0];this.qsItem.question.splice(t,1,i)}catch(a){console.error(a)}},goUp:function(t){try{this.swapItems(t,t-1)}catch(e){console.error(e)}},goDown:function(t){try{this.swapItems(t,t+1)}catch(e){console.error(e)}},copy:function(t,e){try{if(10===this.questionLength)return alert("问卷已满！");e=Object.assign({},e),this.qsItem.question.splice(t,0,e)}catch(s){console.error(s)}},del:function(t){try{this.qsItem.question.splice(t,1)}catch(e){console.error(e)}},addItemClick:function(){try{!1===this.showBtn&&10===this.questionLength?alert("问卷已满！"):this.showBtn=!this.showBtn}catch(t){console.error(t)}},showAddDialog:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(e,s){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:try{this.showAddQsDialog=!0,this.showAddOptionInput=s,this.info=e,this.qsInputTitle="",this.qsInputOptions=""}catch(n){console.error(n)}case 1:case"end":return t.stop()}}),t,this)})));function e(e,s){return t.apply(this,arguments)}return e}(),addRadio:function(){try{if(10===this.questionLength)return alert("问卷已满！");this.showAddDialog('分别在下面的输入框中输入问题的名称以及选项, 选项用半角逗号","分隔开',!0),this.addOptionType="radio"}catch(t){console.error(t)}},addCheckbox:function(){try{if(10===this.questionLength)return alert("问卷已满！");this.showAddDialog('分别在下面的输入框中输入问题的名称以及选项, 选项用半角逗号","分隔开',!0),this.addOptionType="checkbox"}catch(t){console.error(t)}},addTextarea:function(){try{if(10===this.questionLength)return alert("问卷已满！");this.showAddDialog("在输入框中输入问题名称",!1),this.addOptionType="textarea"}catch(t){console.error(t)}},validateAddQs:function(){try{var t=this.qsInputTitle.trim();if(""===t)return alert("题目不能为空");if(this.showAddOptionInput){var e=this.qsInputOptions.trim();if(""===e)return alert("选项不能为空！");e=e.split(",");for(var s=0,n=e.length;s<n;s++)if(""===e[s].trim())return alert("存在某个选项内容为空");this.qsItem.question.push({num:this.qsItem.question.length-1,title:t,type:this.addOptionType,isNeed:!0,options:e}),this.showAddQsDialog=!1}else this.qsItem.question.push({num:this.qsItem.question.length-1,title:t,type:"textarea",isNeed:!0}),this.showAddQsDialog=!1}catch(i){console.error(i)}},getValue:function(t){try{this.selectTime=t,this.qsItem.time=this.selectTime}catch(e){console.error(e)}},save:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var s,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,s=l["e"]("cur_user"),t.showDialog=!0,t.info="确认保存?",void(e.next=6);case 6:if(0!==t.qsItem.question.length){e.next=11;break}t.showDialog=!1,alert("问卷为空无法保存"),e.next=17;break;case 11:return l["f"](t.qsList,l["a"]+s.username),t.qsItem.content=t.qsItem.question=JSON.stringify(t.qsItem.question),e.next=15,Object(o["a"])(d["postTableData"]("bs_questions",t.qsItem));case 15:t.info="是否发布?",t.isGoIndex=!0;case 17:return void(e.next=19);case 19:return n={id:t.qsItem.id,state:"inissue",stateTitle:"发布中"},i=["bs_questions",t.qsItem.id,n],l["f"](t.qsList,l["a"]+s.username),e.next=24,Object(o["a"])(d["patchTableData"].apply(d,i));case 24:t.showDialog=!1,t.$router.push({path:"/qslist"}),e.next=31;break;case 28:e.prev=28,e.t0=e["catch"](0),console.error(e.t0);case 31:case"end":return e.stop()}}),e,null,[[0,28]])})))()},issueQs:function(){var t=this;return Object(c["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return s=l["e"]("cur_user"),t.showDialog=!0,t.info="确认发布?",void(e.next=5);case 5:if(0!==t.qsItem.question.length){e.next=10;break}t.showDialog=!1,alert("问卷为空无法保存"),e.next=18;break;case 10:return t.qsItem.state="inissue",t.qsItem.stateTitle="发布中",l["f"](t.qsList,l["a"]+s.username),t.qsItem.content=t.qsItem.question=JSON.stringify(t.qsItem.question),e.next=16,Object(o["a"])(d["postTableData"]("bs_questions",t.qsItem));case 16:t.showDialog=!1,t.$router.push({path:"/qslist"});case 18:case"end":return e.stop()}}),e)})))()},cancel:function(){this.showDialog=!1,!0===this.isGoIndex&&this.$router.push({path:"/qslist"})}},computed:{questionLength:function(){try{return this.qsItem.question.length}catch(t){return 0}}},watch:{$route:"fetchData",qsItem:{handler:function(t){t.question.forEach((function(t,e){t.num="Q".concat(e+1)}))},deep:!0}}},f=p,v=(s("9c94"),s("2877")),q=Object(v["a"])(f,n,i,!1,null,"3d1e2611",null);e["default"]=q.exports},4922:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{attrs:{id:"header"}},[s("v-header")],1),s("div",{staticClass:"qs-list"},[0!=t.qsList.length?s("ul",[s("li"),s("li",[t._v("标题")]),s("li",[t._v("截止时间")]),s("li",[t._v("状态")]),s("li",[t._v("\n        操作\n        "),s("span",{on:{click:function(e){return t.$router.push({name:"QsEdit",params:{num:0}})}}},[t._v("+新建问卷")])])]):t._e(),t._l(t.qsList,(function(e){return[s("ul",[s("li",[s("input",{directives:[{name:"model",rawName:"v-model",value:e.checked,expression:"item.checked"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.checked)?t._i(e.checked,null)>-1:e.checked},on:{change:function(s){var n=e.checked,i=s.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=t._i(n,a);i.checked?o<0&&t.$set(e,"checked",n.concat([a])):o>-1&&t.$set(e,"checked",n.slice(0,o).concat(n.slice(o+1)))}else t.$set(e,"checked",r)}}})]),s("li",[t._v(t._s(e.title))]),s("li",[t._v(t._s(e.time))]),s("li",{class:"inissue"===e.state?"inissue":""},[t._v("\n          "+t._s(e.stateTitle)+"\n        ")]),s("li",[s("router-link",{attrs:{to:"/qsedit/"+e.id,tag:"button"}},[t._v("编辑")]),s("router-link",{attrs:{to:"/qsfill/"+e.id,tag:"button"}},[t._v("查看问卷")]),s("button",{on:{click:function(s){t.iterator=t.watchData(e),t.iterator.next()}}},[t._v("\n            查看数据\n          ")]),s("button",{on:{click:function(s){t.iterator=t.delItem(e.num),t.iterator.next()}}},[t._v("\n            删除\n          ")])],1)])]})),0!=t.qsList.length?s("div",{staticClass:"list-bottom"},[s("label",[s("input",{directives:[{name:"model",rawName:"v-model",value:t.selectAll,expression:"selectAll"}],attrs:{type:"checkbox",id:"all-check"},domProps:{checked:Array.isArray(t.selectAll)?t._i(t.selectAll,null)>-1:t.selectAll},on:{change:function(e){var s=t.selectAll,n=e.target,i=!!n.checked;if(Array.isArray(s)){var r=null,a=t._i(s,r);n.checked?a<0&&(t.selectAll=s.concat([r])):a>-1&&(t.selectAll=s.slice(0,a).concat(s.slice(a+1)))}else t.selectAll=i}}}),t._v("全选\n      ")]),s("button",{on:{click:function(e){t.iterator=t.delItems(),t.iterator.next()}}},[t._v("\n        删除\n      ")])]):t._e(),0===t.qsList.length?s("div",{staticClass:"add-qs"},[s("button",{staticClass:"add-btn",on:{click:function(e){return t.$router.push({name:"QsEdit",params:{num:0}})}}},[t._v("\n        +  新建问卷\n      ")])]):t._e(),t.showDialog?s("div",{staticClass:"shadow"},[s("div",{staticClass:"del-dialog"},[s("header",[s("span",[t._v("提示")]),s("span",{staticClass:"close-btn",on:{click:function(e){t.showDialog=!1}}},[t._v("X")])]),s("p",[t._v(t._s(t.info))]),s("div",{staticClass:"btn-box"},[s("button",{staticClass:"yes",on:{click:function(e){return t.iterator.next()}}},[t._v("确定")]),s("button",{on:{click:function(e){t.showDialog=!1}}},[t._v("取消")])])])]):t._e()],2)])},i=[],r=(s("28a5"),s("768b")),a=(s("ac6a"),s("96cf"),s("3b8d")),o=(s("98a8"),s("805b")),c=s("d174"),u=s("5d2d"),l=s("ca00"),h=s("0fea"),d={name:"QsList",components:{vHeader:c["default"]},data:function(){return{qsList:[],showDialog:!1,iterator:{},info:""}},mounted:function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=u["e"]("cur_user"),t.t0=u["d"](u["a"]+e.username),t.t0){t.next=6;break}return t.next=5,h["queryQuestionList"](e.username);case 5:t.t0=t.sent;case 6:this.qsList=t.t0,null!==this.qsList&&this.qsList.forEach((function(t){t.time=l["i"](t.time,"yyyy-MM-dd");var e=t.time.split("-"),s=Object(r["a"])(e,3),n=s[0],i=s[1],a=s[2],o=n<(new Date).getFullYear()||n==(new Date).getFullYear()&&i<(new Date).getMonth()+1||n==(new Date).getFullYear()&&i==(new Date).getMonth()+1&&a<(new Date).getDate();o&&(t.state="issueed",t.stateTitle="已发布");try{t.question=JSON.parse(t.question)}catch(c){console.error(c)}}));case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:{showDialogMsg:function(t){this.showDialog=!0,this.info=t},delItem:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return n=u["e"]("cur_user"),s.next=3,e.showDialogMsg("确认要删除此问卷");case 3:return s.next=5,Object(a["a"])(regeneratorRuntime.mark((function s(){var i,r,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:i=0,r=e.qsList.length;case 2:if(!(i<r)){s.next=8;break}if(e.qsList[i].num!==t){s.next=5;break}return s.abrupt("break",8);case 5:i++,s.next=2;break;case 8:return a=e.qsList[i],e.qsList.splice(i,1),u["f"](e.qsList,u["a"]+n.username),s.next=13,h["deleteTableData"]("bs_questions",a.id);case 13:e.showDialog=!1;case 14:case"end":return s.stop()}}),s)})))();case 5:case"end":return s.stop()}}),s)})))()},delItems:regeneratorRuntime.mark((function t(){var e,s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=u["e"]("cur_user"),t.next=3,this.showDialogMsg("确认要删除选中的问卷？");case 3:return t.next=5,function(){s.showDialog=!1,s.selectAll?s.qsList=[]:s.selectGroup!=[]&&s.selectGroup.forEach(function(){var t=Object(a["a"])(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s.qsList.indexOf(n)>-1&&s.qsList.splice(s.qsList.indexOf(n),1),u["f"](s.qsList,u["a"]+e.username),t.next=4,h["deleteTableData"]("bs_questions",n.id);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}();case 5:case"end":return t.stop()}}),t,this)})),edit:regeneratorRuntime.mark((function t(e){var s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,function(){"noissue"===e.state?s.showDialogMsg("确认要编辑？"):(e.state="noissue",s.showDialogMsg("确认要编辑？"))}();case 2:return t.next=4,function(){"noissue"!==e.state?s.showDialog=!1:(s.showDialog=!1,s.$router.push("/qsedit/".concat(e.id)))}();case 4:case"end":return t.stop()}}),t)})),watchData:regeneratorRuntime.mark((function t(e){var s=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,function(){"noissue"===e.state?s.showDialogMsg("未发布的问卷无数据可查看"):s.$router.push("/qsdata/".concat(e.id))}();case 2:return t.next=4,this.showDialog=!1;case 4:case"end":return t.stop()}}),t,this)}))},computed:{selectAll:{get:function(){return this.selectCount===this.qsList.length&&0!==this.selectCount},set:function(t){return this.qsList.forEach((function(e){e.checked=t})),t}},selectCount:function(){var t=0;return this.qsList.forEach((function(e){e.checked&&t++})),t},selectGroup:function(){var t=[];return this.qsList.forEach((function(e){e.checked&&t.push(e)})),t}},watch:{qsList:{handler:function(t){t.forEach((function(t,e){t.num=e+1})),u["f"](t)},deep:!0}}},m=d,p=(s("2fb4"),s("2877")),f=Object(p["a"])(m,n,i,!1,null,"5651060c",null);e["default"]=f.exports},7424:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{attrs:{id:"header"}},[s("v-header")],1),s("div",{staticClass:"data-container"},[t.isError?t._e():[s("span",{staticClass:"back",on:{click:function(e){return t.goBack()}}},[t._v("< 返回")]),s("h2",[t._v(t._s(t.qsItem.title))]),s("p",[t._v("此统计分析只包含完整回收的数据(数据皆为自制数据模拟来mock数据)")])],t.isError?t._e():s("div",{staticClass:"content"},[t._l(t.qsItem.question,(function(e,n){return[s("div",{staticClass:"content-item"},[s("div",{staticClass:"item-left"},[s("p",[t._v(t._s(e.num)+"   "+t._s(e.title))]),t._l(e.options,(function(e){return s("p",{staticClass:"option"},[t._v(t._s(e))])}))],2),"radio"===e.type?s("div",{staticClass:"item-right"},[s("p",[t._v("数据占比")]),t._l(e.options,(function(n,i){return[s("div",{staticClass:"progress-bar"},["0%"!==t.renderProgressMath(e.options.length,i)?s("div",{staticClass:"bar-inner",style:{width:t.renderProgressMath(e.options.length,i)}}):t._e()]),s("span",{staticClass:"percent"},[t._v(t._s(t.renderProgressMath(e.options.length,i)))])]}))],2):"textarea"===e.type?s("div",{staticClass:"item-right"},[s("p",[t._v("有效回答占比")]),s("div",{staticClass:"progress-bar"},[s("div",{staticClass:"bar-inner",style:{width:"85%"}})]),s("span",{staticClass:"percent"},[t._v("85%")])]):s("div",{staticClass:"item-right"},[s("p",[t._v("数据占比")]),s("div",{attrs:{id:"chart-"+e.num}})])])]}))],2),t.isError?s("div",{staticClass:"error"},[t._v("404 Not Found")]):t._e()],2)])},i=[],r=(s("ac6a"),s("96cf"),s("3b8d")),a=s("d174"),o=s("5d2d"),c=s("3eba"),u=s.n(c),l=(s("c037"),s("007d"),s("b11c"),s("0fea")),h={name:"QsData",components:{vHeader:a["default"]},data:function(){return{qsItem:{},qsList:o["d"](),isError:!1,chartData:[],chartNum:[]}},created:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=o["e"]("cur_user"),t.t0=o["d"](o["a"]+e.username),t.t0){t.next=6;break}return t.next=5,l["queryQuestionList"](e.username);case 5:t.t0=t.sent;case 6:this.qsList=t.t0,this.fetchData();case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),mounted:function(){var t=this;this.renderChartData(),this.chartNum.forEach((function(e,s){t.renderEChart(e,t.chartData[s])}))},methods:{fetchData:function(){for(var t=0,e=this.qsList.length;t<e;t++)if(this.qsList[t].id==this.$route.params.num){try{this.qsItem=this.qsList[t],this.qsItem.question=JSON.parse(this.qsItem.question)}catch(s){console.error(s)}break}t===this.qsList.length&&(this.isError=!0)},renderProgressMath:function(t,e){return t<2?"100%":t>=2?0===e?"85%":1===e?"15%":"0%":void 0},renderChartData:function(){var t=this;this.qsItem.question.forEach((function(e){if("checkbox"===e.type){var s=0,n=0,i=[],r=e.options.length;t.chartNum.push(e.num),e.options.forEach((function(t,e){e==r-1?s=1e3-n:(s=Math.floor(Math.random()*(1001-n)),n+=s),i.push({value:s,name:t})})),t.chartData.push(i)}}))},renderEChart:function(t,e){var s=u.a.init(document.getElementById("chart-".concat(t))),n={tooltip:{trigger:"item",formatter:"{a} <br/>{b}选择人次 : {c} ({d}%)"},series:[{name:"数据占比",type:"pie",radius:"55%",center:["50%","60%"],data:e}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}},i=-1;setInterval((function(){var t=n.series[0].data.length;s.dispatchAction({type:"downplay",seriesIndex:0,dataIndex:i}),i=(i+1)%t,s.dispatchAction({type:"highlight",seriesIndex:0,dataIndex:i}),s.dispatchAction({type:"showTip",seriesIndex:0,dataIndex:i})}),1e3),s.setOption(n)},goBack:function(){this.$router.push({path:"/qslist"})}},watch:{$route:"fetchData"}},d=h,m=(s("7fce"),s("2877")),p=Object(m["a"])(d,n,i,!1,null,"e93e5a00",null);e["default"]=p.exports},"7fce":function(t,e,s){"use strict";var n=s("3396"),i=s.n(n);i.a},"9c94":function(t,e,s){"use strict";var n=s("2b1f"),i=s.n(n);i.a},a67b:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{attrs:{id:"header"}},[s("v-header")],1),s("div",{staticClass:"fill-container"},[t.isError?s("div",{staticClass:"error"},[t._v("404 Not Found")]):s("div",{staticClass:"fill"},[s("router-link",{staticClass:"back",attrs:{to:"/qslist",tag:"span"}},[t._v("< 返回")]),s("h2",[t._v(t._s(t.qsItem.title))]),s("div",{staticClass:"content"},t._l(t.qsItem.question,(function(e){return s("div",{staticClass:"content-item"},[s("p",{staticClass:"qs-title"},[t._v(t._s(e.num)+" "+t._s(e.title)+" "+t._s(t.getMsg(e)))]),t._l(e.options,(function(n){return s("p",{staticClass:"option"},[s("label",["radio"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:t.requiredItem[e.num],expression:"requiredItem[item.num]"}],attrs:{type:"radio",name:e.num+"-"+e.title},domProps:{value:n,checked:t._q(t.requiredItem[e.num],n)},on:{change:function(s){return t.$set(t.requiredItem,e.num,n)}}}):t._e(),"checkbox"===e.type?s("input",{directives:[{name:"model",rawName:"v-model",value:t.requiredItem[e.num],expression:"requiredItem[item.num]"}],attrs:{type:"checkbox",name:e.num+"-"+e.title},domProps:{value:n,checked:Array.isArray(t.requiredItem[e.num])?t._i(t.requiredItem[e.num],n)>-1:t.requiredItem[e.num]},on:{change:function(s){var i=t.requiredItem[e.num],r=s.target,a=!!r.checked;if(Array.isArray(i)){var o=n,c=t._i(i,o);r.checked?c<0&&t.$set(t.requiredItem,e.num,i.concat([o])):c>-1&&t.$set(t.requiredItem,e.num,i.slice(0,c).concat(i.slice(c+1)))}else t.$set(t.requiredItem,e.num,a)}}}):t._e(),t._v("\n              "+t._s(n)+"\n            ")])])})),"textarea"===e.type?s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.requiredItem[e.num],expression:"requiredItem[item.num]"}],domProps:{value:t.requiredItem[e.num]},on:{input:function(s){s.target.composing||t.$set(t.requiredItem,e.num,s.target.value)}}}):t._e()],2)})),0),s("transition",{attrs:{name:"fade"}},[t.showDialog?s("div",{staticClass:"dialog"},[t.submitError?s("div",{staticClass:"submit-dialog"},[s("header",[s("span",[t._v("提示")]),s("span",{staticClass:"close-btn",on:{click:function(e){t.showDialog=!1}}},[t._v("X")])]),s("p",[t._v(t._s(t.info))]),s("div",{staticClass:"btn-box"},[s("button",{staticClass:"yes",on:{click:function(e){t.showDialog=!1}}},[t._v("确定")]),s("button",{on:{click:function(e){t.showDialog=!1}}},[t._v("取消")])])]):s("div",{staticClass:"submit-dialog"},[s("header",[s("span",[t._v("提示")]),s("span",{staticClass:"close-btn",on:{click:function(e){t.showDialog=!1}}},[t._v("X")])]),s("p",[t._v(t._s(t.info))])])]):t._e()]),s("footer",[s("button",{staticClass:"submit",on:{click:t.submit}},[t._v("提交")])])],1)])])},i=[],r=(s("ac6a"),s("7514"),s("96cf"),s("3b8d")),a=s("d174"),o=s("5d2d"),c=s("0fea"),u=s("ca00"),l={name:"QsFill",components:{vHeader:a["default"]},data:function(){return{qsItem:[],qsList:"",isError:!1,showDialog:!1,info:"",submitError:!1,requiredItem:{}}},created:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=o["e"]("cur_user"),t.t0=o["d"](o["a"]+e.username),t.t0){t.next=6;break}return t.next=5,c["queryQuestionList"](e.username);case 5:t.t0=t.sent;case 6:return this.qsList=t.t0,t.next=9,this.fetchData();case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),mounted:function(){this.getRequiredItem()},methods:{fetchData:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=0,s=this.qsList.length;case 2:if(!(e<s)){t.next=9;break}if(this.qsList[e].id!=this.$route.params.num){t.next=6;break}try{this.qsItem=this.qsList[e],this.qsItem.question=JSON.parse(this.qsItem.question)}catch(n){console.error(n)}return t.abrupt("break",9);case 6:e++,t.next=2;break;case 9:if(!u["k"](this.qsItem)){t.next=20;break}return t.prev=10,t.next=13,c["queryQuestionById"](this.$route.params.num);case 13:this.qsItem=t.sent,this.qsItem.question=JSON.parse(this.qsItem.question),t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](10),console.error(t.t0);case 20:u["k"](this.qsItem)&&e===this.qsList.length&&(this.isError=!0);case 21:case"end":return t.stop()}}),t,this,[[10,17]])})));function e(){return t.apply(this,arguments)}return e}(),getMsg:function(t){var e="";return e="radio"===t.type?"(单选题)":"checkbox"===t.type?"(多选题)":"(文本题)",t.isNeed?"".concat(e," *"):e},submit:function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(){var e,s,n,i,r,a,l,h,d=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=o["e"]("cur_user"),s=u["i"]((new Date).getTime(),"yyyy-MM-dd"),t.next=4,c["queryQuestionById"](this.qsItem.id);case 4:n=t.sent,i=[];try{i=!u["k"](n.answers)&&Array.isArray(JSON.parse(n.answers))?JSON.parse(n.answers):[]}catch(m){console.error(m)}if(r=window.__.find(i,(function(t){return t.username==e.username})),u["k"](r)){t.next=13;break}return this.showDialog=!0,this.submitError=!0,this.info="提交失败，您已经提交过调查问卷了！",t.abrupt("return","false");case 13:if("inissue"!==this.qsItem.state){t.next=34;break}if(a=this.validate(),!a){t.next=29;break}return l={username:e.username,replay:this.requiredItem,create_time:s},i.push(l),n.answers=JSON.stringify(i),h=["bs_questions",n.id,{id:n.id,answers:n.answers}],t.next=22,c["patchTableData"].apply(c,h);case 22:this.showDialog=!0,this.submitError=!1,this.info="提交成功！",setTimeout((function(){d.showDialog=!1}),500),setTimeout((function(){d.$router.push({path:"/"})}),1500),t.next=32;break;case 29:this.showDialog=!0,this.submitError=!0,this.info="提交失败！ 存在必填项未填";case 32:t.next=37;break;case 34:this.showDialog=!0,this.submitError=!0,this.info="提交失败！ 只有发布中的问卷才能提交";case 37:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),getRequiredItem:function(){var t=this;this.qsItem.question.forEach((function(e){e.isNeed&&e.isNeed&&("checkbox"===e.type?t.requiredItem[e.num]=[]:t.requiredItem[e.num]="")}))},validate:function(){for(var t in this.requiredItem)if(0===this.requiredItem[t].length)return!1;return!0}},watch:{$route:"fetchData"}},h=l,d=(s("b4b8"),s("2877")),m=Object(d["a"])(h,n,i,!1,null,"0ebfaddd",null);e["default"]=m.exports},ae2e:function(t,e,s){},b4b8:function(t,e,s){"use strict";var n=s("ae2e"),i=s.n(n);i.a},e919:function(t,e,s){}}]);