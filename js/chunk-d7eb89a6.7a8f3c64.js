(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d7eb89a6","chunk-2d222025","chunk-d7eb89a6"],{"47cb":function(t,e,a){"use strict";var o=a("47e4"),s=a.n(o);s.a},"47e4":function(t,e,a){},5560:function(t,e,a){"use strict";var o=a("fbd1"),s=a.n(o);s.a},b2d9:function(t,e,a){},bc46:function(t,e,a){"use strict";var o=a("b2d9"),s=a.n(o);s.a},cd7e:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-index"},[a("wrapper-content")],1)},s=[],i={name:"project-space-index"},r=i,n=a("2877"),c=Object(n["a"])(r,o,s,!1,null,"2dd62e62",null);e["default"]=c.exports},dea8:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-features",class:t.project.task_board_theme},[a("div",{staticClass:"project-navigation"},[a("div",{staticClass:"project-nav-header"},[a("a-breadcrumb",[a("a-breadcrumb-item",[a("router-link",{attrs:{to:"/home"}},[a("a-icon",{attrs:{type:"home"}}),t._v("首页\n          ")],1)],1),a("a-breadcrumb-item",[a("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),a("span",{staticClass:"actions"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?a("span",{staticClass:"label label-normal"},[a("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),a("section",{staticClass:"nav-body"},[a("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[a("li",[a("a",{staticClass:"app",attrs:{"data-app":"tasks"},on:{click:function(e){return t.$router.push("/project/space/task/"+t.code)}}},[t._v("任务")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),a("li",[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),a("li",{staticClass:"actives"},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])])]),a("wrapper-content",{attrs:{showHeader:!1}},[a("div",{staticClass:"content-wrapper"},[a("div",{staticClass:"content-item features-content"},[a("div",{staticClass:"actions m-t"},[t.currentProjectFeatures?a("a-dropdown",{attrs:{placement:"bottomCenter",trigger:["click"]}},[a("a",{staticClass:"m-r text-default features-list-dropdown"},[a("span",{staticClass:"m-r-xs"},[t._v(t._s(t.currentProjectFeatures.name))]),a("a-icon",{attrs:{type:"down"}})],1),a("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:t.changeProjectFeatures},slot:"overlay"},t._l(t.projectFeaturesList,(function(e){return a("a-menu-item",{key:e.code},[a("div",{staticClass:"menu-item-content"},[a("div",[a("a-radio",{attrs:{checked:t.currentProjectFeatures.code==e.code}}),a("span",{attrs:{color:"green"}},[t._v(t._s(e.name))])],1),a("div",[a("a",{staticClass:"muted"},[a("a-icon",{attrs:{type:"edit"},on:{click:function(a){return a.stopPropagation(),t.editFeatures(e)}}})],1),a("a",{staticClass:"muted"},[a("a-icon",{staticClass:"m-l",attrs:{type:"delete"},on:{click:function(a){return a.stopPropagation(),t.deleteFeatures(e)}}})],1)])])])})),1)],1):t._e(),a("a-button",{attrs:{icon:"plus",type:"primary"},on:{click:t.createFeatures}},[t._v("创建版本库")]),a("a-divider",{staticClass:"m-b-lg m-t-lg"})],1),t.currentProjectFeatures?a("a-spin",{attrs:{spinning:t.loading}},[t.versionTotal?t._l(t.versionList,(function(e,o){return a("div",{key:o},["published"==o&&e.length?a("a",{staticClass:"muted m-l-sm m-b-sm",staticStyle:{cursor:"pointer",display:"block"},on:{click:function(e){t.showPublished=!t.showPublished}}},[a("span",{staticClass:"m-r-sm"},[t._v("已发布版本")]),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showPublished,expression:"showPublished"}],attrs:{type:"up"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.showPublished,expression:"!showPublished"}],attrs:{type:"ellipsis"}})],1):t._e(),a("div",{staticClass:"version-content",class:{published:"published"==o}},[t._l(e,(function(e,s){return[a("a-card",{directives:[{name:"show",rawName:"v-show",value:"published"!=o||"published"==o&&t.showPublished,expression:"\n                      versionType != 'published' ||\n                      (versionType == 'published' && showPublished)\n                    "}],key:s,staticClass:"version-item",attrs:{hoverable:""},on:{click:function(a){return t.showVersionDetail(e.code)}}},[a("template",{slot:"title"},[a("strong",{class:{muted:"published"==o}},[t._v("\n                        "+t._s(e.name)+"\n                      ")]),a("a-dropdown",{directives:[{name:"show",rawName:"v-show",value:"normal"==o,expression:"versionType == 'normal'"}],attrs:{placement:"bottomCenter",trigger:["click"]}},[a("span",{staticClass:"version-status",class:"status-"+e.status,on:{click:function(t){t.stopPropagation()}}},[a("a-icon",{attrs:{type:"schedule"}}),a("span",{staticClass:"m-l-xs"},[t._v(t._s(e.statusText))])],1),a("a-menu",{staticClass:"field-right-menu",attrs:{slot:"overlay",selectable:!1},on:{click:function(a){return t.changeVersionStatus(a,o,e,s)}},slot:"overlay"},[a("a-menu-item",{key:"0"},[a("div",{staticClass:"menu-item-content"},[a("a-tag",[t._v("未开始")]),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:0==e.status,expression:"version.status == 0"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),a("a-menu-item",{key:"1"},[a("div",{staticClass:"menu-item-content"},[a("a-tag",{attrs:{color:"blue"}},[t._v("进行中")]),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:1==e.status,expression:"version.status == 1"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),a("a-menu-item",{key:"2"},[a("div",{staticClass:"menu-item-content"},[a("a-tag",{attrs:{color:"red"}},[t._v("延期发布")]),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:2==e.status,expression:"version.status == 2"}],staticClass:"check muted",attrs:{type:"check"}})],1)]),a("a-menu-item",{key:"3"},[a("div",{staticClass:"menu-item-content"},[a("a-tag",{attrs:{color:"green"}},[t._v("已发布")]),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:3==e.status,expression:"version.status == 3"}],staticClass:"check muted",attrs:{type:"check"}})],1)])],1)],1)],1),a("div",{staticClass:"publish-time muted"},[e.publish_time||e.plan_publish_time?[a("span","normal"==o?[t._v("预计发布时间："+t._s(e.plan_publish_time))]:[t._v("发布时间："+t._s(e.publish_time))])]:t._e()],2),a("a-tooltip",{directives:[{name:"show",rawName:"v-show",value:"normal"==o,expression:"versionType == 'normal'"}],attrs:{placement:"top",mouseEnterDelay:.3,title:"当前进度："+e.schedule+"%"}},[a("a-progress",{attrs:{strokeWidth:4,showInfo:!1,percent:parseInt(e.schedule)}})],1)],2)]})),a("a-card",{directives:[{name:"show",rawName:"v-show",value:"normal"==o,expression:"versionType == 'normal'"}],staticClass:"version-item version-create",attrs:{hoverable:""},on:{click:t.createVersion}},[a("a",{staticClass:"muted"},[a("div",[a("a-icon",{attrs:{type:"plus"}}),a("div",[t._v("创建版本")])],1)])])],2)])})):a("div",{staticClass:"text-center"},[a("p",{staticClass:"muted"},[t._v("暂无可用版本")]),a("a-button",{attrs:{type:"primary"},on:{click:t.createVersion}},[t._v("创建版本")])],1)],2):t._e()],1)])]),a("a-modal",{attrs:{destroyOnClose:"",width:360,title:t.projectFeatures.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.projectFeatures.modalStatus,callback:function(e){t.$set(t.projectFeatures,"modalStatus",e)},expression:"projectFeatures.modalStatus"}},[a("a-form",{attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入版本库名称"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入版本库名称'}]},\n          ]"}],attrs:{placeholder:"版本库名称"}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"版本库简介",rows:2}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.projectFeatures.confirmLoading}},[t._v(t._s(t.projectFeatures.modalTitle))])],1)])],1)],1),a("a-modal",{attrs:{destroyOnClose:"",width:500,title:t.projectVersion.modalTitle,bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.projectVersion.modalStatus,callback:function(e){t.$set(t.projectVersion,"modalStatus",e)},expression:"projectVersion.modalStatus"}},[a("a-form",{attrs:{form:t.projectVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitProjectVersion(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入版本名称"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入版本名称'}]},\n          ]"}],attrs:{placeholder:"版本名称"}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"版本备注",rows:2}})],1),a("a-form-item",[a("a-row",{attrs:{gutter:16}},[a("a-col",{attrs:{span:12}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["startTime"],expression:"['startTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择开始时间"}})],1),a("a-col",{attrs:{span:12}},[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["planPublishTime"],expression:"['planPublishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择预计发布时间"}})],1)],1)],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.projectVersion.confirmLoading}},[t._v("创建版本")])],1)])],1)],1),a("a-modal",{attrs:{destroyOnClose:"",width:360,title:"实际发布时间",bodyStyle:{paddingBottom:"1px"},footer:null},model:{value:t.publishVersion.modalStatus,callback:function(e){t.$set(t.publishVersion,"modalStatus",e)},expression:"publishVersion.modalStatus"}},[a("a-form",{attrs:{form:t.publishVersionForm},on:{submit:function(e){return e.preventDefault(),t.handleSubmitPublishVersion(e)}}},[a("a-form-item",[a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["publishTime"],expression:"['publishTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",format:"YYYY年MM月DD日 HH:mm",placeholder:"选择实际发布时间"}})],1),a("a-form-item",[a("div",{staticClass:"action-btn"},[a("a-button",{staticClass:"middle-btn",attrs:{type:"primary",htmlType:"submit",block:"",size:"large",loading:t.publishVersion.confirmLoading}},[t._v("确认发布")])],1)])],1)],1),a("a-modal",{staticClass:"task-detail-modal",attrs:{destroyOnClose:"",width:"min-content",closable:!1,title:"",footer:null},on:{cancel:t.versionDetailClose},model:{value:t.versionDetail.modalStatus,callback:function(e){t.$set(t.versionDetail,"modalStatus",e)},expression:"versionDetail.modalStatus"}},[a("version-detail",{attrs:{versionCode:t.versionDetail.code},on:{close:t.versionDetailClose}})],1)],1)},s=[],i=(a("7514"),a("7f7f"),a("ac6a"),a("6be7")),r=a("e55b"),n=a("2f14"),c=a("81fe"),l=a("1b80"),d=a("c13a"),u=a("bc5b"),p=a("beeb"),m=a("f8c7"),h={name:"project-space-features",components:{versionDetail:p["default"],projectSelect:m["default"]},mixins:[l["a"]],data:function(){return{code:this.$route.params.code,project:{task_board_theme:"simple"},loading:!0,form:this.$form.createForm(this),projectVersionForm:this.$form.createForm(this),publishVersionForm:this.$form.createForm(this),projectFeaturesList:[],currentProjectFeatures:null,currentProjectVersion:null,versionTotal:1,versionList:{normal:[],published:[]},showPublished:!1,projectFeatures:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑版本库",info:null},projectVersion:{modalStatus:!1,confirmLoading:!1,modalTitle:"编辑版本",info:null},publishVersion:{modalStatus:!1,confirmLoading:!1,info:null,status:-1},versionDetail:{modalStatus:!1,code:""}}},created:function(){this.getProject(),this.init()},methods:{init:function(){this.getProjectFeaturesList()},getProject:function(){var t=this;this.loading=!0,Object(i["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data}))},getProjectFeaturesList:function(){var t=this;Object(d["c"])({projectCode:this.code}).then((function(e){t.projectFeaturesList=e.data,e.data.length&&!t.currentProjectFeature&&(t.currentProjectFeatures=e.data[0],t.getProjectVersionList())}))},getProjectVersionList:function(){var t=this;t.loading=!0,Object(u["g"])({projectFeaturesCode:this.currentProjectFeatures.code}).then((function(e){var a=0,o=[],s=[];e.data.forEach((function(t){a++,3==t.status?s.push(t):o.push(t)})),t.versionTotal=a,t.versionList.normal=o,t.versionList.published=s,t.loading=!1}))},createFeatures:function(){var t=this;t.projectFeatures.modalStatus=!0,t.projectFeatures.info=null,t.projectFeatures.modalTitle="创建版本库"},editFeatures:function(t){var e=this;e.projectFeatures.modalStatus=!0,e.projectFeatures.modalTitle="编辑版本库",e.projectFeatures.info=t,this.$nextTick((function(){e.form.setFieldsValue({name:t.name,description:t.description})}))},deleteFeatures:function(t){var e=this;this.$confirm({title:"删除版本库",content:"若将『".concat(t["name"],"』 删除，所有与版本库相关的信息将会被彻底删除，删除后不可恢复。"),okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(d["a"])({featuresCode:t.code}).then((function(a){var o=Object(n["a"])(a);if(!o)return!1;e.currentProjectFeatures.code==t.code&&(e.currentProjectFeatures=null),e.init()})),Promise.resolve()}})},createVersion:function(){var t=this;t.projectVersion.modalStatus=!0,t.projectVersion.info=null,t.projectVersion.modalTitle="创建版本"},changeVersionStatus:function(t,e,a,o){var s=this,i=this;if(t.key==a.code)return!1;3==t.key?this.$confirm({title:"发布提示",content:"请确认当前版本发布内容已全部完成后再发布。",okText:"确认发布",okType:"primary",onOk:function(){return i.publishVersion.info=a,i.publishVersion.status=t.key,i.publishVersion.modalStatus=!0,i.$nextTick((function(){i.publishVersionForm.setFieldsValue({publishTime:moment()})})),Promise.resolve()}}):Object(u["b"])({versionCode:a.code,status:t.key}).then((function(t){s.getProjectVersionList()}))},showVersionDetail:function(t){this.versionDetail.modalStatus=!0,this.versionDetail.code=t},versionDetailClose:function(){this.versionDetail.modalStatus=!1,this.versionDetail.code="",this.getProjectVersionList()},handleSubmitPublishVersion:function(){var t=this,e=this;e.publishVersionForm.validateFields((function(a){if(!a){var o=e.publishVersionForm.getFieldsValue();o.publishTime=moment(o.publishTime).format("YYYY-MM-DD HH:mm"),Object(u["b"])({versionCode:t.publishVersion.info.code,status:t.publishVersion.status,publishTime:o.publishTime}).then((function(t){e.publishVersion.modalStatus=!1,e.getProjectVersionList()}))}}))},handleSubmit:function(){var t=this;t.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this,e=this;e.projectFeatures.confirmLoading=!0;var a=e.form.getFieldsValue();a.projectCode=this.code,e.projectFeatures.info?(a.featuresCode=e.projectFeatures.info.code,Object(d["b"])(a).then((function(a){e.projectFeatures.confirmLoading=!1,Object(n["a"])(a)&&(e.form.resetFields(),t.getProjectFeaturesList(),e.projectFeatures.modalStatus=!1)}))):Object(d["d"])(a).then((function(t){e.projectFeatures.confirmLoading=!1,Object(n["a"])(t)&&(e.form.resetFields(),e.projectFeatures.modalStatus=!1,e.init())}))},handleSubmitProjectVersion:function(){var t=this;t.projectVersionForm.validateFields((function(e){e||t.handleOkProjectVersion()}))},handleOkProjectVersion:function(){var t=this;t.projectVersion.confirmLoading=!0;var e=t.projectVersionForm.getFieldsValue();e.featuresCode=this.currentProjectFeatures.code,e.startTime=moment(e.startTime).format("YYYY-MM-DD HH:mm"),e.planPublishTime=moment(e.planPublishTime).format("YYYY-MM-DD HH:mm"),Object(u["j"])(e).then((function(e){t.projectVersion.confirmLoading=!1,Object(n["a"])(e)&&(t.projectVersionForm.resetFields(),t.projectVersion.modalStatus=!1,t.getProjectVersionList())}))},changeProjectFeatures:function(t){this.currentProjectFeatures=this.projectFeaturesList.find((function(e){return e.code==t.key})),this.getProjectVersionList()},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(r["a"])(this.project.code,e).then((function(e){Object(n["a"])(e)&&(t.project.collected=!t.project.collected)}))},formatTime:function(t){return Object(c["c"])(t)}}},f=h,v=(a("47cb"),a("2877")),b=Object(v["a"])(f,o,s,!1,null,null,null);e["default"]=b.exports},e4e3:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-overview",class:t.project.task_board_theme},[a("div",{staticClass:"project-navigation"},[a("div",{staticClass:"project-nav-header"},[a("a-breadcrumb",[a("a-breadcrumb-item",[a("router-link",{attrs:{to:"/home"}},[a("a-icon",{attrs:{type:"home"}}),t._v("首页\n          ")],1)],1),a("a-breadcrumb-item",[a("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),a("span",{staticClass:"actions"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?a("span",{staticClass:"label label-normal"},[a("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),a("section",{staticClass:"nav-body"},[a("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[a("li",[a("a",{staticClass:"app",attrs:{"data-app":"tasks"},on:{click:function(e){return t.$router.push("/project/space/task/"+t.code)}}},[t._v("任务")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),a("li",{staticClass:"actives"},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])])]),a("wrapper-content",{attrs:{showHeader:!1}},[a("div",{staticClass:"overview-item m-b"},[a("div",{staticClass:"content-item"},[a("h3",{staticClass:"m-sm m-b text-center"},[t._v("任务燃尽图")]),a("a-spin",{attrs:{spinning:t.burnoutMap.loading}},[t.burnoutMap.loading?t._e():a("ve-line",{attrs:{data:t.burnoutMap.chartData,settings:t.burnoutMap.chartSettings,extend:t.burnoutMap.chartExtend,series:t.burnoutMap.series,"legend-visible":!1,height:"200px"}})],1)],1)]),a("div",{staticClass:"overview-item"},[a("div",{staticClass:"content-left"},[a("div",{staticClass:"content-item log-list"},[a("div",{staticClass:"title"},[t._v("\n            项目信息\n            "),a("a-tooltip",{attrs:{mouseEnterDelay:.5}},[a("template",{slot:"title"},[a("span",[t._v("添加信息")])]),a("a",{staticClass:"pull-right muted",on:{click:function(e){return t.createInfo()}}},[a("a-icon",{attrs:{type:"plus-circle"}})],1)],2)],1),a("div",{staticClass:"list-content"},[a("a-list",t._l(t.projectInfoList,(function(e,o){return a("a-list-item",{key:o},[a("a-list-item-meta",[a("div",{attrs:{slot:"title"},slot:"title"},[a("a-tooltip",{attrs:{mouseEnterDelay:.5}},[a("template",{slot:"title"},[a("span",[t._v("\n                          "+t._s(e.description?e.description:"暂无描述")+"\n                        ")])]),a("span",[t._v(t._s(e.name))])],2)],1),a("div",{attrs:{slot:"description"},slot:"description"},[t._v(t._s(e.value))])]),a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.editInfo(e)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.delInfo(e,o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"删除"}},[a("a-icon",{attrs:{type:"delete"}})],1)],1)],1)})),1)],1)]),a("div",{staticClass:"content-item log-list"},[a("div",{staticClass:"title"},[t._v("项目动态")]),a("div",{staticClass:"list-content"},[a("a-list",[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多动态")])],1):t._e(),t._l(t.activities,(function(e,o){return a("a-list-item",{key:o},[a("a-list-item-meta",[a("a-avatar",{attrs:{slot:"avatar",src:e.member_avatar},slot:"avatar"}),a("div",{attrs:{slot:"title"},slot:"title"},[a("span",[t._v(t._s(e.member_name))]),0==e.is_comment?a("span",[a("span",{domProps:{innerHTML:t._s(e.remark)}})]):t._e(),t._v(" \n                    "),1==e.is_comment?[t._v("\n                      发表了评论\n                      "),a("p",{staticClass:"comment-text"},[t._v(t._s(e.content))])]:t._e(),a("span",{staticClass:"right-item muted"},[t._v("\n                      "+t._s(t.formatTime(e.create_time))+"\n                    ")])],2),a("div",{attrs:{slot:"description"},slot:"description"},["task"==e.action_type?[a("router-link",{staticClass:"muted",attrs:{to:"/project/space/task/"+e.project_code+"/detail/"+e.source_code}},[t._v(t._s(e.sourceInfo.name))])]:t._e(),"project"==e.action_type?[a("span",{domProps:{innerHTML:t._s(e.content)}})]:t._e()],2)],1)],1)}))],2)],1)])]),a("div",{staticClass:"content-right"},[a("div",{staticClass:"content-item"},[a("div",{staticClass:"list-content"},[a("div",{staticClass:"default-list"},[a("a-list",t._l([t.project],(function(e,o){return a("a-list-item",{key:o},[a("a-list-item-meta",[a("a-avatar",{attrs:{slot:"avatar",src:e.cover},slot:"avatar"}),a("div",{attrs:{slot:"title"},slot:"title"},[a("span",[t._v(t._s(e.name))])]),a("div",{attrs:{slot:"description"},slot:"description"},[t._v("\n                      "+t._s(e.owner_name)+" 创建于\n                      "+t._s(t.moment(e.create_time).format("YYYY年MM月DD日"))+"\n                    ")])],1)],1)})),1)],1)]),a("p",{},[t._v(t._s(t.project.description))]),a("div",{staticClass:"project-date m-b-lg m-t-lg"},[a("div",{staticClass:"muted m-b-xs"},[a("a-tag",{attrs:{color:"green"}},[t._v("项目周期")])],1),a("a-range-picker",{attrs:{format:"YYYY年MM月DD日"},on:{change:t.ondateChange},model:{value:t.projectDate,callback:function(e){t.projectDate=e},expression:"projectDate"}})],1),a("div",{staticClass:"project-stats m-b-lg"},[a("div",{staticClass:"muted m-b-xs"},[a("a-tag",{attrs:{color:"green"}},[t._v("项目统计")])],1),a("div",{staticClass:"stats-content"},t._l(t.projectStats,(function(e,o){return a("div",{key:o,staticClass:"stats-item"},[a("div",{staticClass:"stats-title muted"},[t._v(t._s(e.title))]),a("div",{staticClass:"stats-number"},[t._v(t._s(e.number))]),a("a-tooltip",{attrs:{placement:"right",mouseEnterDelay:.3,title:e.schedule+"%"}},[a("a-progress",{attrs:{strokeColor:"#1890ff",strokeWidth:3,showInfo:!1,percent:e.schedule}})],1)],1)})),0)]),a("div",[a("div",{staticClass:"muted"},[a("a-tag",{attrs:{color:"green"}},[t._v("新增任务趋势")])],1),a("ve-line",{attrs:{data:t.chartData,settings:t.chartSettings,extend:t.chartExtend,"legend-visible":!1,height:"200px"}})],1)])])])]),a("a-modal",{staticClass:"project-info",attrs:{width:400,title:t.infoModal.modalTitle,confirmLoading:t.infoModal.loading},on:{ok:t.handleSubmit},model:{value:t.infoModal.modalStatus,callback:function(e){t.$set(t.infoModal,"modalStatus",e)},expression:"infoModal.modalStatus"}},[a("a-form",{attrs:{form:t.infoModal.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{rules:[{required:!0,message:"请输入名称"}]}],expression:"[\n            'name',\n            {rules: [{required: true, message: '请输入名称'}]},\n          ]"}],attrs:{placeholder:"名称"}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["value"],expression:"['value']"}],attrs:{placeholder:"内容",rows:2}})],1),a("a-form-item",[a("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{placeholder:"描述",rows:2}})],1),a("a-form-item")],1)],1)],1)},s=[],i=(a("7f7f"),a("ac6a"),a("c3da")),r=a.n(i),n=a("6be7"),c=a("8743"),l=a("e55b"),d=a("2f14"),u=a("ca8d"),p=a("81fe"),m=a("1b80"),h=a("f8c7"),f={name:"project-space-overview",components:{VeLine:r.a,projectSelect:h["default"]},mixins:[m["a"]],data:function(){return{code:this.$route.params.code,loading:!0,project:{task_board_theme:"simple"},projectDate:[],activities:[],projectInfoList:[],showLoadingMore:!1,loadingMore:!1,infoModal:{form:this.$form.createForm(this),newData:{code:""},loading:!1,modalStatus:!1,modalTitle:"项目信息"},burnoutMap:{loading:!0,chartData:{columns:["日期","实际剩余任务","理想剩余任务"],rows:[]},series:[{type:"line",name:"实际剩余任务",smooth:!1,color:"#1890ff",data:[]},{type:"line",name:"理想剩余任务",color:"#52C41A",smooth:!1,lineStyle:{type:"dashed"},data:[]}],chartSettings:{},chartExtend:{grid:{left:"5",right:"20",top:"10",bottom:"0"},xAxis:{show:!0,splitLine:{show:!1}},yAxis:{show:!0,splitLine:{show:!0,lineStyle:{type:"dashed",color:["#e4e4e4"]}}},tooltip:{backgroundColor:"#fff",textStyle:{color:"#333"},borderWidth:1,borderColor:"#e8e8e8"},axisPointer:{lineStyle:{width:0}}}},chartData:{columns:["日期","任务"],rows:[]},chartSettings:{area:!0,itemStyle:{color:"#1890ff"},areaStyle:{color:"#e6f7ff"}},chartExtend:{grid:{left:"-20",right:"0",top:"10",bottom:"0"},xAxis:{show:!1},yAxis:{show:!1},tooltip:{backgroundColor:"#fff",textStyle:{color:"#333"},borderWidth:1,borderColor:"#e8e8e8"},axisPointer:{lineStyle:{width:0}}},projectStats:[{title:"未完成",key:"unDone",number:0,schedule:0},{title:"已完成",key:"done",number:0,schedule:0},{title:"已逾期",key:"overdue",number:0,schedule:0},{title:"待认领",key:"toBeAssign",number:0,schedule:0},{title:"今日到期",key:"expireToday",number:0,schedule:0},{title:"逾期完成",key:"doneOverdue",number:0,schedule:0}]}},created:function(){this.getProject(),this.init()},methods:{moment:moment,init:function(){this.getProjectInfoList(),this.getProjectLog(),this.overviewForProject(),this.getProjectStats(),this.getProjectReport()},getProject:function(){var t=this;this.loading=!0,Object(n["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data,t.project.begin_time&&(t.projectDate=[moment(t.project.begin_time),moment(t.project.end_time)])}))},getProjectReport:function(){var t=this;Object(n["a"])({projectCode:this.code}).then((function(e){var a=[];e.data.date.forEach((function(t){a.push({"日期":t})})),t.burnoutMap.loading=!1,t.burnoutMap.chartData.rows=a,t.burnoutMap.series[0].data=e.data.undoneTask,t.burnoutMap.series[1].data=e.data.baseLineList}))},getProjectLog:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this;t&&(e.pagination.page=1,e.pagination.pageSize=20,e.showLoadingMore=!1),this.requestData.projectCode=this.code,Object(u["i"])(this.requestData).then((function(a){var o=[];a.data.list.forEach((function(t){o.push(t)})),t&&(e.activities=[]),e.activities=e.activities.concat(o),e.pagination.total=a.data.total,e.showLoadingMore=e.pagination.total>e.activities.length,e.loading=!1,e.loadingMore=!1}))},getProjectInfoList:function(){var t=this;Object(c["c"])({projectCode:t.code}).then((function(e){t.projectInfoList=e.data}))},getProjectStats:function(){var t=this;Object(n["b"])({projectCode:this.code}).then((function(e){var a=e.data,o=a["total"];t.projectStats.forEach((function(t,e){t.number=a[t.key],o&&(t.schedule=parseInt(t.number/o*100))}))}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.getProjectLog(!1)},overviewForProject:function(){var t=this;Object(u["d"])({projectCode:this.code}).then((function(e){var a=[];e.data.forEach((function(t){a.push({"日期":moment(t.date).format("M月D日"),"任务":t.total})})),t.chartData.rows=a}))},createInfo:function(){var t=this;t.infoModal.newData={code:""},setTimeout((function(){t.infoModal.form&&t.infoModal.form.resetFields()}),0),t.infoModal.modalStatus=!0,t.infoModal.modalTitle="添加字段"},editInfo:function(t){var e=this;e.infoModal.newData=t,e.infoModal.modalStatus=!0,setTimeout((function(){e.infoModal.modalTitle="编辑字段",e.infoModal.form.setFieldsValue({name:t.name,value:t.value,description:t.description})}),0)},delInfo:function(t,e){var a=this;a.$confirm({title:"确定删除当前字段吗？",okText:"删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(c["a"])({infoCode:t.code}).then((function(){a.projectInfoList.splice(e,1)})),Promise.resolve()}})},handleSubmit:function(){var t=this;t.infoModal.form.validateFields((function(e){e||t.handleOk()}))},handleOk:function(){var t=this;t.infoModal.loading=!0;var e=t.infoModal.form.getFieldsValue();t.infoModal.newData.code?e.infoCode=t.infoModal.newData.code:Object.assign(e,t.infoModal.newData),e.projectCode=t.code,console.log(e),Object(c["b"])(e).then((function(e){t.infoModal.loading=!1,Object(d["a"])(e)&&(t.infoModal.form.resetFields(),t.infoModal.newData={code:0},t.infoModal.modalStatus=!1,t.getProjectInfoList())}))},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(l["a"])(this.project.code,e).then((function(e){Object(d["a"])(e)&&(t.project.collected=!t.project.collected)}))},ondateChange:function(t){console.log(t);var e=this.project;Object(n["e"])({projectCode:e.code,begin_time:t.length?t[0].format("YYYY-MM-DD"):"",end_time:t.length?t[1].format("YYYY-MM-DD"):""})},formatTime:function(t){return Object(p["c"])(t)}}},v=f,b=(a("bc46"),a("2877")),j=Object(b["a"])(v,o,s,!1,null,null,null);e["default"]=j.exports},e649:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"project-space-files",class:t.project.task_board_theme},[a("div",{staticClass:"project-navigation"},[a("div",{staticClass:"project-nav-header"},[a("a-breadcrumb",[a("a-breadcrumb-item",[a("router-link",{attrs:{to:"/home"}},[a("a-icon",{attrs:{type:"home"}}),t._v("首页 ")],1)],1),a("a-breadcrumb-item",[a("project-select",{staticClass:"nav-title",staticStyle:{display:"inline-block"},attrs:{code:t.code}}),a("span",{staticClass:"actions"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3,title:t.project.collected?"取消收藏":"加入收藏"},on:{click:t.collectProject}},[a("a-icon",{directives:[{name:"show",rawName:"v-show",value:!t.project.collected,expression:"!project.collected"}],staticStyle:{color:"grey"},attrs:{type:"star",theme:"filled"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.project.collected,expression:"project.collected"}],staticStyle:{color:"#ffaf38"},attrs:{type:"star",theme:"filled"}})],1)],1),0===t.project.private?a("span",{staticClass:"label label-normal"},[a("a-icon",{attrs:{type:"global"}}),t._v("公开\n          ")],1):t._e()],1)],1)],1),a("section",{staticClass:"nav-body"},[a("ul",{staticClass:"nav-wrapper nav nav-underscore pull-left"},[a("li",[a("a",{staticClass:"app",attrs:{"data-app":"tasks"},on:{click:function(e){return t.$router.push("/project/space/task/"+t.code)}}},[t._v("任务")])]),a("li",{staticClass:"actives"},[a("a",{staticClass:"app",attrs:{"data-app":"works"},on:{click:function(e){return t.$router.push("/project/space/files/"+t.code)}}},[t._v("文件")])]),a("li",[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/overview/"+t.code)}}},[t._v("概览")])]),a("li",{},[a("a",{staticClass:"app",attrs:{"data-app":"build"},on:{click:function(e){return t.$router.push("/project/space/features/"+t.code)}}},[t._v("版本")])])])])]),a("wrapper-content",{attrs:{showHeader:!1}},[a("div",{staticClass:"content-wrapper"},[a("div",{staticClass:"content-item log-list"},[a("div",{staticClass:"header"},[a("span",{staticClass:"title"},[t._v("我的文件")]),a("div",{staticClass:"header-actions"},[a("a-button",{attrs:{id:"upload-file",icon:"up-circle",type:"dashed"}},[t._v("上传")])],1)]),a("div",{staticClass:"list-content"},[a("a-list",{attrs:{loading:t.loading}},[a("a-list-item",{staticClass:"list-item-title"},[a("a-list-item-meta",[a("div",{staticClass:"muted",attrs:{slot:"title"},slot:"title"},[t._v("名称")])]),a("div",{staticClass:"other-info muted"},[a("div",{staticClass:"info-item"},[a("span",[t._v("大小")])]),a("div",{staticClass:"info-item"},[a("span",[t._v("创建日期")])]),a("div",{staticClass:"info-item"},[a("span",[t._v("创建人")])])]),t._l(3,(function(e){return a("span",{key:e,attrs:{slot:"actions"},slot:"actions"},[a("span",[t._v("位")])])}))],2),t._l(t.files,(function(e,o){return a("a-list-item",{key:o,staticClass:"list-item"},[a("a-list-item-meta",[a("a-avatar",{attrs:{slot:"avatar",shape:"square",icon:"link",src:e.file_url},slot:"avatar"}),a("div",{attrs:{slot:"title"},slot:"title"},[a("a-tooltip",{attrs:{mouseEnterDelay:.3}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.fullName))])]),a("a-input",{directives:[{name:"show",rawName:"v-show",value:e.editing,expression:"item.editing"}],ref:"inputTitle"+o,refInFor:!0,attrs:{"auto-focus":!0},on:{pressEnter:function(a){return t.onCellChange(e)},blur:function(a){return t.onCellChange(e)}},model:{value:e.title,callback:function(a){t.$set(e,"title",a)},expression:"item.title"}}),a("a",{directives:[{name:"show",rawName:"v-show",value:!e.editing,expression:"!item.editing"}],staticClass:"text-default",attrs:{target:"_blank",href:t._f("showPreviewUrl")(e)}},[t._v(t._s(e.fullName))])],2)],1)],1),a("div",{staticClass:"other-info muted"},[a("div",{staticClass:"info-item"},[a("span",[t._v(t._s(t.formatSize(e.size)))])]),a("div",{staticClass:"info-item"},[a("a-tooltip",{attrs:{title:e.create_time}},[a("span",[t._v(t._s(t.formatTime(e.create_time)))])])],1),a("div",{staticClass:"info-item"},[a("span",[t._v(t._s(e.creatorName))])])]),a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a-tooltip",{attrs:{title:"下载"}},[a("a",{staticClass:"muted",attrs:{target:"_blank",href:e.file_url}},[a("a-icon",{attrs:{type:"download"}})],1)])],1),a("span",{attrs:{slot:"actions"},on:{click:function(a){return t.editFile(e,o)}},slot:"actions"},[a("a-tooltip",{attrs:{title:"编辑"}},[a("a-icon",{attrs:{type:"edit"}})],1)],1),a("a",{staticClass:"muted",attrs:{slot:"actions"},slot:"actions"},[a("a-dropdown",{attrs:{trigger:["click"],placement:"bottomCenter"}},[a("a-tooltip",{attrs:{mouseEnterDelay:.5}},[a("template",{slot:"title"},[a("span",[t._v("更多操作")])]),a("a",{staticClass:"action-item muted"},[a("a-icon",{attrs:{type:"down"}})],1)],2),a("a-menu",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.file_url,expression:"item.file_url"}],staticClass:"field-right-menu",attrs:{slot:"overlay"},on:{click:function(a){return t.doFile(a,e.code)}},slot:"overlay"},[a("a-menu-item",{key:"copy"},[a("a-icon",{attrs:{type:"link"}}),a("span",[t._v("复制链接")])],1),a("a-menu-item",{key:"delete"},[a("a-icon",{attrs:{type:"delete"}}),a("span",[t._v("移到回收站")])],1)],1)],1)],1)],1)})),t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("查看更多文件")])],1):t._e()],2)],1)])])])],1)},s=[],i=(a("8e6e"),a("456d"),a("ac6a"),a("7f7f"),a("20d6"),a("bd86")),r=a("5880"),n=a("6be7"),c=a("e55b"),l=a("2f14"),d=a("81fe"),u=a("3f5e"),p=a("1b80"),m=a("97a8"),h=a("f8c7");function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,o)}return a}function v(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var b={name:"project-space-files",mixins:[p["a"]],data:function(){return{code:this.$route.params.code,loading:!0,showLoadingMore:!1,loadingMore:!1,project:{task_board_theme:"simple"},currentFileIndex:{},files:[]}},components:{projectSelect:h["default"]},computed:v({},Object(r["mapState"])({uploader:function(t){return t.common.uploader}})),watch:{uploader:{handler:function(t,e){var a=this,o=t.fileList,s=o.findIndex((function(t){return t.projectName==a.project.name}));-1!==s&&this.getFiles()},deep:!0}},created:function(){this.getProject(),this.getFiles()},mounted:function(){var t=this;setTimeout((function(){t.uploader.assignBrowse(document.getElementById("upload-file"))}),500)},methods:{getProject:function(){var t=this;this.loading=!0,Object(n["h"])(this.code).then((function(e){t.loading=!1,t.project=e.data,t.$store.dispatch("setTempData",{projectCode:t.project.code})}))},getFiles:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=this;e&&(this.pagination.page=1,this.pagination.pageSize=50,this.showLoadingMore=!1),a.requestData.projectCode=this.code,a.requestData.deleted=0,Object(u["b"])(a.requestData).then((function(o){e&&(t.files=[]),o.data.list.forEach((function(t){t.editing=!1})),a.files=a.files.concat(o.data.list),a.pagination.total=o.data.total,a.showLoadingMore=a.pagination.total>a.files.length,a.loading=!1,a.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.getFiles(!1)},collectProject:function(){var t=this,e=this.project.collected?"cancel":"collect";Object(c["a"])(this.project.code,e).then((function(e){Object(l["a"])(e)&&(t.project.collected=!t.project.collected)}))},editFile:function(t,e){var a=this;this.files.forEach((function(t){t.editing=!1})),this.files[e].editing=!0,this.$nextTick((function(){a.$refs["inputTitle".concat(e)][0].focus()})),this.currentFileIndex=e},onCellChange:function(t){var e=this.files[this.currentFileIndex];this.files.forEach((function(t){t.editing=!1}));var a="".concat(t.title,".").concat(t.extension);a!=e.fullName&&Object(u["a"])({title:e.title,fileCode:e.code}).then((function(o){var s=Object(l["a"])(o);if(!s)return!1;e.title=t.title,e.fullName=a,Object(m["b"])({title:"重命名成功"},"notice","success")}))},doFile:function(t,e){var a=this,o=t.key;switch(o){case"delete":this.$confirm({title:"移到回收站",content:"您确定要把该文件移到回收站吗？",okText:"移到回收站",okType:"danger",cancelText:"再想想",onOk:function(){return Object(u["c"])(e).then((function(t){var e=Object(l["a"])(t);if(!e)return!1;a.getFiles()})),Object(m["b"])({title:"成功移到回收站",msg:"可在 菜单－查看回收站－文件 中查看"},"notice","success",5),Promise.resolve()}});break;case"copy":return Object(m["b"])({title:"复制链接成功",msg:"在地址栏粘贴并打开可下载该资源"},"notice","success",5),!0}},formatTime:function(t){return Object(d["c"])(t)},formatSize:function(t){var e="KB";return t/=1024,t>=1024&&(t/=1024,e="MB"),"".concat(t.toFixed(2)," ").concat(e)}}},j=b,g=(a("5560"),a("2877")),_=Object(g["a"])(j,o,s,!1,null,null,null);e["default"]=_.exports},fbd1:function(t,e,a){}}]);