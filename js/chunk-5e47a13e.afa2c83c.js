(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5e47a13e","chunk-5e47a13e"],{"19f2":function(t,e,a){"use strict";var i=a("40b6"),s=a.n(i);s.a},"1d80":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"task-search"},[a("a-spin",{attrs:{spinning:t.loading}},[a("div",{staticClass:"search-content"},[a("a-form",{staticClass:"m-t-md",attrs:{form:t.form},on:{submit:function(e){return e.preventDefault(),t.handleSubmit(e)}}},[a("a-form-item",{attrs:{label:"标题",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["title"],expression:"[\n                                          'title',\n                                          ]"}],attrs:{placeholder:"搜索项目内任务"}})],1),a("a-form-item",{attrs:{label:"执行者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["executor"],expression:"[\n                                          'executor',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"创建者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["creator"],expression:"[\n                                          'creator',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"参与者",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["joiner"],expression:"[\n                                          'joiner',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},t._l(t.projectMemberList,(function(e){return a("a-select-option",{key:e.code},[a("div",{staticClass:"task-search-member-item"},[a("a-avatar",{staticClass:"m-r-sm",attrs:{size:24,icon:"user",src:e.avatar}}),a("div",[a("div",[t._v(t._s(e.name))]),a("div",{staticClass:"muted"},[t._v(t._s(e.email))])])],1)])})),1)],1),a("a-form-item",{attrs:{label:"是否完成",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["done",{initialValue:-1}],expression:"[\n                                          'done',\n                                           {initialValue: -1}\n\n                                          ]"}],attrs:{allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},[a("a-select-option",{key:-1},[t._v("全部")]),a("a-select-option",{key:1},[t._v("是")]),a("a-select-option",{key:0},[t._v("否")])],1)],1),a("a-form-item",{attrs:{label:"优先级",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["pri"],expression:"[\n                                          'pri',\n                                          ]"}],attrs:{mode:"multiple",showSearch:"",allowClear:"",placeholder:"请选择",optionFilterProp:"children"}},[a("a-select-option",{key:0},[t._v("普通")]),a("a-select-option",{key:1},[t._v("紧急")]),a("a-select-option",{key:2},[t._v("非常紧急")])],1)],1),a("a-form-item",{attrs:{label:"截止日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["end_time"],expression:"[\n                                          'end_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"创建日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["create_time"],expression:"[\n                                          'create_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"完成日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["done_time"],expression:"[\n                                          'done_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1),a("a-form-item",{attrs:{label:"开始日期",colon:!1,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-range-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["begin_time"],expression:"[\n                                          'begin_time',\n                                          ]"}],staticStyle:{width:"100%"},attrs:{allowClear:"",format:"YYYY-MM-DD"}})],1)],1),a("div",{staticClass:"footer m-t-md"},[a("a-button",{staticClass:"m-r",attrs:{type:"primary",size:"large"},on:{click:t.handleSubmit}},[t._v("搜索")]),a("a-button",{attrs:{size:"large"},on:{click:t.resetForm}},[t._v("重置")])],1)],1)])],1)},s=[],n=(a("c5f6"),a("2ef0"),a("c030")),r=a("9f09"),o=(a("97a8"),{name:"taskSearch",props:{projectCode:{type:[String,Number],default:function(){return""}}},data:function(){return{moment:moment,form:this.$form.createForm(this),loading:!1,projectMemberList:[],taskStageList:[]}},watch:{projectCode:function(){this.init()}},created:function(){this.init()},methods:{init:function(){this.projectCode&&(this.resetForm(),this.loading=!0,this.getProjectMemberList(),this.getTaskStageList())},getProjectMemberList:function(){var t=this;Object(n["c"])({projectCode:this.projectCode,pageSize:300}).then((function(e){t.projectMemberList=e.data.list,t.loading=!1}))},getTaskStageList:function(){var t=this;Object(r["a"])({projectCode:this.projectCode}).then((function(e){t.taskStageList=e.data,t.loading=!1}))},resetForm:function(){this.form.resetFields()},handleSubmit:function(){var t=this;this.form.validateFields((function(e,a){if(!e){var i=t.form.getFieldsValue();i.executor=JSON.stringify(i.executor),i.creator=JSON.stringify(i.creator),i.joiner=JSON.stringify(i.joiner),console.log(i),i.end_time&&i.end_time.length?i.endTime=JSON.stringify([moment(i.end_time[0]).format("YYYY-MM-DD"),moment(i.end_time[1]).format("YYYY-MM-DD")]):i.endTime=void 0,i.begin_time&&i.begin_time.length?i.beginTime=JSON.stringify([moment(i.begin_time[0]).format("YYYY-MM-DD"),moment(i.begin_time[1]).format("YYYY-MM-DD")]):i.beginTime=void 0,i.create_time&&i.create_time.length?i.createTime=JSON.stringify([moment(i.create_time[0]).format("YYYY-MM-DD"),moment(i.create_time[1]).format("YYYY-MM-DD")]):i.createTime=void 0,i.done_time&&i.done_time.length?i.doneTime=JSON.stringify([moment(i.done_time[0]).format("YYYY-MM-DD"),moment(i.done_time[1]).format("YYYY-MM-DD")]):i.doneTime=void 0,console.log(i),t.$emit("search",i)}}))}}}),c=o,l=(a("19f2"),a("2877")),d=Object(l["a"])(c,i,s,!1,null,null,null);e["default"]=d.exports},"1ee8":function(t,e,a){},"40b6":function(t,e,a){},4540:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"member-menu",class:{creating:t.creating,editing:t.editing}},[a("a-spin",{attrs:{spinning:t.listLoading}},[a("div",{staticClass:"search-content"},[a("a-input",{attrs:{size:"large",placeholder:t.creating||t.editing?"标签名称":"搜索标签"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[t.creating||t.editing?a("a-icon",{attrs:{slot:"prefix",type:"tag"},slot:"prefix"}):a("a-icon",{attrs:{slot:"prefix",type:"search"},slot:"prefix"})],1)],1),a("div",{staticClass:"member-list tag-list"},[t.creating||t.editing?t._e():[a("vue-scroll",[a("div",{staticClass:"list-group"},[a("a-list",{directives:[{name:"show",rawName:"v-show",value:t.list.length,expression:"list.length"}],staticClass:"list-content",attrs:{itemLayout:"horizontal",dataSource:t.list},scopedSlots:t._u([{key:"renderItem",fn:function(e,i){return a("a-list-item",{staticClass:"member-list-item",nativeOn:{click:function(a){return t.setTag(e)}}},[a("span",{attrs:{slot:"actions"},slot:"actions"},[a("a",{staticClass:"tag-edit muted"},[a("a-icon",{attrs:{type:"edit"},on:{click:function(a){return a.stopPropagation(),t.editTag(e,i)}}})],1),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.showCheck(e),expression:"showCheck(item)"}],staticClass:"m-l-sm",attrs:{type:"check"}})],1),a("a-list-item-meta",[a("span",{staticClass:"tag-title",attrs:{slot:"title"},slot:"title"},[a("a-badge",{class:"badge-"+e.color,attrs:{status:"success"}}),t._v("\n                    "+t._s(e.name)+"\n                  ")],1)])],1)}}],null,!1,2674320970)})],1)])],t.creating||t.editing?[a("div",{staticClass:"tag-badge"},t._l(t.badgeList,(function(e){return a("span",{key:e,staticClass:"badge-item",on:{click:function(a){t.currentBadge=e}}},[a("a-badge",{class:"badge-"+e,attrs:{status:"success"}}),a("a-icon",{directives:[{name:"show",rawName:"v-show",value:t.currentBadge==e,expression:"currentBadge == badge"}],attrs:{type:"check"}})],1)})),0)]:t._e()],2),a("div",{staticClass:"footer"},[t.creating?[a("a-button",{attrs:{type:"default",size:"large"},on:{click:function(e){t.creating=!1,t.keyword=""}}},[t._v("取消")]),a("a-button",{attrs:{type:"primary",disabled:!t.keyword,size:"large"},on:{click:t.createTag}},[t._v("创建")])]:t.editing?[a("a-popconfirm",{attrs:{overlayStyle:{zIndex:"1080"},title:"确认删除标签？",okText:"确定",cancelText:"取消"},on:{confirm:t.deleteTag}},[a("a-button",{attrs:{type:"danger",size:"large"}},[t._v("删除")])],1),a("a-button",{attrs:{type:"primary",disabled:!t.keyword,size:"large"},on:{click:t.saveTag}},[t._v("完成")])]:[a("a-button",{attrs:{type:"primary",size:"large",block:""},on:{click:function(e){t.creating=!0,t.activeCreating=!0}}},[t._v("新建标签")])]],2)])],1)},s=[],n=(a("7f7f"),a("20d6"),a("386d"),a("c5f6"),a("2ef0"),a("db9e6")),r=a("ca8d"),o=a("2f14"),c={name:"taskTagMenu",props:{projectCode:{type:[String,Number],default:function(){return""}},taskCode:{type:[String,Number],default:function(){return""}},isCommit:{type:[Boolean],default:function(){return!0}}},data:function(){return{keyword:"",editing:!1,creating:!1,activeCreating:!1,searching:!1,listLoading:!1,showInviteMember:!1,tags:[],list:[],listTemp:[],badgeList:["blue","red","orange","green","brown","purple"],currentBadge:"blue",currentTag:{tag:null,index:-1}}},created:function(){this.init()},watch:{keyword:function(){this.search()}},methods:{init:function(){var t=this;this.projectCode&&(this.listLoading=!0,Object(n["c"])({projectCode:this.projectCode}).then((function(e){t.list=e.data,t.listTemp=e.data,t.listLoading=!1}))),this.taskCode&&Object(r["u"])({taskCode:this.taskCode}).then((function(e){t.tags=e.data}))},showCheck:function(t){var e=this.tags.findIndex((function(e){return e.tag_code==t.code}));if(-1!==e)return!0},checkTaskChange:function(t){var e=this.tags.findIndex((function(e){return e.tag_code==t.code}));-1!==e?this.tags.splice(e,1):this.tags.push({tag_code:t.code})},editTag:function(t,e){this.editing=!0,this.keyword=t.name,this.currentBadge=t.color,this.currentTag.tag=t,this.currentTag.index=e},saveTag:function(){var t=this;Object(n["b"])({name:this.keyword,color:this.currentBadge,tagCode:this.currentTag.tag.code}).then((function(e){if(!Object(o["a"])(e))return!1;t.currentTag.tag.name=t.listTemp[t.currentTag.index].name=t.keyword,t.currentTag.tag.color=t.listTemp[t.currentTag.index].color=t.currentBadge,t.$emit("update",t.currentTag.tag),t.clearCreating()}))},deleteTag:function(){var t=this;Object(n["a"])(this.currentTag.tag.code).then((function(e){if(!Object(o["a"])(e))return!1;t.listTemp.splice(t.currentTag.index,1),t.$emit("delete",t.currentTag.tag),t.clearCreating()}))},setTag:function(t){var e=this;this.checkTaskChange(t),this.isCommit?Object(r["q"])({taskCode:this.taskCode,tagCode:t.code}).then((function(){e.$emit("change",t)})):this.$emit("change",t)},createTag:function(){var t=this;Object(n["d"])({projectCode:this.projectCode,name:this.keyword,color:this.currentBadge}).then((function(e){if(!Object(o["a"])(e))return!1;var a=e.data;t.listTemp.push(a),t.list.push(a),t.checkTaskChange(a),Object(r["q"])({taskCode:t.taskCode,tagCode:a.code}).then((function(){t.$emit("change",a),t.clearCreating()}))}))},clearCreating:function(){this.editing=!1,this.creating=!1,this.activeCreating=!1,this.keyword=""},search:function(){var t=this;this.keyword=this.keyword.trim(),this.keyword||(this.list=JSON.parse(JSON.stringify(this.listTemp)),this.activeCreating||(this.creating=!1)),this.searching=!0,this.list=this.list.filter((function(e){return-1!=e.name.indexOf(t.keyword)})),this.list.length||this.editing||(this.creating=!0)}}},l=c,d=(a("ae2c"),a("2877")),m=Object(d["a"])(l,i,s,!1,null,null,null);e["default"]=m.exports},ae2c:function(t,e,a){"use strict";var i=a("1ee8"),s=a.n(i);s.a},dd5e:function(t,e,a){},e3cc:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-tabs",{staticClass:"task-tag-index",attrs:{tabPosition:"left",defaultActiveKey:"1",animated:!1},model:{value:t.tabKey,callback:function(e){t.tabKey=e},expression:"tabKey"}},[t._l(t.taskTagList,(function(e){return a("a-tab-pane",{key:e.code},[a("div",{attrs:{slot:"tab"},slot:"tab"},[a("div",{staticClass:"tag-item"},[a("a-badge",{class:"badge-"+e.color,attrs:{status:"success"}}),t._v("\n          "+t._s(e.name)+"\n        ")],1)]),a("div",{staticClass:"config-content"},[a("vue-scroll",[a("div",{staticClass:"content-item"},[a("div",{staticClass:"infos"},[a("a-list",{attrs:{loading:{spinning:t.loading,delay:300}}},[t.showLoadingMore?a("div",{style:{textAlign:"center",marginTop:"12px",height:"32px",lineHeight:"32px"},attrs:{slot:"loadMore"},slot:"loadMore"},[t.loadingMore?a("a-spin"):a("a-button",{on:{click:t.onLoadMore}},[t._v("加载更多")])],1):t._e(),t._l(t.list,(function(e,i){return a("a-list-item",{key:i},[a("a-list-item-meta",[a("div",{staticClass:"task-list",class:{done:e.done},attrs:{slot:"title"},slot:"title"},[a("div",[a("router-link",{staticClass:"text-default task-content",attrs:{to:"/project/space/task/"+t.code+"/detail/"+e.code}},[e.executor&&e.executor.avatar?a("a-tooltip",{attrs:{placement:"top"}},[a("template",{slot:"title"},[a("span",[t._v(t._s(e.executor.name))])]),a("img",{staticClass:"avatar task-executor img-circle img-24 hinted m-r-sm",attrs:{src:e.executor.avatar,title:e.executor.name}})],2):a("a-avatar",{staticClass:"m-r-sm",attrs:{size:"small",icon:"user"}}),a("span",{staticClass:"task-name m-r"},[t._v(t._s(e.name))]),t._l(e.tags,(function(e){return a("span",{key:e.code,staticClass:"muted flex m-r tag-name"},[a("a-badge",{class:"badge-"+e.tag.color+" m-r-xs",attrs:{status:"success"}}),t._v("\n                            "+t._s(e.tag.name)+"\n                          ")],1)}))],2)],1),e.end_time?a("div",{staticClass:"label task-time",class:t.showTimeLabel(e.end_time)},[t._v(t._s(t.showTaskTime(e.begin_time,e.end_time)))]):t._e()])])],1)}))],2)],1)])])],1)])})),t.loading||t.list.length?t._e():a("div",{staticClass:"m-t text-center"},[a("strong",[a("h2",[t._v("项目中还没有标签")])])])],2)],1)},s=[],n=a("2f14"),r=a("db9e6"),o=a("1b80"),c=a("81fe"),l=a("ca8d"),d={name:"taskTag",props:{code:{type:[String],default:function(){return""}}},mixins:[o["a"]],data:function(){return{loading:!1,tabKey:"0",project:{},taskTagList:[],list:[],showLoadingMore:!1,loadingMore:!1}},watch:{code:function(){this.init()},tabKey:function(t){this.getTaskList()}},created:function(){this.init()},methods:{init:function(){var t=this;this.requestData.projectCode=this.code,t.getTaskTags()},getTaskTags:function(){var t=this;Object(r["c"])(t.requestData).then((function(e){t.taskTagList=e.data,e.data.length&&(t.tabKey=e.data[0].code)}))},getTaskList:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.tabKey)return!1;var e=this;e.loading=!0,t&&(this.list=[],this.pagination.page=1,this.pagination.pageSize=10,this.showLoadingMore=!1),Object(l["h"])({taskTagCode:this.tabKey}).then((function(t){e.list=e.list.concat(t.data.list),e.pagination.total=t.data.total,e.showLoadingMore=e.pagination.total>e.list.length,e.loading=!1,e.loadingMore=!1}))},onLoadMore:function(){this.loadingMore=!0,this.pagination.page++,this.getTaskList(!1)},showTaskTime:function(t,e){return Object(c["a"])(t,e)},showTimeLabel:function(t){var e="label-primary";if(null==t)return e;var a=moment(moment(t).format("YYYY-MM-DD")).diff(moment().format("YYYY-MM-DD"),"days");return a<0?e="label-danger":0==a?e="label-warning":a>7&&(e="label-normal"),e},deleteItem:function(t,e){var a=this;switch(this.tabKey){case"1":this.$confirm({title:"确定彻底删除任务？",content:"彻底删除任务后，该任务及其子任务将会被永久被删除。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return Object(r["a"])(t.code).then((function(i){Object(n["a"])(i)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break;case"2":this.$confirm({title:"确认彻底删除该文件？",content:"彻底删除文件后，相关的关联资源将会失效。",okText:"彻底删除",okType:"danger",cancelText:"再想想",onOk:function(){return delFile(t.code).then((function(i){Object(n["a"])(i)&&(a.list.splice(e,1),a.$emit("update",t))})),Promise.resolve()}});break}}}},m=d,u=(a("f9ef"),a("2877")),g=Object(u["a"])(m,i,s,!1,null,null,null);e["default"]=g.exports},f9ef:function(t,e,a){"use strict";var i=a("dd5e"),s=a.n(i);s.a}}]);