(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d314c52a"],{"146a":function(t,e,n){(function(t){(function(t,e){e()})(0,(function(){"use strict";var e=setTimeout;function n(){}function r(t,e){return function(){t.apply(e,arguments)}}function o(t){if(!(this instanceof o))throw new TypeError("Promises must be constructed via new");if("function"!==typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(t,this)}function a(t,e){while(3===t._state)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn((function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(o){return void c(e.promise,o)}i(e.promise,r)}else(1===t._state?i:c)(e.promise,t._value)}))):t._deferreds.push(e)}function i(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"===typeof e||"function"===typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void s(t);if("function"===typeof n)return void l(r(n,e),t)}t._state=1,t._value=e,s(t)}catch(a){c(t,a)}}function c(t,e){t._state=2,t._value=e,s(t)}function s(t){2===t._state&&0===t._deferreds.length&&o._immediateFn((function(){t._handled||o._unhandledRejectionFn(t._value)}));for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function u(t,e,n){this.onFulfilled="function"===typeof t?t:null,this.onRejected="function"===typeof e?e:null,this.promise=n}function l(t,e){var n=!1;try{t((function(t){n||(n=!0,i(e,t))}),(function(t){n||(n=!0,c(e,t))}))}catch(r){if(n)return;n=!0,c(e,r)}}o.prototype["catch"]=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var r=new this.constructor(n);return a(this,new u(t,e,r)),r},o.prototype["finally"]=function(t){var e=this.constructor;return this.then((function(n){return e.resolve(t()).then((function(){return n}))}),(function(n){return e.resolve(t()).then((function(){return e.reject(n)}))}))},o.all=function(t){return new o((function(e,n){if(!t||"undefined"===typeof t.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(t);if(0===r.length)return e([]);var o=r.length;function a(t,i){try{if(i&&("object"===typeof i||"function"===typeof i)){var c=i.then;if("function"===typeof c)return void c.call(i,(function(e){a(t,e)}),n)}r[t]=i,0===--o&&e(r)}catch(s){n(s)}}for(var i=0;i<r.length;i++)a(i,r[i])}))},o.resolve=function(t){return t&&"object"===typeof t&&t.constructor===o?t:new o((function(e){e(t)}))},o.reject=function(t){return new o((function(e,n){n(t)}))},o.race=function(t){return new o((function(e,n){for(var r=0,o=t.length;r<o;r++)t[r].then(e,n)}))},o._immediateFn="function"===typeof setImmediate&&function(t){setImmediate(t)}||function(t){e(t,0)},o._unhandledRejectionFn=function(t){"undefined"!==typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var d=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof t)return t;throw new Error("unable to locate global object")}();d.Promise||(d.Promise=o)}))}).call(this,n("c8ba"))},1509:function(t,e,n){"use strict";var r=n("2e1f"),o=n.n(r);o.a},"259a":function(t,e,n){"use strict";n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return i}));var r=n("22b6"),o=n("2f14");function a(){return Object(o["g"])("index/oauth/dingTalkOauth")}function i(t){return r["a"].post("index/oauth/dingTalkLoginByCode",t)}},"2e1f":function(t,e,n){},8593:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n("22b6");function o(){return r["a"].post("project/index/systemConfig")}},"8a1c":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main"},[n("a-spin",{staticClass:"text-center",attrs:{spinning:t.oauthLoading}},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.oauthLoading,expression:"oauthLoading"}]},[t._v("正在登陆，请稍后...")])]),n("a-form",{directives:[{name:"show",rawName:"v-show",value:!t.oauthLoading,expression:"!oauthLoading"}],ref:"formLogin",staticClass:"user-layout-login",attrs:{id:"formLogin",form:t.form}},[n("a-tabs",{attrs:{activeKey:t.customActiveKey,tabBarStyle:{textAlign:"center",borderBottom:"unset"}},on:{change:t.handleTabClick}},[n("a-tab-pane",{key:"tab1",attrs:{tab:"账号密码登录"}},[n("a-form-item",[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["account",{rules:[{required:!0,message:"请输入帐户名或邮箱地址"},{validator:this.handleUsernameOrEmail}],validateTrigger:"blur"}],expression:"[\n                              'account',\n                              {rules: [{ required: true, message: '请输入帐户名或邮箱地址' },{ validator: this.handleUsernameOrEmail }], validateTrigger: 'blur'}\n                          ]"}],attrs:{size:"large",type:"text",placeholder:"帐户名或邮箱地址"}},[n("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"user"},slot:"prefix"})],1)],1),n("a-form-item",[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["password",{rules:[{required:!0,message:"请输入密码"}],validateTrigger:"blur"}],expression:"[\n                              'password',\n                              {rules: [{ required: true, message: '请输入密码' }], validateTrigger: 'blur'}\n                          ]"}],attrs:{size:"large",type:"password",autocomplete:"false",placeholder:"密码"}},[n("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"lock"},slot:"prefix"})],1)],1)],1),n("a-tab-pane",{key:"tab2",attrs:{tab:"手机号登录"}},[n("a-form-item",[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["mobile",{rules:[{required:!0,pattern:/^1[34578]\d{9}$/,message:"请输入正确的手机号"},{validator:this.handleUsernameOrEmail}],validateTrigger:"change"}],expression:"[\n                              'mobile',\n                              {rules: [{ required: true, pattern: /^1[34578]\\d{9}$/, message: '请输入正确的手机号' },{ validator: this.handleUsernameOrEmail }], validateTrigger: 'change'}\n                          ]"}],attrs:{size:"large",type:"text",placeholder:"手机号"}},[n("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"mobile"},slot:"prefix"})],1)],1),n("a-row",{attrs:{gutter:16}},[n("a-col",{staticClass:"gutter-row",attrs:{span:16}},[n("a-form-item",[n("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["captcha",{rules:[{required:!0,message:"请输入验证码"}],validateTrigger:"blur"}],expression:"[\n                              'captcha',\n                              {rules: [{ required: true, message: '请输入验证码' }], validateTrigger: 'blur'}\n                          ]"}],attrs:{size:"large",type:"text",placeholder:"验证码"}},[n("a-icon",{style:{color:"rgba(0,0,0,.25)"},attrs:{slot:"prefix",type:"mail"},slot:"prefix"})],1)],1)],1),n("a-col",{staticClass:"gutter-row",attrs:{span:8}},[n("a-button",{staticClass:"getCaptcha",attrs:{tabindex:"-1",disabled:t.state.smsSendBtn},domProps:{textContent:t._s(t.state.smsSendBtn?t.state.time+" s":"获取验证码")},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.getCaptcha(e)}}})],1)],1)],1)],1),n("a-form-item",[n("a-checkbox",{model:{value:t.formLogin.rememberMe,callback:function(e){t.$set(t.formLogin,"rememberMe",e)},expression:"formLogin.rememberMe"}},[t._v("自动登录")]),n("a",{staticClass:"forge-password",staticStyle:{float:"right"},on:{click:function(e){return t.routerLink("/member/forgot")}}},[t._v("忘记密码")])],1),n("a-form-item",{staticStyle:{"margin-top":"24px"}},[n("a-button",{staticClass:"login-button",attrs:{size:"large",type:"primary",htmlType:"submit",loading:t.loginBtn,disabled:t.loginBtn},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit(e)}}},[t._v("登录")])],1),n("div",{staticClass:"user-login-other"},[n("span",[t._v("其他登录方式")]),n("a-tooltip",{attrs:{mouseEnterDelay:.3,title:"现已支持"}},[n("a",{on:{click:t.dingTalkOauth}},[n("a-icon",{staticClass:"item-icon",attrs:{type:"dingding"}})],1)]),n("router-link",{staticClass:"register",attrs:{to:{name:"register"}}},[t._v("注册账户")])],1)],1)],1)},o=[],a=(n("8e6e"),n("456d"),n("20d6"),n("7f7f"),n("ac6a"),n("bd86")),i=n("35ae"),c=n.n(i),s=n("2c18"),u=n("5880"),l=n("c24f"),d=n("8593"),f=n("a078"),p=n("2f14"),h=n("68fe"),m=n("efb5"),g=n("0672"),b=n("259a"),v=n("97a8");function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){Object(a["a"])(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var j={components:{},data:function(){return{customActiveKey:"tab1",loginBtn:!1,oauthLoading:!1,loginType:0,requiredTwoStepCaptcha:!1,stepCaptchaVisible:!1,form:this.$form.createForm(this),state:{time:60,smsSendBtn:!1},formLogin:{account:"",password:"",captcha:"",mobile:"",rememberMe:!0}}},computed:w({},Object(u["mapState"])({system:function(t){return t.system}})),mounted:function(){this.checkInstall(),this.$route.query.logged&&(this.oauthLoading=!0,this.checkLogin()),this.$route.query.message&&Object(v["b"])({title:this.$route.query.message},"notice")},methods:w({},Object(u["mapActions"])(["Login","Logout"]),{checkInstall:function(){var t=this;Object(m["a"])().then((function(e){if(!Object(p["a"])(e))return t.$router.push({name:"install"}),!1;Object(d["a"])().then((function(e){Object(p["a"])(e)&&(t.$store.dispatch("setSystem",e.data),t.dingTalkLogin())}))}))},handleUsernameOrEmail:function(t,e,n){var r=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/;r.test(e)?this.loginType=0:this.loginType=1,n()},handleTabClick:function(t){this.customActiveKey=t},handleSubmit:function(){var t=this,e=this,n=!1,r={remember_me:e.formLogin.rememberMe};"tab1"===e.customActiveKey?e.form.validateFields(["account","password"],{force:!0},(function(t,o){t||(n=!0,r[(e.loginType,"account")]=o.account,r.password=c()(o.password))})):e.form.validateFields(["mobile","captcha"],{force:!0},(function(t,e){t||(n=!0,r=Object.assign(r,e))})),n&&(e.loginBtn=!0,r.clientid=Object(h["a"])("client_id"),Object(l["a"])(r).then((function(e){Object(p["a"])(e)&&(r.token=e.token,t.dealDataBeforeLogin(e)),t.loginBtn=!1})).catch((function(){t.loginBtn=!1})))},getCaptcha:function(t){var e=this;t.preventDefault();var n=this;this.form.validateFields(["mobile"],{force:!0},(function(t,r){if(!t){e.state.smsSendBtn=!0;var o=window.setInterval((function(){n.state.time--<=0&&(n.state.time=60,n.state.smsSendBtn=!1,window.clearInterval(o))}),1e3);e.$message.loading("验证码发送中..",0);Object(l["h"])(r.mobile).then((function(t){if(e.$message.destroy(),!Object(p["a"])(t))return!1;var n="验证码获取成功";t.data&&(n+="，您的验证码为："+t.data),e.$notification["success"]({message:"提示",description:n,duration:8,placement:"bottomLeft"})})).catch((function(t){clearInterval(o),n.state.time=60,n.state.smsSendBtn=!1,e.requestFailed(t)}))}}))},loginSuccess:function(t,e){var n=this;setTimeout((function(){var r=Object(h["a"])("menu",!0);if(r){var o=n.$router.options.routes;r.forEach((function(t){o[0].children.push(Object(p["b"])(t)),t.children&&t.children.forEach((function(t){o[0].children.push(Object(p["b"])(t)),t.children&&t.children.forEach((function(t){o[0].children.push(Object(p["b"])(t))}))}))})),n.loginBtn=!1,n.$router.addRoutes(o);var a=n.$route.query.redirect||f["a"].HOME_PAGE+"/"+e.code;a==f["a"].HOME_PAGE&&(a=f["a"].HOME_PAGE+"/"+e.code),console.log("redirect"),console.log(a),n.$router.push({path:a}),n.$notification.success({message:"欢迎",description:"".concat(t.data.member.name,"，").concat(Object(p["i"])(),"，欢迎回来")}),n.oauthLoading=!1}}),500)},dingTalkOauth:function(){var t=Object(b["b"])()+"?redirect="+this.$route.query.redirect,e=this.$route.query.redirect;e&&(t+="?redirect="+e),location.href=t},dingTalkLogin:function(){var t=this;s["ready"]((function(){s["runtime"].permission.requestAuthCode({corpId:"ding42ccb1a1923b200f35c2f4657eb6378f",onSuccess:function(e){t.oauthLoading=!0,Object(b["a"])({code:e.code}).then((function(e){Object(p["a"])(e)&&t.dealDataBeforeLogin(e)}))}})}))},checkLogin:function(){var t=this;Object(g["c"])().then((function(e){t.dealDataBeforeLogin(e)}))},dealDataBeforeLogin:function(t){var e=this;if(t.data){var n={userInfo:t.data.member,tokenList:t.data.tokenList},r=Object(h["a"])("currentOrganization",!0),o=t.data.organizationList;if(e.$store.dispatch("SET_LOGGED",n),e.$store.dispatch("setOrganizationList",o),r){var a=o.findIndex((function(t){return t.id==r.id}));-1===a&&(r=o[0])}else r=o[0];e.$store.dispatch("setCurrentOrganization",r),e.$store.dispatch("GET_MENU").then((function(){e.loginSuccess(t,r)}))}else e.oauthLoading=!1,e.$store.dispatch("SET_LOGOUT")},requestFailed:function(t){this.$notification["error"]({message:"错误",description:((t.response||{}).data||{}).message||"请求出现错误，请稍后再试",duration:4}),this.loginBtn=!1}})},O=j,_=(n("1509"),n("2877")),L=Object(_["a"])(O,r,o,!1,null,null,null);e["default"]=L.exports},c24f:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"j",(function(){return l})),n.d(e,"h",(function(){return d})),n.d(e,"d",(function(){return f})),n.d(e,"i",(function(){return p})),n.d(e,"g",(function(){return h})),n.d(e,"k",(function(){return m})),n.d(e,"f",(function(){return g})),n.d(e,"c",(function(){return b})),n.d(e,"e",(function(){return v})),n.d(e,"b",(function(){return y}));n("96cf"),n("ac6a");var r=n("3b8d"),o=n("22b6"),a=n("a18c"),i=n("4360"),c=n("2f14");function s(t){return u.apply(this,arguments)}function u(){return u=Object(r["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",o["a"].post("project/login",e));case 1:case"end":return t.stop()}}),t)}))),u.apply(this,arguments)}function l(t){return o["a"].post("project/login/register",t)}function d(t){return o["a"].post("project/login/getCaptcha",{mobile:t})}function f(t){var e=t.code;return i["a"].dispatch("setCurrentOrganization",t),o["a"].post("project/index/changeCurrentOrganization",{organizationCode:e}).then((function(t){if(Object(c["a"])(t))return i["a"].dispatch("SET_MENU",t.data.menuList),i["a"].dispatch("SET_USER",t.data.member),i["a"].dispatch("windowLoading",!0),setTimeout((function(){var e=t.data.menuList;if(e){var n=a["a"].options.routes;e.forEach((function(t){n[0].children.push(Object(c["b"])(t)),t.children&&t.children.forEach((function(t){n[0].children.push(Object(c["b"])(t)),t.children&&t.children.forEach((function(t){n[0].children.push(Object(c["b"])(t))}))}))})),a["a"].addRoutes(n),i["a"].dispatch("windowLoading",!1)}}),500),Promise.resolve(t)}))}function p(t){return o["a"].post("project/account",t)}function h(t){return o["a"].post("project/account/forbid",{accountCode:t,status:0})}function m(t){return o["a"].post("project/account/resume",{accountCode:t,status:1})}function g(t){var e="project/account/add";return t.code&&(e="project/account/edit"),o["a"].post(e,t)}function b(t,e){return o["a"].post("project/account/auth",{id:t,auth:e})}function v(t){return o["a"].post("project/account/del",{accountCode:t})}function y(t){return o["a"].post("project/login/_checkBindMail",t)}},efb5:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return i}));var r=n("22b6");function o(t){return r["a"].post("index/index/install",t)}function a(){return r["a"].post("index/index/checkInstall")}function i(t){return r["a"].post("project/invite_link/_read",{inviteCode:t})}}}]);